<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Emergency Triage Dashboard - Disaster Response Assistant</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --color-red: #dc2626;
            --color-yellow: #f59e0b;
            --color-green: #16a34a;
            --color-blue: #3b82f6;
            --color-black: #374151;
            --card-bg: #ffffff;
            --border-color: #e5e7eb;
            --text-primary: #111827;
            --text-secondary: #6b7280;
            --bg-hover: #f3f4f6;
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --critical-pulse: pulse-red 2s infinite;
            --ai-purple: #8b5cf6;
            --ai-purple-light: #f3f0ff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            color: var(--text-primary);
            min-height: 100vh;
        }

        /* Header */
        .main-header {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            color: white;
            padding: 1rem 1.5rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow-md);
        }

        .header-content {
            max-width: 1800px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .page-title {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .status-indicators {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 0.9rem;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.2);
        }

        .status-online { background: rgba(34, 197, 94, 0.3); }
        .status-offline { background: rgba(239, 68, 68, 0.3); }

        .nav-buttons {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .btn-primary { background: #059669; color: white; }
        .btn-primary:hover { background: #047857; }
        .btn-secondary { background: rgba(255, 255, 255, 0.2); color: white; }
        .btn-secondary:hover { background: rgba(255, 255, 255, 0.3); }

        /* Keyboard shortcuts indicator */
        .shortcut {
            font-size: 0.7rem;
            opacity: 0.7;
            margin-left: 0.25rem;
        }

        /* Dashboard Layout */
        .dashboard-layout {
            max-width: 1800px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        /* Last updated indicator */
        .last-updated {
            text-align: center;
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
            padding: 0.5rem;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 6px;
        }

        .refresh-indicator {
            display: inline-block;
            margin-left: 0.5rem;
            color: var(--color-green);
        }

        /* Stats Row */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: var(--shadow-md);
            overflow: hidden;
            border: 1px solid var(--border-color);
            position: relative;
            transition: transform 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--accent-color);
        }

        .stat-content {
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            background: var(--accent-color);
            flex-shrink: 0;
        }

        .stat-details h3 {
            margin: 0;
            font-size: 2rem;
            font-weight: bold;
            color: var(--text-primary);
        }

        .stat-details p {
            margin: 0.25rem 0 0 0;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .stat-total { --accent-color: var(--color-blue); }
        .stat-active { --accent-color: var(--color-yellow); }
        .stat-today { --accent-color: var(--color-green); }
        .stat-critical { --accent-color: var(--color-red); }

        /* Operations Grid */
        .operations-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 1.5rem;
            align-items: start;
        }

        .main-column {
            grid-column: span 12;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .sidebar-column {
            grid-column: span 12;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        @media (min-width: 1024px) {
            .main-column { grid-column: span 8; }
            .sidebar-column { grid-column: span 4; }
        }

        /* Cards */
        .dashboard-card {
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
        }

        .card-header {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            color: white;
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0.75rem;
            border-bottom: 1px solid transparent;
        }

        .card-header.critical {
            background: linear-gradient(135deg, var(--color-red) 0%, #ef4444 100%);
            animation: var(--critical-pulse);
        }

        .card-title-section {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: bold;
            margin: 0;
        }

        .card-content {
            padding: 1.5rem;
            flex-grow: 1;
        }

        /* Priority Queue */
        .priority-queue {
            max-height: 500px;
            overflow-y: auto;
        }

        .queue-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            transition: all 0.2s ease;
            cursor: pointer;
            position: relative;
        }

        .queue-item:hover {
            background: var(--bg-hover);
            transform: translateX(4px);
        }

        .queue-item:focus {
            outline: 2px solid var(--color-blue);
            background: var(--bg-hover);
        }

        .queue-item.critical {
            border-left: 4px solid var(--color-red);
            animation: pulse-glow 3s infinite;
        }

        .queue-priority {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 0.8rem;
            flex-shrink: 0;
        }

        .priority-1 { background: var(--color-red); }
        .priority-2 { background: var(--color-yellow); }
        .priority-3 { background: var(--color-green); }
        .priority-4 { background: var(--color-black); }

        .queue-details {
            flex: 1;
        }

        .queue-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .queue-info {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .queue-time {
            font-size: 0.7rem;
            color: var(--text-secondary);
            text-align: right;
        }

        /* Critical Alerts */
        .alert-item {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .alert-item:hover {
            background: var(--bg-hover);
        }

        .alert-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .alert-details {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Staff presence */
        .staff-presence {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .staff-avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--color-green);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            color: white;
        }

        /* Chat notifications */
        .notification-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            background: var(--color-red);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Tool cards */
        .tool-card {
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
            padding: 1.5rem;
        }

        .tool-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .tool-icon {
            font-size: 1.2rem;
        }

        .tool-title {
            font-size: 1.1rem;
            font-weight: bold;
            margin: 0;
        }

        .tool-description {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-family: inherit;
            margin-bottom: 1rem;
            transition: border-color 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--color-blue);
        }

        .action-button {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }

        .action-button.primary {
            background: var(--color-blue);
            color: white;
        }

        .action-button.primary:hover {
            background: #2563eb;
        }

        .action-button.success {
            background: var(--color-green);
            color: white;
        }

        .action-button.success:hover {
            background: #059669;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 10000;
            backdrop-filter: blur(8px);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 20px;
            padding: 2rem;
            max-width: 800px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            border: 2px solid var(--border-color);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border-color);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
            transition: color 0.2s;
            padding: 0.5rem;
            border-radius: 50%;
        }

        .close-btn:hover {
            color: var(--color-red);
            background: rgba(220, 38, 38, 0.1);
        }

        /* Chat Styles */
        .chat-messages {
            max-height: 400px;
            overflow-y: auto;
            padding: 1rem;
            background: #f8fafc;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .chat-message {
            margin-bottom: 1rem;
            padding: 0.75rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .chat-input-container {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        #chat-input {
            flex: 1;
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
        }

        .send-btn {
            background: var(--ai-purple);
            color: white;
            border: none;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s;
        }

        .send-btn:hover {
            background: #7c3aed;
        }

        /* Handover Styles */
        .handover-section {
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: var(--ai-purple-light);
            border-radius: 8px;
            border-left: 4px solid var(--ai-purple);
        }

        .handover-title {
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: var(--ai-purple);
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-family: inherit;
            background: white;
        }

        .critical-item {
            background: rgba(220, 38, 38, 0.05);
            border: 1px solid rgba(220, 38, 38, 0.2);
            border-left: 4px solid var(--color-red);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .critical-header {
            font-weight: bold;
            color: var(--color-red);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Quick message buttons */
        .quick-messages {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .quick-msg-btn {
            background: var(--color-blue);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .quick-msg-btn:hover {
            background: #2563eb;
        }

        .quick-msg-btn.urgent {
            background: var(--color-red);
        }

        .quick-msg-btn.urgent:hover {
            background: #b91c1c;
        }

        /* Animations */
        @keyframes pulse-red {
            0%, 100% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7); }
            50% { box-shadow: 0 0 0 10px rgba(220, 38, 38, 0); }
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 5px rgba(220, 38, 38, 0.3); }
            50% { box-shadow: 0 0 20px rgba(220, 38, 38, 0.6); }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Snackbar */
        .snackbar {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background: var(--text-primary);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            display: none;
            z-index: 10000;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translate(-50%, 100%); opacity: 0; }
            to { transform: translate(-50%, 0); opacity: 1; }
        }

        /* Help tooltip */
        .help-tooltip {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 50px;
            height: 50px;
            background: var(--color-blue);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow-md);
            z-index: 1000;
        }

        /* Keyboard shortcuts overlay */
        .shortcuts-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10001;
            padding: 2rem;
        }

        .shortcuts-content {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            max-width: 600px;
            margin: 0 auto;
            max-height: 80vh;
            overflow-y: auto;
        }

        .shortcut-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .shortcut-key {
            background: var(--bg-hover);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.8rem;
        }

        /* Focus styles for accessibility */
        .queue-item:focus,
        .alert-item:focus,
        .btn:focus,
        .action-button:focus {
            outline: 2px solid var(--color-blue);
            outline-offset: 2px;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .operations-grid { grid-template-columns: 1fr; }
            .header-content { flex-direction: column; align-items: stretch; }
            .nav-buttons { justify-content: center; }
            .form-grid { grid-template-columns: 1fr; }
        }

        @media (max-width: 768px) {
            .dashboard-layout { padding: 1rem; }
            .stats-row { grid-template-columns: 1fr; }
            .modal-content { width: 95%; padding: 1rem; }
        }

        /* Print styles */
        @media print {
            .main-header,
            .help-tooltip,
            .shortcuts-overlay,
            .snackbar,
            .modal {
                display: none !important;
            }
            
            .dashboard-layout {
                padding: 0;
            }
            
            .dashboard-card {
                break-inside: avoid;
                box-shadow: none;
                border: 1px solid #000;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="main-header">
        <div class="header-content">
            <div class="header-left">
                <div class="page-title">
                    <i class="fas fa-heartbeat"></i>
                    AI Emergency Triage Dashboard
                </div>
                <div class="status-indicators">
                    <div class="status-item status-online" id="connection-status">
                        <i class="fas fa-wifi"></i>
                        <span id="status-text">Online</span>
                    </div>
                    <div class="staff-presence">
                        <span>Staff:</span>
                        <div class="staff-avatar" title="Dr. Smith">DS</div>
                        <div class="staff-avatar" title="Nurse Johnson">NJ</div>
                        <div class="staff-avatar" title="You">ME</div>
                    </div>
                </div>
            </div>
            <nav class="nav-buttons">
                <a href="http://localhost:8000/staff-triage-command#" class="btn btn-secondary">
                    <i class="fas fa-home"></i> Command Center <span class="shortcut">H</span>
                </a>
                <a href="/triage-form" class="btn btn-primary">
                    <i class="fas fa-plus"></i> New Triage <span class="shortcut">N</span>
                </a>
                <a href="/patient-list" class="btn btn-secondary">
                    <i class="fas fa-users"></i> Patient List <span class="shortcut">P</span>
                </a>
                <button onclick="triageDashboard.openShiftHandover()" class="btn btn-secondary">
                    <i class="fas fa-clipboard-list"></i> Shift Handover <span class="shortcut">S</span>
                </button>
                <button onclick="triageDashboard.openRealTimeChat()" class="btn btn-secondary" style="position: relative;">
                    <i class="fas fa-comments"></i> Real-Time Chat <span class="shortcut">C</span>
                    <div class="notification-badge" id="chat-badge" style="display: none;">3</div>
                </button>
            </nav>
        </div>
    </header>

    <div class="dashboard-layout">
        <!-- Live Data Indicator -->
        <div class="last-updated" id="last-updated">
            Last updated: <span id="update-time">--:--</span>
            <i class="fas fa-sync-alt refresh-indicator" id="refresh-icon"></i>
            Auto-refresh every 30 seconds
        </div>

        <!-- Stats Row -->
        <div class="stats-row">
            <div class="stat-card stat-total">
                <div class="stat-content">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-details">
                        <h3 id="total-patients" aria-live="polite">4</h3>
                        <p>Total Patients</p>
                    </div>
                </div>
            </div>
            <div class="stat-card stat-active">
                <div class="stat-content">
                    <div class="stat-icon">
                        <i class="fas fa-user-clock"></i>
                    </div>
                    <div class="stat-details">
                        <h3 id="active-patients" aria-live="polite">4</h3>
                        <p>Currently Active</p>
                    </div>
                </div>
            </div>
            <div class="stat-card stat-today">
                <div class="stat-content">
                    <div class="stat-icon">
                        <i class="fas fa-calendar-day"></i>
                    </div>
                    <div class="stat-details">
                        <h3 id="patients-today" aria-live="polite">4</h3>
                        <p>Admitted Today</p>
                    </div>
                </div>
            </div>
            <div class="stat-card stat-critical">
                <div class="stat-content">
                    <div class="stat-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="stat-details">
                        <h3 id="critical-alerts-count" aria-live="assertive">2</h3>
                        <p>Critical Alerts</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Operations Grid -->
        <div class="operations-grid">
            <!-- Main Column -->
            <div class="main-column">
                <!-- Priority Queue -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <div class="card-title-section">
                            <i class="fas fa-list-ol"></i>
                            <h3 class="card-title">Priority Queue</h3>
                        </div>
                        <div class="staff-presence">
                            <i class="fas fa-eye"></i>
                            <span>3 viewing</span>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="priority-queue" id="priority-queue-list" role="region" aria-label="Patient priority queue">
                            <!-- Patient items will be dynamically inserted here -->
                        </div>
                    </div>
                </div>

                <!-- AI Report Assistant -->
                <div class="tool-card">
                    <div class="tool-header">
                        <i class="fas fa-robot tool-icon"></i>
                        <h3 class="tool-title">Offline Report Assistant</h3>

                    </div>
                    <p class="tool-description">Draft a report here to get on-device AI feedback for clarity and completeness.</p>
                    <textarea 
                        id="draft-input" 
                        class="form-input" 
                        placeholder="Describe the emergency situation..." 
                        rows="4"
                        aria-label="Emergency report draft"
                    ></textarea>
                    <button class="action-button primary" onclick="triageDashboard.runOfflineAnalysis()">
                        <i class="fas fa-brain"></i> Analyze Draft
                    </button>
                    <div class="ai-feedback" id="draft-feedback" style="display:none;" aria-live="polite"></div>
                </div>
            </div>

            <!-- Sidebar Column -->
            <div class="sidebar-column">
                <!-- Critical AI Alerts -->
                <div class="dashboard-card">
                    <div class="card-header critical">
                        <div class="card-title-section">
                            <i class="fas fa-exclamation-triangle"></i>
                            <h3 class="card-title">Critical AI Alerts</h3>
                        </div>
                        <div class="notification-badge">2</div>
                    </div>
                    <div class="card-content" id="critical-alerts-list" role="region" aria-label="Critical patient alerts" aria-live="assertive">
                        <!-- Critical alerts will be populated here -->
                    </div>
                </div>

                <!-- Emergency Scenario Trainer -->
                <div class="tool-card">
                    <div class="tool-header">
                        <i class="fas fa-graduation-cap tool-icon"></i>
                        <h3 class="tool-title">Emergency Scenario Trainer</h3>
                    </div>
                    <p class="tool-description">Get AI-powered guidance for common emergency situations.</p>
                    <select 
                        id="scenario-select" 
                        class="form-input" 
                        onchange="triageDashboard.startScenario()"
                        aria-label="Emergency scenario selection"
                    >
                        <option value="">-- Select a Scenario --</option>
                        <option value="power_outage">Power Outage Response</option>
                        <option value="flooding">Minor Flooding Protocol</option>
                        <option value="earthquake">Post-Earthquake Assessment</option>
                        <option value="mass_casualty">Mass Casualty Triage</option>
                    </select>
                    <div class="ai-feedback" id="scenario-steps" style="display:none;" aria-live="polite"></div>
                </div>

                <!-- Intelligent Sync Queue -->
                <div class="tool-card">
                    <div class="tool-header">
                        <i class="fas fa-sync tool-icon"></i>
                        <h3 class="tool-title">Intelligent Sync Queue</h3>
                    </div>
                    <p class="tool-description">Reports saved offline, analyzed by on-device AI, and ready to sync.</p>
                    <div id="sync-queue-list" aria-live="polite">
                        <p>Last sync: <span id="last-sync-time">2 minutes ago</span></p>
                        <p>Sync queue is empty.</p>
                    </div>
                    <button class="action-button success" onclick="triageDashboard.syncNow()" style="margin-top: 1rem;">
                        <i class="fas fa-cloud-upload-alt"></i> Sync Now
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Shift Handover Modal -->
    <div class="modal" id="shift-handover-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-clipboard-list"></i>
                    Shift Handover Report
                </div>
                <button class="close-btn" onclick="triageDashboard.closeModal('shift-handover-modal')">&times;</button>
            </div>
            
            <div class="handover-section">
                <div class="handover-title">
                    <i class="fas fa-robot"></i> AI-Generated Shift Summary
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                    <div style="text-align: center; padding: 1rem; background: rgba(220, 38, 38, 0.1); border-radius: 8px;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: var(--color-red);">2</div>
                        <div style="font-size: 0.9rem;">Critical Patients</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: rgba(245, 158, 11, 0.1); border-radius: 8px;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: var(--color-yellow);">4</div>
                        <div style="font-size: 0.9rem;">Total Admissions</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: rgba(22, 163, 74, 0.1); border-radius: 8px;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: var(--color-green);">2</div>
                        <div style="font-size: 0.9rem;">Discharges</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: var(--ai-purple-light); border-radius: 8px;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: var(--ai-purple);">95%</div>
                        <div style="font-size: 0.9rem;">AI Accuracy</div>
                    </div>
                </div>
            </div>

            <div class="handover-section">
                <div class="handover-title">
                    <i class="fas fa-exclamation-triangle"></i> Critical Handover Items
                </div>
                <div class="critical-item">
                    <div class="critical-header">
                        <i class="fas fa-user-injured"></i>
                        John Smith - Room 203
                    </div>
                    <div>Chest trauma with low oxygen saturation. Monitor closely for respiratory distress. Last vitals: O2 88%.</div>
                    <div style="margin-top: 0.5rem; font-size: 0.9rem; color: var(--ai-purple);">
                        <i class="fas fa-robot"></i> AI: High priority monitoring - respiratory intervention may be needed
                    </div>
                </div>
                <div class="critical-item">
                    <div class="critical-header">
                        <i class="fas fa-heartbeat"></i>
                        Robert Wilson - Room 201
                    </div>
                    <div>Cardiac event in progress. Elevated heart rate detected. Cardiology consult requested.</div>
                    <div style="margin-top: 0.5rem; font-size: 0.9rem; color: var(--ai-purple);">
                        <i class="fas fa-robot"></i> AI: Continuous cardiac monitoring recommended
                    </div>
                </div>
            </div>

            <div class="form-grid">
                <div>
                    <div class="form-group">
                        <label class="form-label">Outgoing Staff</label>
                        <input type="text" class="form-input" placeholder="Your name" value="Dr. Sarah Chen">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Shift End Time</label>
                        <input type="time" class="form-input" value="19:00">
                    </div>
                </div>
                <div>
                    <div class="form-group">
                        <label class="form-label">Incoming Staff</label>
                        <select class="form-select">
                            <option>Select incoming staff</option>
                            <option>Dr. Martinez - Night Shift</option>
                            <option>Dr. Patel - Emergency</option>
                            <option>Nurse Wilson - ICU</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Shift Start Time</label>
                        <input type="time" class="form-input" value="19:30">
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Additional Handover Notes</label>
                <textarea class="form-input" rows="3" placeholder="Any additional critical information for the incoming team..."></textarea>
            </div>

            <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                <button class="action-button primary" onclick="triageDashboard.generateHandoverReport()" style="flex: 1;">
                    <i class="fas fa-robot"></i> AI Generate Report
                </button>
                <button class="action-button success" onclick="triageDashboard.completeHandover()" style="flex: 1;">
                    <i class="fas fa-check"></i> Complete Handover
                </button>
            </div>
        </div>
    </div>

    <!-- Real-Time Chat Modal -->
    <div class="modal" id="chat-modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-comments"></i>
                    Emergency Team Chat
                    <span style="background: var(--color-green); color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem; margin-left: 1rem;">
                        <i class="fas fa-circle" style="font-size: 0.6rem;"></i> 3 Online
                    </span>
                </div>
                <button class="close-btn" onclick="triageDashboard.closeModal('chat-modal')">&times;</button>
            </div>

            <!-- Active Users -->
            <div style="background: var(--bg-hover); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
                    <strong>Active Team:</strong>
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        <span style="background: var(--color-green); color: white; padding: 0.375rem 0.75rem; border-radius: 16px; font-size: 0.8rem;">
                            <i class="fas fa-user-md"></i> Dr. Chen (You)
                        </span>
                        <span style="background: var(--color-blue); color: white; padding: 0.375rem 0.75rem; border-radius: 16px; font-size: 0.8rem;">
                            <i class="fas fa-user-nurse"></i> Nurse Garcia
                        </span>
                        <span style="background: var(--color-yellow); color: white; padding: 0.375rem 0.75rem; border-radius: 16px; font-size: 0.8rem;">
                            <i class="fas fa-user-md"></i> Dr. Martinez
                        </span>
                    </div>
                </div>
            </div>

            <!-- Chat Messages -->
            <div class="chat-messages" id="chat-messages">
                <div class="chat-message">
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                        <div class="staff-avatar" style="width: 30px; height: 30px; font-size: 0.8rem; background: var(--color-blue);">NG</div>
                        <strong>Nurse Garcia</strong>
                        <span style="font-size: 0.8rem; color: var(--text-secondary);">2 min ago</span>
                    </div>
                    <div style="margin-left: 38px;">John Smith in Room 203 is asking for pain medication. Current pain level 7/10.</div>
                </div>

                <div class="chat-message">
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                        <div class="staff-avatar" style="width: 30px; height: 30px; font-size: 0.8rem; background: var(--ai-purple);">AI</div>
                        <strong style="color: var(--ai-purple);">AI Assistant</strong>
                        <span style="font-size: 0.8rem; color: var(--text-secondary);">1 min ago</span>
                    </div>
                    <div style="margin-left: 38px; background: var(--ai-purple-light); padding: 0.75rem; border-radius: 8px;">
                        <i class="fas fa-robot"></i> Patient John Smith: Last pain medication 4h ago. Recommend 2mg morphine IV. Monitor respiratory rate.
                    </div>
                </div>
            </div>

            <!-- Quick Messages -->
            <div class="quick-messages">
                <button class="quick-msg-btn urgent" onclick="triageDashboard.sendQuickMessage('🚨 Need immediate assistance')">
                    🚨 Need Assistance
                </button>
                <button class="quick-msg-btn" onclick="triageDashboard.sendQuickMessage('📋 Patient update available')">
                    📋 Patient Update
                </button>
                <button class="quick-msg-btn" onclick="triageDashboard.sendQuickMessage('☕ Taking break')">
                    ☕ Break Time
                </button>
                <button class="quick-msg-btn" onclick="triageDashboard.askAI()">
                    🤖 Ask AI
                </button>
            </div>

            <!-- Chat Input -->
            <div class="chat-input-container">
                <input type="text" id="chat-input" placeholder="Type your message to the team..." onkeypress="triageDashboard.handleChatKeypress(event)">
                <button class="send-btn" onclick="triageDashboard.sendChatMessage()">
                    <i class="fas fa-paper-plane"></i> Send
                </button>
            </div>
        </div>
    </div>

    <!-- Help Tooltip -->
    <div class="help-tooltip" onclick="triageDashboard.showShortcuts()" title="Show keyboard shortcuts (Press ?)">
        <i class="fas fa-question"></i>
    </div>

    <!-- Keyboard Shortcuts Overlay -->
    <div class="shortcuts-overlay" id="shortcuts-overlay" onclick="triageDashboard.hideShortcuts()">
        <div class="shortcuts-content" onclick="event.stopPropagation()">
            <h2>Keyboard Shortcuts</h2>
            <div class="shortcut-item">
                <span>New Triage</span>
                <span class="shortcut-key">N</span>
            </div>
            <div class="shortcut-item">
                <span>Patient List</span>
                <span class="shortcut-key">P</span>
            </div>
            <div class="shortcut-item">
                <span>Real-Time Chat</span>
                <span class="shortcut-key">C</span>
            </div>
            <div class="shortcut-item">
                <span>Shift Handover</span>
                <span class="shortcut-key">S</span>
            </div>
            <div class="shortcut-item">
                <span>Command Center</span>
                <span class="shortcut-key">H</span>
            </div>
            <div class="shortcut-item">
                <span>Show Help</span>
                <span class="shortcut-key">?</span>
            </div>
            <div class="shortcut-item">
                <span>Search Patients</span>
                <span class="shortcut-key">/</span>
            </div>
            <button class="action-button primary" onclick="triageDashboard.hideShortcuts()" style="margin-top: 1rem;">
                Close
            </button>
        </div>
    </div>

    <!-- Snackbar -->
    <div class="snackbar" id="snackbar"></div>

    <script>
        (function() {
            "use strict";

            const triageDashboard = {};

            // Mock Data
            const mockPatients = [
                { 
                    id: 1, 
                    name: 'John Smith', 
                    injury: 'Chest trauma', 
                    severity: 'critical', 
                    triage_color: 'red', 
                    priority_score: 1, 
                    timestamp: new Date(Date.now() - 5 * 60000),
                    vitals: 'Low oxygen saturation'
                },
                { 
                    id: 2, 
                    name: 'Robert Wilson', 
                    injury: 'Cardiac event', 
                    severity: 'urgent', 
                    triage_color: 'red', 
                    priority_score: 1, 
                    timestamp: new Date(Date.now() - 10 * 60000),
                    vitals: 'Elevated heart rate'
                },
                { 
                    id: 3, 
                    name: 'Maria Garcia', 
                    injury: 'Arm fracture', 
                    severity: 'moderate', 
                    triage_color: 'yellow', 
                    priority_score: 2, 
                    timestamp: new Date(Date.now() - 15 * 60000),
                    vitals: 'Stable'
                },
                { 
                    id: 4, 
                    name: 'Sarah Johnson', 
                    injury: 'Minor lacerations', 
                    severity: 'mild', 
                    triage_color: 'green', 
                    priority_score: 3, 
                    timestamp: new Date(Date.now() - 21 * 60000),
                    vitals: 'Normal'
                },
            ];

            const mockAlerts = [
                { 
                    patient: mockPatients[0], 
                    prediction: 'Low oxygen saturation, Critical condition requiring immediate intervention',
                    timestamp: new Date(Date.now() - 2 * 60000),
                    severity: 'critical'
                },
                { 
                    patient: mockPatients[1], 
                    prediction: 'Elevated heart rate detected, potential cardiac event in progress',
                    timestamp: new Date(Date.now() - 5 * 60000),
                    severity: 'urgent'
                },
            ];

            let lastActionTime = null;
            let refreshInterval;
            let chatNotifications = 3;

            // UI Update Functions
            function updateDashboardStats() {
                document.getElementById('total-patients').textContent = mockPatients.length;
                document.getElementById('active-patients').textContent = mockPatients.filter(p => p.status !== 'discharged').length;
                document.getElementById('patients-today').textContent = mockPatients.length;
                document.getElementById('critical-alerts-count').textContent = mockAlerts.length;
                
                updateLastUpdatedTime();
            }

            function updateLastUpdatedTime() {
                const now = new Date();
                document.getElementById('update-time').textContent = now.toLocaleTimeString();
                
                // Animate refresh icon
                const refreshIcon = document.getElementById('refresh-icon');
                refreshIcon.style.animation = 'none';
                setTimeout(() => {
                    refreshIcon.style.animation = 'spin 1s linear';
                }, 10);
            }

            function populatePriorityQueue() {
                const queueList = document.getElementById('priority-queue-list');
                const sortedPatients = mockPatients.sort((a, b) => {
                    if (a.priority_score !== b.priority_score) {
                        return a.priority_score - b.priority_score;
                    }
                    return new Date(a.timestamp) - new Date(b.timestamp);
                });

                if (sortedPatients.length === 0) {
                    queueList.innerHTML = '<div class="empty-state"><div class="empty-icon">📋</div><p>No active patients in the queue.</p></div>';
                    return;
                }

                queueList.innerHTML = sortedPatients.map((p, index) => `
                    <div class="queue-item ${p.priority_score === 1 ? 'critical' : ''}" 
                         onclick="triageDashboard.viewPatient(${p.id})" 
                         tabindex="0" 
                         role="button"
                         aria-label="Patient ${p.name}, Priority ${p.priority_score}, ${p.injury}"
                         data-patient-id="${p.id}">
                        <div class="queue-priority priority-${p.priority_score}" aria-label="Priority ${p.priority_score}">
                            ${p.priority_score}
                        </div>
                        <div class="queue-details">
                            <div class="queue-name">${p.name}</div>
                            <div class="queue-info">
                                <span>${p.injury}</span> • <span>${p.severity}</span> • <span>${p.vitals}</span>
                            </div>
                        </div>
                        <div class="queue-time">
                            ${getTimeAgo(p.timestamp)}
                        </div>
                    </div>
                `).join('');
            }

            function populateCriticalAlerts() {
                const alertsList = document.getElementById('critical-alerts-list');
                
                if (mockAlerts.length === 0) {
                    alertsList.innerHTML = '<div class="empty-state"><p>No critical alerts at this time.</p></div>';
                    return;
                }

                alertsList.innerHTML = mockAlerts.map(alert => `
                    <div class="alert-item" 
                         onclick="triageDashboard.viewAlert(${alert.patient.id})" 
                         tabindex="0" 
                         role="button"
                         aria-label="Critical alert for ${alert.patient.name}">
                        <div class="alert-header">
                            <i class="fas fa-exclamation-triangle" style="color: var(--color-red);"></i>
                            <span>${alert.patient.name}</span>
                            <span style="font-size: 0.7rem; color: var(--text-secondary);">${getTimeAgo(alert.timestamp)}</span>
                        </div>
                        <div class="alert-details">${alert.prediction}</div>
                    </div>
                `).join('');
            }

            function getTimeAgo(timestamp) {
                const now = new Date();
                const diff = Math.floor((now - timestamp) / 60000); // minutes
                if (diff < 1) return 'Just now';
                if (diff < 60) return `${diff}m ago`;
                const hours = Math.floor(diff / 60);
                if (hours < 24) return `${hours}h ago`;
                return `${Math.floor(hours / 24)}d ago`;
            }

            // Snackbar System
            function showSnackbar(message, duration = 3000) {
                const snackbar = document.getElementById('snackbar');
                snackbar.textContent = message;
                snackbar.style.display = 'block';
                
                setTimeout(() => {
                    snackbar.style.display = 'none';
                }, duration);
            }

            // Patient and Alert Functions
            triageDashboard.viewPatient = function(patientId) {
                const patient = mockPatients.find(p => p.id === patientId);
                if (patient) {
                    showSnackbar(`Opening detailed view for ${patient.name}`);
                    console.log('Viewing patient:', patient);
                }
            };

            triageDashboard.viewAlert = function(patientId) {
                const alert = mockAlerts.find(a => a.patient.id === patientId);
                if (alert) {
                    showSnackbar(`Reviewing critical alert for ${alert.patient.name}`);
                    console.log('Viewing alert:', alert);
                }
            };

            // NEW MODAL FUNCTIONS
            triageDashboard.openShiftHandover = function() {
                document.getElementById('shift-handover-modal').style.display = 'block';
                showSnackbar('📋 Opening shift handover interface...');
            };

            triageDashboard.openRealTimeChat = function() {
                document.getElementById('chat-modal').style.display = 'block';
                // Reset chat notifications
                chatNotifications = 0;
                updateChatBadge();
                // Focus on chat input
                setTimeout(() => {
                    const chatInput = document.getElementById('chat-input');
                    if (chatInput) chatInput.focus();
                }, 100);
                showSnackbar('💬 Real-time team chat active');
            };

            triageDashboard.closeModal = function(modalId) {
                document.getElementById(modalId).style.display = 'none';
            };

            triageDashboard.generateHandoverReport = function() {
                showSnackbar('🤖 AI generating comprehensive handover report...');
                setTimeout(() => {
                    showSnackbar('✅ Handover report generated with AI insights');
                }, 2000);
            };

            triageDashboard.completeHandover = function() {
                showSnackbar('✅ Shift handover completed successfully');
                triageDashboard.closeModal('shift-handover-modal');
            };

            triageDashboard.sendChatMessage = function() {
                const chatInput = document.getElementById('chat-input');
                const message = chatInput.value.trim();
                
                if (!message) return;
                
                // Add message to chat
                const chatMessages = document.getElementById('chat-messages');
                const messageHtml = `
                    <div class="chat-message">
                        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                            <div class="staff-avatar" style="width: 30px; height: 30px; font-size: 0.8rem; background: var(--color-green);">ME</div>
                            <strong>You</strong>
                            <span style="font-size: 0.8rem; color: var(--text-secondary);">Just now</span>
                        </div>
                        <div style="margin-left: 38px; background: #e3f2fd; padding: 0.75rem; border-radius: 8px;">
                            ${message}
                        </div>
                    </div>
                `;
                
                chatMessages.insertAdjacentHTML('beforeend', messageHtml);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                chatInput.value = '';
                showSnackbar('💬 Message sent to team');
            };

            triageDashboard.sendQuickMessage = function(message) {
                const chatInput = document.getElementById('chat-input');
                chatInput.value = message;
                triageDashboard.sendChatMessage();
            };

            triageDashboard.askAI = function() {
                const chatInput = document.getElementById('chat-input');
                chatInput.value = 'AI: ';
                chatInput.focus();
                showSnackbar('🤖 AI assistant ready - type your question');
            };

            triageDashboard.handleChatKeypress = function(event) {
                if (event.key === 'Enter') {
                    triageDashboard.sendChatMessage();
                }
            };

            function updateChatBadge() {
                const badge = document.getElementById('chat-badge');
                if (chatNotifications > 0) {
                    badge.textContent = chatNotifications;
                    badge.style.display = 'flex';
                } else {
                    badge.style.display = 'none';
                }
            }

            // AI Tool Functions
            triageDashboard.runOfflineAnalysis = function() {
                const draftInput = document.getElementById('draft-input');
                const feedbackPanel = document.getElementById('draft-feedback');
                
                if (!draftInput.value.trim()) {
                    feedbackPanel.innerHTML = '<i class="fas fa-exclamation-circle"></i> Please enter a description to analyze.';
                    feedbackPanel.style.display = 'block';
                    return;
                }

                feedbackPanel.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Analyzing draft with on-device AI...';
                feedbackPanel.style.display = 'block';
                
                setTimeout(() => {
                    let feedback = [];
                    const text = draftInput.value.toLowerCase();
                    
                    // AI Analysis Logic
                    if (text.length > 50) {
                        feedback.push('✅ Report has good detail level');
                    } else {
                        feedback.push('💡 Consider adding more detail');
                    }
                    
                    if (!text.match(/\d+/g)) {
                        feedback.push('💡 Consider adding numbers (e.g., people involved, vital signs)');
                    }
                    
                    if (!text.includes('location') && !text.includes('address')) {
                        feedback.push('💡 Location information would be helpful');
                    }
                    
                    if (text.includes('critical') || text.includes('urgent')) {
                        feedback.push('⚠️ Critical/urgent situation detected - ensure immediate attention');
                    }
                    
                    if (feedback.length === 0) {
                        feedback.push('✅ Report looks comprehensive');
                    }
                    
                    feedbackPanel.innerHTML = `
                        <strong><i class="fas fa-brain"></i> AI Feedback:</strong><br>
                        ${feedback.map(f => `• ${f}`).join('<br>')}
                    `;
                }, 1500);
            };

            triageDashboard.startScenario = function() {
                const scenario = document.getElementById('scenario-select').value;
                const stepsPanel = document.getElementById('scenario-steps');
                
                if (!scenario) {
                    stepsPanel.style.display = 'none';
                    return;
                }

                const scenarios = {
                    power_outage: [
                        'Assess critical equipment on backup power',
                        'Check generator fuel levels and functionality',
                        'Prioritize patients on life support',
                        'Establish communication with utility company',
                        'Consider patient transfers if prolonged outage'
                    ],
                    flooding: [
                        'Evacuate patients from affected areas',
                        'Secure medical equipment and records',
                        'Establish alternative access routes',
                        'Monitor for contamination risks',
                        'Document all evacuations and transfers'
                    ],
                    earthquake: [
                        'Conduct immediate safety assessment',
                        'Account for all patients and staff',
                        'Assess medical equipment functionality',
                        'Prepare for potential aftershocks'
                    ],
                    mass_casualty: [
                        'Activate mass casualty protocol',
                        'Establish triage areas (Red, Yellow, Green)',
                        'Assign triage officers to each area',
                        'Request additional resources',
                        'Document all patient classifications'
                    ]
                };

                const steps = scenarios[scenario] || ['No guidance available for this scenario'];
                
                stepsPanel.innerHTML = `
                    <strong><i class="fas fa-list-check"></i> ${scenario.replace('_', ' ').toUpperCase()} Protocol:</strong>
                    <ol style="margin-top: 0.5rem; padding-left: 1.5rem;">
                        ${steps.map(step => `<li style="margin-bottom: 0.5rem;">${step}</li>`).join('')}
                    </ol>
                `;
                stepsPanel.style.display = 'block';
            };

            triageDashboard.syncNow = function() {
                showSnackbar('Syncing offline reports with central system...');
                
                // Simulate sync process
                setTimeout(() => {
                    document.getElementById('last-sync-time').textContent = 'Just now';
                    showSnackbar('✅ Sync completed successfully');
                }, 2000);
            };

            // Keyboard Shortcuts
            triageDashboard.showShortcuts = function() {
                document.getElementById('shortcuts-overlay').style.display = 'block';
            };

            triageDashboard.hideShortcuts = function() {
                document.getElementById('shortcuts-overlay').style.display = 'none';
            };

            // Connection Status Simulation
            function updateConnectionStatus() {
                const statusElement = document.getElementById('connection-status');
                const statusText = document.getElementById('status-text');
                
                // Simulate occasional offline status
                const isOnline = Math.random() > 0.1; // 90% online
                
                if (isOnline) {
                    statusElement.className = 'status-item status-online';
                    statusText.textContent = 'Online';
                } else {
                    statusElement.className = 'status-item status-offline';
                    statusText.textContent = 'Offline';
                    showSnackbar('⚠️ Connection lost - working in offline mode', 5000);
                }
            }

            // Auto-refresh and Real-time Updates
            function startAutoRefresh() {
                refreshInterval = setInterval(() => {
                    updateDashboardStats();
                    populatePriorityQueue();
                    populateCriticalAlerts();
                    
                    // Simulate new chat messages occasionally
                    if (Math.random() > 0.8) {
                        chatNotifications++;
                        updateChatBadge();
                    }
                }, 30000); // Every 30 seconds
            }

            // Keyboard Event Handlers
            document.addEventListener('keydown', function(event) {
                // Don't trigger shortcuts if user is typing in an input
                if (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA' || event.target.tagName === 'SELECT') {
                    return;
                }

                switch(event.key.toLowerCase()) {
                    case 'n':
                        window.location.href = '/triage-form';
                        break;
                    case 'p':
                        window.location.href = '/patient-list';
                        break;
                    case 'c':
                        triageDashboard.openRealTimeChat();
                        break;
                    case 's':
                        triageDashboard.openShiftHandover();
                        break;
                    case 'h':
                        window.location.href = 'http://localhost:8000/staff-triage-command#';
                        break;
                    case '?':
                        triageDashboard.showShortcuts();
                        break;
                    case '/':
                        event.preventDefault();
                        showSnackbar('Patient search feature coming soon...');
                        break;
                    case 'escape':
                        triageDashboard.hideShortcuts();
                        // Close any open modals
                        triageDashboard.closeModal('shift-handover-modal');
                        triageDashboard.closeModal('chat-modal');
                        break;
                }
            });

            // Queue item keyboard navigation
            document.addEventListener('keydown', function(event) {
                const focusedElement = document.activeElement;
                if (focusedElement && focusedElement.classList.contains('queue-item')) {
                    if (event.key === 'Enter' || event.key === ' ') {
                        event.preventDefault();
                        focusedElement.click();
                    }
                }
            });

            // Modal click outside to close
            document.addEventListener('click', function(event) {
                if (event.target.classList.contains('modal')) {
                    const modalId = event.target.id;
                    triageDashboard.closeModal(modalId);
                }
            });

            // Initialize Dashboard
            document.addEventListener('DOMContentLoaded', function() {
                updateDashboardStats();
                populatePriorityQueue();
                populateCriticalAlerts();
                updateChatBadge();
                startAutoRefresh();
                
                // Initial connection status check
                updateConnectionStatus();
                
                // Check connection status every minute
                setInterval(updateConnectionStatus, 60000);
                
                // Welcome message
                setTimeout(() => {
                    showSnackbar('Welcome to Emergency Triage Dashboard - Press ? for shortcuts');
                }, 1000);
                
                // Expose to global scope
                window.triageDashboard = triageDashboard;
            });

            // Cleanup on page unload
            window.addEventListener('beforeunload', function() {
                if (refreshInterval) {
                    clearInterval(refreshInterval);
                }
            });

        })();
    </script>
</body>
</html>