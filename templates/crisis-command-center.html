<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemma 3n Emergency Command Center - AI-Powered Disaster Response</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.css" />
    <style>
        :root {
            --primary-color: #1e40af;
            --primary-dark: #1e3a8a;
            --secondary-color: #6b7280;
            --color-critical: #dc2626;
            --color-warning: #f59e0b;
            --color-good: #f59e0b;
            --color-optimal: #16a34a;
            --bg-color-base: #ffffff;
            --bg-color-card: #ffffff;
            --bg-color-light: #f8fafc;
            --text-color-base: #1f2937;
            --text-color-light: #6b7280;
            --text-color-inverted: #ffffff;
            --border-color: #e5e7eb;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            --gemma-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --ai-accent: #8b5cf6;
            --critical-glow: 0 0 20px rgba(220, 38, 38, 0.3);
            --warning-glow: 0 0 15px rgba(245, 158, 11, 0.3);
            --success-glow: 0 0 15px rgba(22, 163, 74, 0.3);
        }

        [data-theme="dark"] {
            --bg-color-base: #1f2937;
            --bg-color-card: #374151;
            --bg-color-light: #4b5563;
            --text-color-base: #f9fafb;
            --text-color-light: #d1d5db;
            --border-color: #4b5563;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-color-base);
            color: var(--text-color-base);
            line-height: 1.6;
            overflow-x: hidden;
        }
    </style>
    <style>
        /* Enhanced Status & Role Badge */
        .status-role-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 10001;
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            color: white;
            padding: 0.5rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
            font-weight: 600;
            box-shadow: var(--shadow-md);
        }

        .role-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.2);
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .connection-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--color-optimal);
            animation: pulse 2s infinite;
        }

        .connection-dot.offline {
            background: var(--color-critical);
            animation: blink 1s infinite;
        }

        /* Persistent Quick Actions Bar */
        .quick-actions-bar {
            position: fixed;
            top: 40px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .quick-action {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 0.75rem 1rem;
            font-size: 0.8rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-md);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            white-space: nowrap;
            min-width: 140px;
            outline: none;
        }

        .quick-action:hover,
        .quick-action:focus {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .quick-action.critical {
            background: var(--color-critical);
        }

        .quick-action.ai {
            background: var(--ai-accent);
        }

        .quick-action.success {
            background: var(--color-optimal);
        }

        /* Offline Banner */
        .offline-banner {
            position: fixed;
            top: 40px;
            left: 0;
            right: 0;
            background: var(--color-warning);
            color: white;
            text-align: center;
            padding: 0.75rem;
            font-weight: 700;
            z-index: 10000;
            transform: translateY(-100%);
            transition: transform 0.3s ease;
        }

        .offline-banner.show {
            transform: translateY(0);
        }
    </style>
    <style>
        /* Integrated Chat Panel */
        .chat-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 350px;
            height: 400px;
            background: var(--bg-color-card);
            border-radius: 16px;
            box-shadow: var(--shadow-xl);
            border: 2px solid var(--border-color);
            z-index: 9999;
            transform: translateY(420px);
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .chat-panel.open {
            transform: translateY(0);
        }

        .chat-header {
            background: var(--primary-color);
            color: white;
            padding: 1rem;
            border-radius: 14px 14px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 700;
        }

        .chat-messages {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            max-height: 300px;
        }

        .chat-message {
            margin-bottom: 1rem;
            padding: 0.75rem;
            border-radius: 12px;
            background: var(--bg-color-light);
            border-left: 3px solid var(--primary-color);
        }

        .chat-message.urgent {
            border-left-color: var(--color-critical);
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
        }

        .chat-input {
            padding: 1rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 0.5rem;
        }

        .chat-input input {
            flex: 1;
            padding: 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.9rem;
            outline: none;
        }

        .chat-input input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(30, 64, 175, 0.2);
        }

        /* Response Templates Modal */
        .response-templates {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 600px;
            max-height: 80vh;
            background: var(--bg-color-card);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: var(--shadow-xl);
            z-index: 10002;
            overflow-y: auto;
        }

        .template-card {
            background: var(--bg-color-light);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-left: 4px solid var(--primary-color);
            cursor: pointer;
            transition: all 0.3s ease;
            outline: none;
        }

        .template-card:hover,
        .template-card:focus {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .template-card.critical {
            border-left-color: var(--color-critical);
        }

        .template-card.medical {
            border-left-color: var(--color-warning);
        }
    </style>
    <style>
        /* Enhanced Keyboard Navigation */
        .keyboard-hint {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--text-color-base);
            color: var(--text-color-inverted);
            font-size: 0.7rem;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-weight: 700;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .nav-item:focus .keyboard-hint,
        .btn:focus .keyboard-hint,
        .quick-action:focus .keyboard-hint {
            opacity: 1;
        }

        /* Screen Reader Support */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .aria-live-region {
            position: absolute;
            left: -10000px;
            width: 1px;
            height: 1px;
            overflow: hidden;
        }

        /* Focus Enhancement */
        .nav-item:focus,
        .btn:focus,
        .quick-action:focus,
        .template-card:focus,
        .stat-card:focus,
        .incident-card:focus {
            outline: 3px solid var(--primary-color);
            outline-offset: 2px;
        }

        /* High Contrast Support */
        .high-contrast {
            --border-color: #000000;
            --text-color-light: #000000;
        }

        .high-contrast .btn {
            border: 3px solid #000000 !important;
        }

        /* Animations */
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.2); }
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-3px); }
            60% { transform: translateY(-1px); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        @keyframes gemmaGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(102, 126, 234, 0.3); }
            50% { box-shadow: 0 0 30px rgba(102, 126, 234, 0.6); }
        }

        @keyframes modalSlideIn {
            from { opacity: 0; transform: scale(0.9) translateY(-20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }
    </style>
    <style>
        /* Enhanced Gemma 3n Status Indicator */
        .gemma-status {
            position: fixed;
            top: 50px;
            right: 180px;
            z-index: 9999;
            background: var(--gemma-gradient);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: bold;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            animation: gemmaGlow 3s ease-in-out infinite;
            cursor: pointer;
            outline: none;
        }

        .gemma-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #10b981;
            animation: pulse 2s infinite;
        }

        .gemma-indicator.loading {
            background: #f59e0b;
            animation: blink 1s infinite;
        }

        .gemma-indicator.error {
            background: #dc2626;
            animation: none;
        }

        /* Enhanced Header */
        .main-header {
            background: linear-gradient(135deg, var(--color-critical) 0%, #991b1b 100%);
            color: var(--text-color-inverted);
            padding: 1.2rem 2rem;
            position: fixed;
            top: 40px;
            left: 0;
            right: 0;
            z-index: 1000;
            box-shadow: var(--shadow-xl);
            border-bottom: 3px solid rgba(255, 255, 255, 0.2);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .logo {
            font-size: 2.5rem;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            outline: none;
        }

        .logo:focus {
            outline: 3px solid rgba(255, 255, 255, 0.8);
            outline-offset: 4px;
        }

        .header-info h1 {
            font-size: 1.8rem;
            margin-bottom: 0.25rem;
            font-weight: 900;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        .header-info p {
            opacity: 0.95;
            font-size: 1rem;
            font-weight: 500;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .alert-level {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1.5rem;
            background: rgba(255, 255, 255, 0.25);
            border-radius: 25px;
            font-weight: 900;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: var(--critical-glow);
            outline: none;
        }

        .alert-level:hover,
        .alert-level:focus {
            background: rgba(255, 255, 255, 0.35);
            transform: scale(1.05);
        }

        .alert-level .alert-icon {
            font-size: 1.3rem;
            animation: bounce 1s infinite;
        }

        .header-controls {
            display: flex;
            gap: 0.75rem;
        }

        .header-btn {
            padding: 0.75rem 1.25rem;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            color: var(--text-color-inverted);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            outline: none;
        }

        .header-btn:hover,
        .header-btn:focus {
            background: rgba(255, 255, 255, 0.35);
            transform: translateY(-1px);
        }

        /* Enhanced Navigation */
        .main-nav {
            position: fixed;
            top: 125px;
            left: 0;
            width: 300px;
            height: calc(100vh - 125px);
            background: var(--bg-color-card);
            border-right: 2px solid var(--border-color);
            z-index: 999;
            overflow-y: auto;
            padding: 1.5rem;
            box-shadow: var(--shadow-lg);
        }

        .nav-section {
            margin-bottom: 2.5rem;
        }

        .nav-title {
            font-size: 0.8rem;
            font-weight: 900;
            text-transform: uppercase;
            color: var(--text-color-light);
            margin-bottom: 1rem;
            padding: 0 0.75rem;
            letter-spacing: 0.05em;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.25rem;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 0.5rem;
            font-weight: 600;
            border: 2px solid transparent;
            position: relative;
            outline: none;
        }

        .nav-item:hover,
        .nav-item:focus {
            background: var(--bg-color-light);
            transform: translateX(3px);
        }

        .nav-item.active {
            background: var(--primary-color);
            color: var(--text-color-inverted);
            box-shadow: var(--shadow-md);
            border-color: var(--primary-dark);
        }

        .nav-item.ai-powered {
            background: var(--gemma-gradient);
            color: white;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-md);
        }

        .nav-item.ai-powered::after {
            content: 'ðŸ§  Gemma 3n';
            position: absolute;
            top: -3px;
            right: -3px;
            background: rgba(255, 255, 255, 0.95);
            color: var(--ai-accent);
            font-size: 0.65rem;
            padding: 0.3rem 0.5rem;
            border-radius: 0 10px 0 10px;
            font-weight: 900;
            text-shadow: none;
        }

        .nav-icon {
            font-size: 1.4rem;
            width: 24px;
            text-align: center;
        }

        .alert-count {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 24px;
            height: 24px;
            background: var(--color-critical);
            color: white;
            border-radius: 50%;
            font-weight: 900;
            font-size: 0.8rem;
            margin-left: auto;
            animation: bounce 2s infinite;
        }
    </style>
    <style>
        /* Enhanced Main Content */
        .main-content {
            margin-left: 300px;
            margin-top: 125px;
            padding: 2.5rem;
            min-height: calc(100vh - 125px);
        }

        /* Breadcrumb Navigation */
        .breadcrumb {
            background: var(--bg-color-light);
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 2rem;
        }

        .breadcrumb-item {
            color: var(--text-color-light);
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .breadcrumb-item:hover {
            color: var(--primary-color);
        }

        .breadcrumb-item.active {
            color: var(--primary-color);
            font-weight: 700;
        }

        .dashboard-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .dashboard-section.active {
            display: block;
        }

        /* Enhanced Panels */
        .panel {
            background: var(--bg-color-card);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: var(--shadow-md);
            border: 2px solid var(--border-color);
            position: relative;
            margin-bottom: 2rem;
        }

        .panel.critical {
            border-color: var(--color-critical);
            box-shadow: var(--critical-glow);
        }

        .panel.warning {
            border-color: var(--color-warning);
            box-shadow: var(--warning-glow);
        }

        .panel.ai-enhanced {
            border-color: var(--ai-accent);
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.2);
        }

        .panel.ai-enhanced::before {
            content: 'ðŸ§  AI Enhanced';
            position: absolute;
            top: 12px;
            right: 12px;
            background: var(--ai-accent);
            color: white;
            padding: 0.4rem 0.8rem;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 900;
            z-index: 10;
            box-shadow: var(--shadow-sm);
        }

        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 3px solid var(--border-color);
        }

        .panel-title {
            font-size: 1.4rem;
            font-weight: 900;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: var(--text-color-base);
        }

        .panel-title-icon {
            font-size: 1.6rem;
        }

        /* Critical Alerts */
        .critical-alerts {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border: 3px solid var(--color-critical);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            outline: none;
        }

        .critical-alerts:hover,
        .critical-alerts:focus {
            transform: translateY(-2px);
            box-shadow: var(--shadow-xl), var(--critical-glow);
        }

        .critical-alerts::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--color-critical);
            animation: pulse 2s infinite;
        }

        /* Enhanced Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .stat-card {
            background: var(--bg-color-card);
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            box-shadow: var(--shadow-md);
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
            position: relative;
            cursor: pointer;
            outline: none;
        }

        .stat-card:hover,
        .stat-card:focus {
            transform: translateY(-5px);
            box-shadow: var(--shadow-xl);
        }

        .stat-card.ai-enhanced {
            background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%);
            border-color: var(--ai-accent);
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.2);
        }

        .stat-card.critical {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border-color: var(--color-critical);
            box-shadow: var(--critical-glow);
        }

        .stat-value {
            font-size: 3rem;
            font-weight: 900;
            color: var(--primary-color);
            margin-bottom: 0.75rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .stat-value.ai-value {
            color: var(--ai-accent);
        }

        .stat-value.critical-value {
            color: var(--color-critical);
        }

        .stat-label {
            color: var(--text-color-base);
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .stat-trend {
            font-size: 0.9rem;
            margin-top: 0.75rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.25rem;
        }

        .trend-up { color: var(--color-optimal); }
        .trend-down { color: var(--color-critical); }
        .trend-stable { color: var(--color-warning); }

        /* Live Indicators */
        .live-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .live-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #10b981;
            animation: pulse 2s infinite;
        }

        .last-updated {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
            color: var(--text-color-light);
            margin-top: 0.5rem;
        }

        .last-updated.stale {
            color: var(--color-warning);
        }

        .last-updated.error {
            color: var(--color-critical);
        }

        /* Map Container */
        .map-container {
            height: 500px;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid var(--border-color);
            background: var(--bg-color-light);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            cursor: pointer;
            outline: none;
        }

        .map-placeholder {
            text-align: center;
            color: var(--text-color-light);
        }

        .map-controls {
            position: absolute;
            top: 1rem;
            right: 1rem;
            display: flex;
            gap: 0.5rem;
        }

        .map-btn {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            outline: none;
        }

        .map-btn:hover,
        .map-btn:focus {
            background: white;
            box-shadow: var(--shadow-sm);
        }

        /* AI Insights */
        .insight-item {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-left: 5px solid var(--ai-accent);
            box-shadow: var(--shadow-sm);
            transition: all 0.3s ease;
            position: relative;
            cursor: pointer;
            outline: none;
        }

        .insight-item:hover,
        .insight-item:focus {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .insight-item.critical {
            border-left-color: var(--color-critical);
            background: linear-gradient(135deg, #fef2f2 0%, #ffffff 100%);
        }

        .insight-item.warning {
            border-left-color: var(--color-warning);
            background: linear-gradient(135deg, #fffbeb 0%, #ffffff 100%);
        }

        .insight-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .insight-title {
            font-weight: 900;
            color: var(--text-color-base);
            font-size: 1.1rem;
        }

        .confidence-badge {
            background: var(--ai-accent);
            color: white;
            padding: 0.4rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 900;
            box-shadow: var(--shadow-sm);
        }

        .confidence-badge.high {
            background: var(--color-optimal);
        }

        .confidence-badge.critical {
            background: var(--color-critical);
        }

        .insight-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .insight-description {
            color: var(--text-color-base);
            line-height: 1.6;
            margin-bottom: 1rem;
        }
    </style>
    <style>
        .trend-up { color: var(--color-optimal); }
        .trend-down { color: var(--color-critical); }
        .trend-stable { color: var(--color-warning); }

        /* Enhanced Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            font-size: 0.9rem;
            position: relative;
            overflow: hidden;
            outline: none;
        }

        .btn:hover,
        .btn:focus {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-primary {
            background: var(--primary-color);
            color: var(--text-color-inverted);
            border: 2px solid var(--primary-dark);
        }

        .btn-critical {
            background: var(--color-critical);
            color: white;
            border: 2px solid #991b1b;
            box-shadow: var(--critical-glow);
        }

        .btn-ai {
            background: var(--ai-accent);
            color: white;
            position: relative;
            overflow: hidden;
            border: 2px solid #7c3aed;
        }

        .btn-ai::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s ease;
        }

        .btn-ai:hover::before {
            left: 100%;
        }

        /* Incident and Resource Cards */
        .incident-card {
            background: var(--bg-color-card);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-left: 4px solid var(--color-warning);
            box-shadow: var(--shadow-sm);
            transition: all 0.3s ease;
            cursor: pointer;
            outline: none;
        }

        .incident-card:hover,
        .incident-card:focus {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .incident-card.critical {
            border-left-color: var(--color-critical);
            background: linear-gradient(135deg, #fef2f2 0%, #ffffff 100%);
        }

        .incident-card.high {
            border-left-color: var(--color-warning);
        }

        .incident-card.resolved {
            border-left-color: var(--color-optimal);
            opacity: 0.7;
        }

        .incident-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .incident-status {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 700;
        }

        .status-active {
            background: var(--color-critical);
            color: white;
        }

        .status-responding {
            background: var(--color-warning);
            color: white;
        }

        .status-resolved {
            background: var(--color-optimal);
            color: white;
        }

        /* Live Indicators */
        .live-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .live-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #10b981;
            animation: pulse 2s infinite;
        }

        .last-updated {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
            color: var(--text-color-light);
            margin-top: 0.5rem;
        }

        .last-updated.stale {
            color: var(--color-warning);
        }

        .last-updated.error {
            color: var(--color-critical);
        }

        /* Help System */
        .help-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--ai-accent);
            color: white;
            font-size: 0.8rem;
            font-weight: 900;
            cursor: pointer;
            margin-left: 0.5rem;
            transition: all 0.3s ease;
            position: relative;
        }

        .help-icon:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-md);
        }

        .tooltip {
            position: absolute;
            bottom: 130%;
            left: 50%;
            transform: translateX(-50%);
            background: #1f2937;
            color: white;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 500;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 1000;
            box-shadow: var(--shadow-lg);
            max-width: 250px;
            white-space: normal;
            text-align: center;
        }

        .tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: #1f2937;
        }

        .help-icon:hover .tooltip {
            opacity: 1;
            visibility: visible;
        }

        /* Modal System */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10001;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: var(--bg-color-card);
            border-radius: 16px;
            padding: 2rem;
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            margin: 2rem;
            box-shadow: var(--shadow-xl);
            position: relative;
            animation: modalSlideIn 0.3s ease;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border-color);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-color-light);
            transition: all 0.3s ease;
            outline: none;
        }

        .modal-close:hover,
        .modal-close:focus {
            color: var(--color-critical);
            transform: scale(1.1);
        }

        /* Map Container */
        .map-container {
            height: 500px;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid var(--border-color);
            background: var(--bg-color-light);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            cursor: pointer;
            outline: none;
        }

        .map-placeholder {
            text-align: center;
            color: var(--text-color-light);
        }

        .map-controls {
            position: absolute;
            top: 1rem;
            right: 1rem;
            display: flex;
            gap: 0.5rem;
        }

        .map-btn {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            outline: none;
        }

        .map-btn:hover,
        .map-btn:focus {
            background: white;
            box-shadow: var(--shadow-sm);
        }

        /* AI Insights */
        .insight-item {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-left: 5px solid var(--ai-accent);
            box-shadow: var(--shadow-sm);
            transition: all 0.3s ease;
            position: relative;
            cursor: pointer;
            outline: none;
        }

        .insight-item:hover,
        .insight-item:focus {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .insight-item.critical {
            border-left-color: var(--color-critical);
            background: linear-gradient(135deg, #fef2f2 0%, #ffffff 100%);
        }

        .insight-item.warning {
            border-left-color: var(--color-warning);
            background: linear-gradient(135deg, #fffbeb 0%, #ffffff 100%);
        }

        .insight-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .insight-title {
            font-weight: 900;
            color: var(--text-color-base);
            font-size: 1.1rem;
        }

        .confidence-badge {
            background: var(--ai-accent);
            color: white;
            padding: 0.4rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 900;
            box-shadow: var(--shadow-sm);
        }

        .confidence-badge.high {
            background: var(--color-optimal);
        }

        .confidence-badge.critical {
            background: var(--color-critical);
        }

        .insight-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
    </style>
    <style>
        /* Mobile & Tablet Optimizations */
        @media (max-width: 1024px) {
            .quick-actions-bar {
                position: fixed;
                bottom: 80px;
                right: 10px;
                flex-direction: row;
                flex-wrap: wrap;
                max-width: calc(100vw - 20px);
            }

            .quick-action {
                min-width: auto;
                padding: 0.5rem 0.75rem;
                font-size: 0.75rem;
            }

            .chat-panel {
                width: calc(100vw - 20px);
                height: 300px;
                right: 10px;
                transform: translateY(320px);
            }

            .response-templates {
                width: calc(100vw - 20px);
                max-width: none;
                padding: 1rem;
            }

            .main-nav {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .main-nav.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .gemma-status {
                right: 10px;
                top: 50px;
            }
        }

        @media (max-width: 768px) {
            .status-role-bar {
                flex-direction: column;
                padding: 0.5rem;
                gap: 0.5rem;
            }

            .role-badge, .connection-status {
                font-size: 0.75rem;
            }

            .quick-actions-bar {
                bottom: 60px;
                gap: 0.25rem;
            }

            .chat-panel {
                height: 250px;
                transform: translateY(270px);
            }

            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .main-content {
                padding: 1.5rem;
                margin-top: 140px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .panel {
                padding: 1.5rem;
            }

            .modal-content {
                margin: 1rem;
                padding: 1.5rem;
            }

            .template-card {
                padding: 1rem;
            }

            .insight-actions {
                flex-direction: column;
            }

            .insight-actions .btn {
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .header-info h1 {
                font-size: 1.4rem;
            }

            .header-info p {
                font-size: 0.9rem;
            }

            .logo {
                font-size: 2rem;
            }

            .quick-action {
                padding: 0.4rem 0.6rem;
                font-size: 0.7rem;
                min-width: 100px;
            }

            .stat-value {
                font-size: 2.5rem;
            }

            .panel-title {
                font-size: 1.2rem;
            }

            .incident-card,
            .template-card {
                padding: 1rem;
            }

            .chat-panel {
                height: 200px;
                transform: translateY(220px);
            }
        }

        /* Print Styles */
        @media print {
            .status-role-bar,
            .quick-actions-bar,
            .chat-panel,
            .main-nav,
            .header-controls,
            .modal-overlay,
            .response-templates {
                display: none !important;
            }

            .main-content {
                margin-left: 0;
                margin-top: 0;
                padding: 1rem;
            }

            .main-header {
                position: static;
                background: #000 !important;
                color: #fff !important;
            }

            .panel {
                break-inside: avoid;
                border: 2px solid #000 !important;
                box-shadow: none !important;
            }

            .btn {
                border: 1px solid #000 !important;
                background: #fff !important;
                color: #000 !important;
            }
        }

        /* High Contrast Mode */
        @media (prefers-contrast: high) {
            :root {
                --border-color: #000000;
                --text-color-light: #000000;
                --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
                --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
                --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
                --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
            }

            .btn {
                border: 3px solid #000000 !important;
            }

            .nav-item,
            .quick-action,
            .stat-card,
            .incident-card,
            .template-card {
                border: 2px solid #000000 !important;
            }
        }

        /* Reduced Motion */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }

            .gemma-indicator {
                animation: none !important;
            }

            .live-dot {
                animation: none !important;
            }

            .alert-icon {
                animation: none !important;
            }
        }

        /* Dark Mode Enhancements */
        [data-theme="dark"] {
            --critical-glow: 0 0 20px rgba(220, 38, 38, 0.5);
            --warning-glow: 0 0 15px rgba(245, 158, 11, 0.5);
            --success-glow: 0 0 15px rgba(22, 163, 74, 0.5);
        }

        [data-theme="dark"] .chat-message {
            background: var(--bg-color-light);
            color: var(--text-color-base);
        }

        [data-theme="dark"] .template-card {
            background: var(--bg-color-light);
            color: var(--text-color-base);
        }

        [data-theme="dark"] .map-btn {
            background: rgba(55, 65, 81, 0.9);
            color: var(--text-color-base);
            border-color: var(--border-color);
        }

        [data-theme="dark"] .tooltip {
            background: #374151;
        }

        [data-theme="dark"] .tooltip::after {
            border-top-color: #374151;
        }
    </style>
</head>
<body>
    <!-- Status & Role Bar -->
    <div class="status-role-bar">
        <div class="role-badge">
            <span>ðŸ‘¤</span>
            <span>You are: <strong>Command Admin</strong></span>
        </div>
        <div class="connection-status">
            <div class="connection-dot" id="connectionDot"></div>
            <span id="connectionStatus">System Online - Auto-sync active</span>
        </div>
    </div>

    <!-- Offline Banner -->
    <div class="offline-banner" id="offlineBanner">
        ðŸ”Œ Connection Lost - Operating in offline mode. Auto-sync paused.
    </div>

    <!-- Persistent Quick Actions Bar -->
    <div class="quick-actions-bar">
        <button class="quick-action critical" onclick="createNewIncident()" tabindex="1" aria-label="Create new incident report">
            <span>ðŸš¨</span>
            <span>New Incident</span>
            <div class="keyboard-hint">Ctrl+N</div>
        </button>
        <button class="quick-action ai" onclick="assignResources()" tabindex="2" aria-label="AI-assisted resource assignment">
            <span>ðŸš’</span>
            <span>Assign Resources</span>
            <div class="keyboard-hint">Ctrl+R</div>
        </button>
        <button class="quick-action success" onclick="exportReport()" tabindex="3" aria-label="Export situation report">
            <span>ðŸ“Š</span>
            <span>Export Report</span>
            <div class="keyboard-hint">Ctrl+E</div>
        </button>
        <button class="quick-action" onclick="showResponseTemplates()" tabindex="4" aria-label="Quick response templates">
            <span>ðŸ“‹</span>
            <span>Templates</span>
            <div class="keyboard-hint">Ctrl+T</div>
        </button>
        <button class="quick-action ai" onclick="toggleChat()" tabindex="5" aria-label="Team communication chat">
            <span>ðŸ’¬</span>
            <span>Team Chat</span>
            <div class="keyboard-hint">Ctrl+M</div>
        </button>
    </div>

    <!-- Enhanced Gemma 3n Status Indicator -->
    <div class="gemma-status" id="gemmaStatus" onclick="showSystemStatus()" tabindex="6" aria-label="Gemma AI system status">
        <div class="gemma-indicator" id="gemmaIndicator"></div>
        <span id="gemmaStatusText">Initializing Gemma 3n...</span>
        <div class="live-indicator">
            <div class="live-dot"></div>
            <span>LIVE</span>
        </div>
    </div>

    <!-- Integrated Team Chat Panel -->
    <div class="chat-panel" id="chatPanel" role="complementary" aria-label="Team communication panel">
        <div class="chat-header">
            <h3>ðŸš¨ Command Chat</h3>
            <button onclick="toggleChat()" aria-label="Close chat" style="background: none; border: none; color: white; font-size: 1.2rem; cursor: pointer;">âœ•</button>
        </div>
        <div class="chat-messages" id="chatMessages" aria-live="polite">
            <!-- Chat messages will be populated by JavaScript -->
        </div>
        <div class="chat-input">
            <input type="text" placeholder="Type urgent message..." id="chatInput" aria-label="Chat message input">
            <button onclick="sendChatMessage()" class="btn btn-primary" style="padding: 0.5rem;" aria-label="Send message">Send</button>
        </div>
    </div>

    <!-- Response Templates Modal -->
    <div class="response-templates" id="responseTemplates" role="dialog" aria-labelledby="templatesTitle">
        <div class="modal-header">
            <h2 id="templatesTitle" style="color: var(--primary-color); font-weight: 900;">ðŸ“‹ Emergency Response Templates</h2>
            <button class="modal-close" onclick="hideResponseTemplates()" aria-label="Close templates">âœ•</button>
        </div>
        
        <div style="display: grid; gap: 1rem;">
            <div class="template-card critical" onclick="activateTemplate('mci')" tabindex="0" role="button" aria-label="Activate Mass Casualty Incident plan">
                <h3 style="color: var(--color-critical); font-weight: 900; margin-bottom: 0.5rem;">ðŸš‘ Mass Casualty Incident (MCI)</h3>
                <p>Activates triage protocols, medical surge capacity, and multi-agency coordination</p>
                <div style="font-size: 0.8rem; color: var(--text-color-light); margin-top: 0.5rem;">
                    <strong>Auto-deploys:</strong> Medical units, triage teams, command structure
                </div>
            </div>

            <div class="template-card critical" onclick="activateTemplate('hazmat')" tabindex="0" role="button" aria-label="Activate Hazmat response plan">
                <h3 style="color: var(--color-critical); font-weight: 900; margin-bottom: 0.5rem;">â˜¢ï¸ Hazmat Response</h3>
                <p>Chemical/biological incident protocols with evacuation zones and decontamination</p>
                <div style="font-size: 0.8rem; color: var(--text-color-light); margin-top: 0.5rem;">
                    <strong>Auto-deploys:</strong> Hazmat teams, evacuation units, air monitoring
                </div>
            </div>

            <div class="template-card medical" onclick="activateTemplate('structure-collapse')" tabindex="0" role="button" aria-label="Activate Structure Collapse plan">
                <h3 style="color: var(--color-warning); font-weight: 900; margin-bottom: 0.5rem;">ðŸ—ï¸ Structure Collapse / USAR</h3>
                <p>Urban Search & Rescue with heavy rescue equipment and specialist teams</p>
                <div style="font-size: 0.8rem; color: var(--text-color-light); margin-top: 0.5rem;">
                    <strong>Auto-deploys:</strong> USAR teams, heavy rescue, K-9 units
                </div>
            </div>

            <div class="template-card" onclick="activateTemplate('wildfire')" tabindex="0" role="button" aria-label="Activate Wildfire response plan">
                <h3 style="color: var(--primary-color); font-weight: 900; margin-bottom: 0.5rem;">ðŸ”¥ Wildfire Response</h3>
                <p>Extended attack operations with air support and evacuation coordination</p>
                <div style="font-size: 0.8rem; color: var(--text-color-light); margin-top: 0.5rem;">
                    <strong>Auto-deploys:</strong> Fire crews, aircraft, evacuation teams
                </div>
            </div>

            <div class="template-card" onclick="activateTemplate('severe-weather')" tabindex="0" role="button" aria-label="Activate Severe Weather plan">
                <h3 style="color: var(--primary-color); font-weight: 900; margin-bottom: 0.5rem;">ðŸŒªï¸ Severe Weather</h3>
                <p>Storm response with utility coordination and shelter operations</p>
                <div style="font-size: 0.8rem; color: var(--text-color-light); margin-top: 0.5rem;">
                    <strong>Auto-deploys:</strong> Emergency crews, shelter teams, utility liaisons
                </div>
            </div>
        </div>
    </div>
    <!-- Main Header -->
    <header class="main-header">
        <div class="header-content">
            <div class="header-left">
                <div class="logo" onclick="resetToDashboard()" tabindex="7" aria-label="Return to main dashboard">ðŸ§ </div>
                <div class="header-info">
                    <h1>Gemma 3n Emergency Operations Center</h1>
                    <p>AI-powered disaster response with 128K context awareness</p>
                </div>
            </div>
            
            <div class="header-right">
                <div class="alert-level" onclick="showNotificationCenter()" tabindex="8" aria-label="Current alert level 3 - click for details">
                    <span class="alert-icon">âš ï¸</span>
                    <span>ALERT LEVEL 3</span>
                    <div class="help-icon">
                        ?
                        <div class="tooltip">Current threat level based on active incidents, weather conditions, and AI risk assessment</div>
                    </div>
                </div>
                
                <div class="header-controls">
                    <button class="header-btn" onclick="toggleTheme()" tabindex="9" aria-label="Toggle dark/light theme">ðŸŒ“</button>
                    <button class="header-btn" onclick="toggleNav()" tabindex="10" aria-label="Toggle navigation menu">â˜°</button>
                    <button class="header-btn" onclick="showHelp()" tabindex="11" aria-label="Show help and keyboard shortcuts">â“</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="main-nav" id="mainNav" role="navigation" aria-label="Main navigation">
        <div class="nav-section">
            <div class="nav-title">AI Command & Control</div>
            <div class="nav-item active ai-powered" onclick="showSection('ai-command')" tabindex="12" role="button" aria-label="AI Command Center - Currently active">
                <div class="nav-icon">ðŸ§ </div>
                <div>AI Command Center</div>
                <div class="keyboard-hint">Alt+1</div>
            </div>
            <div class="nav-item ai-powered" onclick="showSection('context-intelligence')" tabindex="13" role="button" aria-label="Context Intelligence dashboard">
                <div class="nav-icon">ðŸ”®</div>
                <div>Context Intelligence</div>
                <div class="keyboard-hint">Alt+2</div>
            </div>
            <div class="nav-item ai-powered" onclick="showSection('predictive-analysis')" tabindex="14" role="button" aria-label="Predictive Analysis tools">
                <div class="nav-icon">ðŸ“Š</div>
                <div>Predictive Analysis</div>
                <div class="keyboard-hint">Alt+3</div>
            </div>
        </div>

        <div class="nav-section">
            <div class="nav-title">Operations</div>
            <div class="nav-item" onclick="showSection('live-map')" tabindex="15" role="button" aria-label="Live emergency map">
                <div class="nav-icon">ðŸ—ºï¸</div>
                <div>Live Map</div>
                <div class="keyboard-hint">Alt+4</div>
            </div>
            <div class="nav-item" onclick="showSection('incidents')" tabindex="16" role="button" aria-label="Active incidents - 7 current">
                <div class="nav-icon">ðŸš¨</div>
                <div>Active Incidents</div>
                <div class="alert-count">7</div>
                <div class="keyboard-hint">Alt+5</div>
            </div>
            <div class="nav-item" onclick="showSection('resources')" tabindex="17" role="button" aria-label="Resource management">
                <div class="nav-icon">ðŸš’</div>
                <div>Resource Management</div>
                <div class="keyboard-hint">Alt+6</div>
            </div>
        </div>

        <div class="nav-section">
            <div class="nav-title">Data & Reports</div>
            <div class="nav-item" onclick="showSection('reports')" tabindex="18" role="button" aria-label="Crowd reports">
                <div class="nav-icon">ðŸ“‹</div>
                <div>Crowd Reports</div>
                <div class="keyboard-hint">Alt+7</div>
            </div>
            <div class="nav-item" onclick="showSection('analytics')" tabindex="19" role="button" aria-label="Analytics dashboard">
                <div class="nav-icon">ðŸ“ˆ</div>
                <div>Analytics</div>
                <div class="keyboard-hint">Alt+8</div>
            </div>
            <div class="nav-item" onclick="showSection('archive')" tabindex="20" role="button" aria-label="Historical archive">
                <div class="nav-icon">ðŸ“š</div>
                <div>Archive</div>
                <div class="keyboard-hint">Alt+9</div>
            </div>
        </div>
    </nav>

    <!-- Modal Overlay -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal-content" id="modalContent">
            <!-- Modal content will be populated here -->
        </div>
    </div>

    <!-- ARIA Live Regions for Screen Readers -->
    <div class="aria-live-region" aria-live="polite" id="statusUpdates"></div>
    <div class="aria-live-region" aria-live="assertive" id="criticalAlerts"></div>
    <!-- Main Content -->
    <main class="main-content" role="main">
        <!-- Breadcrumb Navigation -->
        <div class="breadcrumb" id="breadcrumb" role="navigation" aria-label="Breadcrumb">
            <span class="breadcrumb-item active">AI Command Center</span>
        </div>

        <!-- AI Command Center Section -->
        <div id="ai-command" class="dashboard-section active">
            <!-- Critical Alerts Section -->
            <div class="critical-alerts" onclick="showNotificationCenter()" tabindex="21" role="button" aria-label="3 critical alerts requiring immediate attention">
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
                    <div style="display: flex; align-items: center;">
                        <div class="alert-count">3</div>
                        <h3 style="color: var(--color-critical); font-weight: 900; font-size: 1.3rem;">CRITICAL ALERTS REQUIRING IMMEDIATE ATTENTION</h3>
                        <div class="help-icon">
                            ?
                            <div class="tooltip">High-priority incidents identified by AI that require immediate commander response</div>
                        </div>
                    </div>
                    <div class="last-updated">
                        <div class="live-dot"></div>
                        <span>Updated 23 seconds ago</span>
                    </div>
                </div>
                <div style="display: grid; gap: 1rem;">
                    <div style="background: white; padding: 1rem; border-radius: 8px; border-left: 4px solid var(--color-critical);">
                        <strong>âš ï¸ STRUCTURE FIRE - Expanding to adjacent buildings</strong>
                        <div style="font-size: 0.9rem; margin-top: 0.5rem;">Oak Street - AI detected structural failure risk in 12 minutes</div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card ai-enhanced" onclick="showDetailedAnalytics('processed-reports')" tabindex="22" role="button" aria-label="127 AI processed reports, up 15 this hour">
                    <div class="stat-value ai-value" id="aiProcessedReports">127</div>
                    <div class="stat-label">AI Processed Reports</div>
                    <div class="stat-trend trend-up">â†— +15 this hour</div>
                    <div class="last-updated">
                        <div class="live-dot"></div>
                        <span>Updated 12s ago</span>
                    </div>
                </div>
                <div class="stat-card critical" onclick="showSection('incidents')" tabindex="23" role="button" aria-label="7 active incidents, down 2 from yesterday">
                    <div class="stat-value critical-value">7</div>
                    <div class="stat-label">Active Incidents</div>
                    <div class="stat-trend trend-down">â†˜ -2 from yesterday</div>
                    <div class="last-updated">
                        <div class="live-dot"></div>
                        <span>Updated 5s ago</span>
                    </div>
                </div>
                <div class="stat-card ai-enhanced" onclick="showRiskAssessment()" tabindex="24" role="button" aria-label="AI Risk Score 7.2 out of 10, currently stable">
                    <div class="stat-value ai-value" id="riskScore">7.2</div>
                    <div class="stat-label">AI Risk Score</div>
                    <div class="stat-trend trend-stable">â†’ Stable</div>
                    <div class="last-updated">
                        <div class="live-dot"></div>
                        <span>Updated 3s ago</span>
                    </div>
                    <div class="help-icon" style="position: absolute; top: 10px; right: 10px;">
                        ?
                        <div class="tooltip">Composite risk score from 1-10 based on current incidents, weather, and predictive models</div>
                    </div>
                </div>
                <div class="stat-card" onclick="showSection('resources')" tabindex="25" role="button" aria-label="45 units deployed, optimal level">
                    <div class="stat-value">45</div>
                    <div class="stat-label">Units Deployed</div>
                    <div class="stat-trend trend-stable">â†’ Optimal</div>
                    <div class="last-updated">
                        <div class="live-dot"></div>
                        <span>Updated 18s ago</span>
                    </div>
                </div>
            </div>

            <!-- Enhanced AI-Generated Insights -->
            <div class="panel ai-enhanced">
                <div class="panel-header">
                    <div class="panel-title">
                        <span class="panel-title-icon">ðŸ§ </span>
                        Gemma 3n Real-time Insights
                        <div class="help-icon">
                            ?
                            <div class="tooltip">AI-generated insights from analyzing all emergency data sources for pattern recognition and predictions</div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div class="live-indicator">
                            <div class="live-dot"></div>
                            <span>ANALYZING</span>
                        </div>
                        <button class="btn btn-ai" onclick="refreshAIInsights()" tabindex="26" aria-label="Refresh AI analysis">
                            ðŸ”„ Refresh Analysis
                        </button>
                        <button class="btn btn-primary" onclick="showSection('context-intelligence')" tabindex="27" aria-label="View more insights">
                            ðŸ”® View More
                        </button>
                    </div>
                </div>
                
                <div id="aiInsightsList">
                    <div class="insight-item critical" onclick="viewInsightDetails('fire-risk')" tabindex="28" role="button" aria-label="Critical fire risk insight with 92% confidence">
                        <div class="insight-header">
                            <div class="insight-title">ðŸ”¥ Fire Risk Elevation Detected</div>
                            <div class="confidence-badge critical">92% Confidence</div>
                        </div>
                        <div class="insight-description">
                            AI analysis of weather patterns, historical data, and current conditions indicates elevated fire risk in downtown area between 2:00 PM - 6:00 PM today. Wind speed increasing to 25 mph with low humidity (18%).
                        </div>
                        <div class="last-updated">
                            <div class="live-dot"></div>
                            <span>Generated 45 seconds ago</span>
                        </div>
                        <div class="insight-actions" style="margin-top: 1rem;">
                            <button class="btn btn-critical" onclick="implementRecommendation('fire-risk-deploy-units')" tabindex="29" aria-label="Deploy fire units based on AI recommendation">ðŸš’ Deploy Units</button>
                            <button class="btn btn-primary" onclick="viewInsightDetails('fire-risk')" tabindex="30" aria-label="View detailed fire risk analysis">ðŸ“Š View Analysis</button>
                            <button class="btn btn-primary" onclick="alertStakeholders('fire-risk')" tabindex="31" aria-label="Alert relevant agencies about fire risk">ðŸ“¢ Alert Agencies</button>
                        </div>
                    </div>

                    <div class="insight-item warning" onclick="viewInsightDetails('traffic-prediction')" tabindex="32" role="button" aria-label="Traffic incident prediction with 85% confidence">
                        <div class="insight-header">
                            <div class="insight-title">ðŸš— Traffic Incident Prediction</div>
                            <div class="confidence-badge">85% Confidence</div>
                        </div>
                        <div class="insight-description">
                            Machine learning model predicts 67% higher accident probability on Highway 101 northbound during evening rush (5:00-7:00 PM) due to weather conditions and historical patterns.
                        </div>
                        <div class="last-updated">
                            <div class="live-dot"></div>
                            <span>Generated 2 minutes ago</span>
                        </div>
                        <div class="insight-actions" style="margin-top: 1rem;">
                            <button class="btn btn-primary" onclick="implementRecommendation('traffic-position-units')" tabindex="33" aria-label="Position units for traffic incident prevention">ðŸš“ Position Units</button>
                            <button class="btn btn-primary" onclick="alertTraffic('highway-101')" tabindex="34" aria-label="Issue traffic alert for Highway 101">ðŸš¦ Traffic Alert</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Enhanced Command Grid -->
            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 3rem; margin-bottom: 3rem;">
                <div class="panel ai-enhanced">
                    <div class="panel-header">
                        <div class="panel-title">
                            <span class="panel-title-icon">ðŸ—ºï¸</span>
                            AI-Enhanced Situation Map
                            <div class="help-icon">
                                ?
                                <div class="tooltip">Interactive map with AI-powered incident clustering and predictive risk zones</div>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div class="live-indicator">
                                <div class="live-dot"></div>
                                <span>LIVE MAP</span>
                            </div>
                            <button class="btn btn-ai" onclick="runAIMapAnalysis()" tabindex="35" aria-label="Run AI map analysis">ðŸ§  AI Analysis</button>
                            <button class="btn btn-primary" onclick="showSection('live-map')" tabindex="36" aria-label="View full interactive map">ðŸ—ºï¸ Full Map</button>
                        </div>
                    </div>
                    <div class="map-container" onclick="showSection('live-map')" tabindex="37" role="button" aria-label="Interactive situation map">
                        <div class="map-placeholder">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">ðŸ—ºï¸</div>
                            <div style="font-size: 1.2rem; margin-bottom: 0.5rem;">AI-Enhanced Interactive Map</div>
                            <div>Real-time incidents, predictive hotspots, resource positions</div>
                            <button class="btn btn-primary" style="margin-top: 1rem;" onclick="initializeAIMap()" tabindex="38" aria-label="Initialize AI-enhanced map">ðŸš€ Initialize Map</button>
                        </div>
                        <div class="map-controls">
                            <button class="map-btn" onclick="toggleMapLayer('incidents')" tabindex="39" aria-label="Toggle incidents layer">Incidents</button>
                            <button class="map-btn" onclick="toggleMapLayer('resources')" tabindex="40" aria-label="Toggle resources layer">Resources</button>
                            <button class="map-btn" onclick="toggleMapLayer('predictions')" tabindex="41" aria-label="Toggle predictions layer">Predictions</button>
                        </div>
                    </div>
                </div>

                <div class="panel ai-enhanced critical">
                    <div class="panel-header">
                        <div class="panel-title">
                            <span class="panel-title-icon">ðŸš¨</span>
                            AI-Prioritized Incidents
                            <div class="help-icon">
                                ?
                                <div class="tooltip">Incidents automatically prioritized by AI based on severity, resources needed, and potential impact</div>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div class="live-indicator">
                                <div class="live-dot"></div>
                                <span>LIVE FEED</span>
                            </div>
                            <button class="btn btn-ai" onclick="reprioritizeIncidents()" tabindex="42" aria-label="Re-prioritize incidents using AI">ðŸŽ¯ Re-prioritize</button>
                        </div>
                    </div>
                    <div style="max-height: 400px; overflow-y: auto;" data-incidents-container role="region" aria-label="Priority incidents list">
                        <div class="incident-card critical" onclick="viewIncident(1)" tabindex="43" role="button" aria-label="Critical structure fire on Oak Street">
                            <div class="incident-header">
                                <div style="font-weight: bold;">ðŸ”¥ Structure Fire - Oak Street</div>
                                <div class="incident-status status-active">CRITICAL</div>
                            </div>
                            <div style="font-size: 0.85rem; margin-bottom: 0.5rem;">
                                Multi-story residential. AI detected: structural damage, smoke patterns, 15+ people in building via thermal analysis.
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <span style="font-size: 0.8rem; color: var(--text-color-light);">AI Priority: 9.7/10</span>
                                <span style="background: #16a34a; color: white; padding: 0.25rem 0.6rem; border-radius: 16px; font-size: 0.75rem; font-weight: bold;">COMMAND EST.</span>
                            </div>
                            <div class="last-updated">
                                <div class="live-dot"></div>
                                <span>Updated 8 seconds ago</span>
                            </div>
                        </div>

                        <div class="incident-card high" onclick="viewIncident(2)" tabindex="44" role="button" aria-label="High priority vehicle accident on Highway 101">
                            <div class="incident-header">
                                <div style="font-weight: bold;">ðŸš— MVA Highway 101</div>
                                <div class="incident-status status-responding">HIGH</div>
                            </div>
                            <div style="font-size: 0.85rem; margin-bottom: 0.5rem;">
                                Multi-vehicle accident. AI analysis: 3 vehicles, likely injuries, traffic backup 2.1 miles.
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <span style="font-size: 0.8rem; color: var(--text-color-light);">AI Priority: 7.3/10</span>
                                <span style="background: #3b82f6; color: white; padding: 0.25rem 0.6rem; border-radius: 16px; font-size: 0.75rem; font-weight: bold;">EN ROUTE</span>
                            </div>
                            <div class="last-updated">
                                <div class="live-dot"></div>
                                <span>Updated 32 seconds ago</span>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 1rem; text-align: center;">
                        <button class="btn btn-primary" onclick="showSection('incidents')" tabindex="45" aria-label="View all active incidents">ðŸ“‹ View All Incidents</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Other Dashboard Sections -->
        <div id="context-intelligence" class="dashboard-section">
            <div class="panel ai-enhanced">
                <div class="panel-header">
                    <div class="panel-title">
                        <span class="panel-title-icon">ðŸ”®</span>
                        Deep Context Analysis Engine
                    </div>
                </div>
                <div style="text-align: center; padding: 3rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">ðŸ”®</div>
                    <div style="font-size: 1.5rem;">Context Intelligence Dashboard</div>
                    <div>Advanced AI analysis across all data sources</div>
                </div>
            </div>
        </div>

        <div id="predictive-analysis" class="dashboard-section">
            <div class="panel ai-enhanced">
                <div class="panel-header">
                    <div class="panel-title">
                        <span class="panel-title-icon">ðŸ“Š</span>
                        Predictive Emergency Intelligence
                    </div>
                </div>
                <div style="text-align: center; padding: 3rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">ðŸ“Š</div>
                    <div style="font-size: 1.5rem;">Predictive Analysis Dashboard</div>
                    <div>AI-powered forecasting and risk assessment</div>
                </div>
            </div>
        </div>

        <div id="live-map" class="dashboard-section">
            <div class="panel ai-enhanced">
                <div class="panel-header">
                    <div class="panel-title">
                        <span class="panel-title-icon">ðŸ—ºï¸</span>
                        AI-Enhanced Live Emergency Map
                    </div>
                </div>
                <div style="text-align: center; padding: 3rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">ðŸ—ºï¸</div>
                    <div style="font-size: 1.5rem;">Live Emergency Map</div>
                    <div>Real-time incident tracking and resource deployment</div>
                </div>
            </div>
        </div>

        <div id="incidents" class="dashboard-section">
            <div class="panel critical">
                <div class="panel-header">
                    <div class="panel-title">
                        <span class="panel-title-icon">ðŸš¨</span>
                        Incident Management
                    </div>
                </div>
                <div style="text-align: center; padding: 3rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">ðŸš¨</div>
                    <div style="font-size: 1.5rem;">Incident Management System</div>
                    <div>Real-time incident tracking with AI-powered prioritization</div>
                </div>
            </div>
        </div>

        <div id="resources" class="dashboard-section">
            <div class="panel ai-enhanced">
                <div class="panel-header">
                    <div class="panel-title">
                        <span class="panel-title-icon">ðŸš’</span>
                        AI-Optimized Resource Management
                    </div>
                </div>
                <div style="text-align: center; padding: 3rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">ðŸš’</div>
                    <div style="font-size: 1.5rem;">Resource Management</div>
                    <div>AI-optimized deployment and allocation</div>
                </div>
            </div>
        </div>

        <div id="reports" class="dashboard-section">
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">
                        <span class="panel-title-icon">ðŸ“‹</span>
                        Crowd Reports
                    </div>
                </div>
                <div style="text-align: center; padding: 3rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">ðŸ“‹</div>
                    <div style="font-size: 1.5rem;">Crowd Reports</div>
                    <div>Citizen-reported incidents processed by AI</div>
                </div>
            </div>
        </div>

        <div id="analytics" class="dashboard-section">
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">
                        <span class="panel-title-icon">ðŸ“ˆ</span>
                        Analytics Dashboard
                    </div>
                </div>
                <div style="text-align: center; padding: 3rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">ðŸ“ˆ</div>
                    <div style="font-size: 1.5rem;">Analytics Dashboard</div>
                    <div>Advanced AI-powered analytics and insights</div>
                </div>
            </div>
        </div>

        <div id="archive" class="dashboard-section">
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">
                        <span class="panel-title-icon">ðŸ“š</span>
                        Historical Archive
                    </div>
                </div>
                <div style="text-align: center; padding: 3rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">ðŸ“š</div>
                    <div style="font-size: 1.5rem;">Historical Archive</div>
                    <div>AI-powered search and pattern analysis</div>
                </div>
            </div>
        </div>
    </main>
    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

    <script>
        // Enhanced Crisis Command Center with Full Feature Set
        class EnhancedCrisisCommand {
            constructor() {
                this.currentSection = 'ai-command';
                this.isOnline = navigator.onLine;
                this.chatOpen = false;
                this.userRole = 'Command Admin';
                this.keyboardShortcuts = new Map();
                this.ariaAnnouncer = null;
                this.lastFocusedElement = null;
                this.chatMessages = [];
                
                this.initializeAccessibility();
                this.initializeKeyboardShortcuts();
                this.initializeConnectionMonitoring();
                this.initializeRealTimeChat();
                this.initializeFocusManagement();
            }

            // Enhanced Accessibility Support
            initializeAccessibility() {
                // Create ARIA live regions
                this.ariaAnnouncer = document.getElementById('statusUpdates');
                
                // Add screen reader support for dynamic content
                this.announceToScreenReader = (message, priority = 'polite') => {
                    const region = priority === 'assertive' ? 
                        document.getElementById('criticalAlerts') : 
                        document.getElementById('statusUpdates');
                    
                    region.textContent = message;
                    setTimeout(() => region.textContent = '', 1000);
                };

                // Enhanced focus indicators
                document.addEventListener('focusin', (e) => {
                    this.lastFocusedElement = e.target;
                    if (e.target.classList.contains('nav-item') || 
                        e.target.classList.contains('btn') || 
                        e.target.classList.contains('quick-action')) {
                        e.target.style.outline = '3px solid var(--primary-color)';
                        e.target.style.outlineOffset = '2px';
                    }
                });

                document.addEventListener('focusout', (e) => {
                    e.target.style.outline = '';
                    e.target.style.outlineOffset = '';
                });

                // High contrast mode detection
                if (window.matchMedia && window.matchMedia('(prefers-contrast: high)').matches) {
                    document.documentElement.classList.add('high-contrast');
                }

                console.log('â™¿ Accessibility features initialized');
            }

            // Comprehensive Keyboard Navigation
            initializeKeyboardShortcuts() {
                const shortcuts = {
                    'KeyH': () => this.showHelp(),
                    'KeyS': () => this.focusSearch(),
                    'KeyN': () => this.createNewIncident(),
                    'KeyR': () => this.assignResources(),
                    'KeyE': () => this.exportReport(),
                    'KeyT': () => this.showResponseTemplates(),
                    'KeyM': () => this.toggleChat(),
                    'Escape': () => this.handleEscape(),
                    'F1': () => this.showHelp(),
                    'Tab': (e) => this.handleTabNavigation(e),
                    'ArrowUp': (e) => this.handleArrowNavigation(e, 'up'),
                    'ArrowDown': (e) => this.handleArrowNavigation(e, 'down'),
                    'Enter': (e) => this.handleEnterKey(e),
                    'Space': (e) => this.handleSpaceKey(e)
                };

                // Number keys for section navigation (Alt + 1-9)
                for (let i = 1; i <= 9; i++) {
                    shortcuts[`Digit${i}`] = (e) => {
                        if (e.altKey) {
                            this.navigateToSection(i);
                        }
                    };
                }

                document.addEventListener('keydown', (e) => {
                    const key = e.code || e.key;
                    const shortcut = shortcuts[key];
                    
                    if (shortcut) {
                        // Check for modifier keys
                        if ((key === 'KeyN' || key === 'KeyR' || key === 'KeyE' || key === 'KeyT' || key === 'KeyM') && e.ctrlKey) {
                            e.preventDefault();
                            shortcut(e);
                            return;
                        }
                        
                        if (key.startsWith('Digit') && e.altKey) {
                            e.preventDefault();
                            shortcut(e);
                            return;
                        }
                        
                        if (key === 'KeyH' && e.shiftKey) {
                            e.preventDefault();
                            shortcut(e);
                            return;
                        }
                        
                        if (key === 'F1' || key === 'Escape') {
                            e.preventDefault();
                            shortcut(e);
                            return;
                        }
                        
                        // Navigation keys
                        if (['Tab', 'ArrowUp', 'ArrowDown', 'Enter', 'Space'].includes(key)) {
                            shortcut(e);
                        }
                    }
                });

                console.log('âŒ¨ï¸ Keyboard shortcuts initialized');
            }

            // Connection Status Monitoring
            initializeConnectionMonitoring() {
                const updateConnectionStatus = () => {
                    const dot = document.getElementById('connectionDot');
                    const status = document.getElementById('connectionStatus');
                    const banner = document.getElementById('offlineBanner');
                    
                    if (navigator.onLine) {
                        dot.classList.remove('offline');
                        status.textContent = 'System Online - Auto-sync active';
                        banner.classList.remove('show');
                        this.isOnline = true;
                        this.announceToScreenReader('Connection restored - System back online');
                    } else {
                        dot.classList.add('offline');
                        status.textContent = 'System Offline - Auto-sync paused';
                        banner.classList.add('show');
                        this.isOnline = false;
                        this.announceToScreenReader('Connection lost - Operating in offline mode', 'assertive');
                    }
                };

                window.addEventListener('online', updateConnectionStatus);
                window.addEventListener('offline', updateConnectionStatus);
                
                // Initial status
                updateConnectionStatus();
                
                console.log('ðŸŒ Connection monitoring initialized');
            }

            // Real-Time Team Chat
            initializeRealTimeChat() {
                this.chatMessages = [
                    {
                        id: 1,
                        sender: 'ðŸš¨ Battalion Chief',
                        message: 'Oak Street fire - Need immediate mutual aid. Structure compromised.',
                        timestamp: Date.now() - 120000,
                        urgent: true
                    },
                    {
                        id: 2,
                        sender: 'ðŸ“¡ Dispatch',
                        message: 'Engine 15 and Truck 8 en route to Oak Street. ETA 4 minutes.',
                        timestamp: Date.now() - 300000,
                        urgent: false
                    }
                ];

                this.updateChatDisplay();
                
                // Simulate incoming messages
                setInterval(() => {
                    if (Math.random() > 0.95) { // 5% chance every interval
                        this.addNewChatMessage();
                    }
                }, 10000);

                console.log('ðŸ’¬ Real-time chat initialized');
            }

            // Focus Management
            initializeFocusManagement() {
                // Trap focus in modals
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Tab') {
                        const modal = document.querySelector('.modal-overlay[style*="flex"]');
                        const responseTemplates = document.getElementById('responseTemplates');
                        
                        if (modal && modal.style.display === 'flex') {
                            this.trapFocusInModal(e, modal);
                        } else if (responseTemplates && responseTemplates.style.display === 'block') {
                            this.trapFocusInModal(e, responseTemplates);
                        }
                    }
                });

                console.log('ðŸŽ¯ Focus management initialized');
            }

            // Enhanced Navigation Methods
            navigateToSection(sectionNumber) {
                const sections = [
                    'ai-command', 'context-intelligence', 'predictive-analysis', 
                    'live-map', 'incidents', 'resources', 'reports', 'analytics', 'archive'
                ];
                
                const targetSection = sections[sectionNumber - 1];
                if (targetSection) {
                    this.showSection(targetSection);
                    this.announceToScreenReader(`Navigated to ${this.getSectionTitle(targetSection)}`);
                }
            }

            showSection(sectionId) {
                // Hide all sections
                document.querySelectorAll('.dashboard-section').forEach(section => {
                    section.classList.remove('active');
                });
                
                // Show target section
                const targetSection = document.getElementById(sectionId);
                if (targetSection) {
                    targetSection.classList.add('active');
                    
                    // Update navigation
                    document.querySelectorAll('.nav-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    
                    const activeNavItem = document.querySelector(`[onclick*="${sectionId}"]`);
                    if (activeNavItem) {
                        activeNavItem.classList.add('active');
                    }
                    
                    this.currentSection = sectionId;
                    this.updateBreadcrumb();
                    
                    // Announce to screen readers
                    const sectionTitle = this.getSectionTitle(sectionId);
                    this.announceToScreenReader(`Switched to ${sectionTitle} section`);
                    
                    // Focus management
                    const firstFocusable = targetSection.querySelector('button, [tabindex], input, select, textarea, [href]');
                    if (firstFocusable) {
                        setTimeout(() => firstFocusable.focus(), 100);
                    }
                }
            }

            getSectionTitle(sectionId) {
                const titles = {
                    'ai-command': 'AI Command Center',
                    'context-intelligence': 'Context Intelligence',
                    'predictive-analysis': 'Predictive Analysis',
                    'live-map': 'Live Map',
                    'incidents': 'Active Incidents',
                    'resources': 'Resource Management',
                    'reports': 'Crowd Reports',
                    'analytics': 'Analytics Dashboard',
                    'archive': 'Historical Archive'
                };
                return titles[sectionId] || sectionId;
            }

            updateBreadcrumb() {
                const breadcrumbContainer = document.getElementById('breadcrumb');
                if (breadcrumbContainer) {
                    const sectionTitle = this.getSectionTitle(this.currentSection);
                    breadcrumbContainer.innerHTML = `<span class="breadcrumb-item active">${sectionTitle}</span>`;
                }
            }

            // Quick Action Methods
            createNewIncident() {
                this.showNotification('ðŸ“ New incident form opened', 'info');
                this.announceToScreenReader('New incident creation form opened');
                // Here would integrate with actual incident creation system
            }

            assignResources() {
                this.showNotification('ðŸš’ AI resource assignment initiated', 'info');
                this.announceToScreenReader('AI-assisted resource assignment started');
                // Here would integrate with resource management system
            }

            exportReport() {
                this.showNotification('ðŸ“Š Generating situation report...', 'info');
                setTimeout(() => {
                    this.showNotification('âœ… Report exported successfully', 'success');
                    this.announceToScreenReader('Situation report exported successfully');
                }, 2000);
            }

            showResponseTemplates() {
                const templates = document.getElementById('responseTemplates');
                templates.style.display = 'block';
                
                // Focus first template
                const firstTemplate = templates.querySelector('.template-card');
                if (firstTemplate) {
                    setTimeout(() => firstTemplate.focus(), 100);
                }
                
                this.announceToScreenReader('Response templates opened');
            }

            hideResponseTemplates() {
                const templates = document.getElementById('responseTemplates');
                templates.style.display = 'none';
                
                // Return focus to trigger element
                if (this.lastFocusedElement) {
                    this.lastFocusedElement.focus();
                }
            }

            activateTemplate(templateType) {
                const templates = {
                    'mci': 'Mass Casualty Incident',
                    'hazmat': 'Hazmat Response',
                    'structure-collapse': 'Structure Collapse/USAR',
                    'wildfire': 'Wildfire Response',
                    'severe-weather': 'Severe Weather Response'
                };
                
                const templateName = templates[templateType];
                const confirmed = confirm(`âš ï¸ Activate ${templateName} Protocol?\n\nThis will deploy multiple resources and activate emergency protocols. Continue?`);
                
                if (confirmed) {
                    this.hideResponseTemplates();
                    this.showNotification(`ðŸš¨ ${templateName} protocol activated`, 'error');
                    this.announceToScreenReader(`${templateName} emergency protocol activated`, 'assertive');
                    
                    // Simulate protocol activation
                    setTimeout(() => {
                        this.showNotification(`âœ… ${templateName} units deployed`, 'success');
                    }, 3000);
                }
            }

            // Chat System Methods
            toggleChat() {
                const chatPanel = document.getElementById('chatPanel');
                this.chatOpen = !this.chatOpen;
                
                chatPanel.classList.toggle('open', this.chatOpen);
                
                if (this.chatOpen) {
                    const chatInput = document.getElementById('chatInput');
                    setTimeout(() => chatInput.focus(), 300);
                    this.announceToScreenReader('Team chat opened');
                } else {
                    this.announceToScreenReader('Team chat closed');
                }
            }

            sendChatMessage() {
                const input = document.getElementById('chatInput');
                const message = input.value.trim();
                
                if (message) {
                    this.addChatMessage('ðŸ‘¤ You', message, Date.now(), false);
                    input.value = '';
                    this.announceToScreenReader('Message sent to team chat');
                    
                    // Simulate response (in real system, this would be real-time)
                    setTimeout(() => {
                        this.addChatMessage('ðŸ“¡ Dispatch', 'Message received and logged.', Date.now(), false);
                    }, 2000);
                }
            }

            addChatMessage(sender, message, timestamp, urgent) {
                this.chatMessages.unshift({ 
                    id: Date.now(), 
                    sender, 
                    message, 
                    timestamp, 
                    urgent 
                });
                
                if (this.chatMessages.length > 10) {
                    this.chatMessages.pop(); // Keep only last 10 messages
                }
                
                this.updateChatDisplay();
                
                if (urgent) {
                    this.announceToScreenReader(`Urgent message from ${sender}: ${message}`, 'assertive');
                }
            }

            addNewChatMessage() {
                const messages = [
                    { sender: 'ðŸš’ Engine 12', message: 'On scene at Oak Street. Heavy smoke showing.', urgent: true },
                    { sender: 'ðŸš‘ Medic 7', message: 'Treating 2 victims for smoke inhalation.', urgent: false },
                    { sender: 'ðŸ‘® CHP', message: 'Highway 101 closure in effect.', urgent: false }
                ];
                
                const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                this.addChatMessage(randomMessage.sender, randomMessage.message, Date.now(), randomMessage.urgent);
            }

            updateChatDisplay() {
                const container = document.getElementById('chatMessages');
                if (!container) return;
                
                container.innerHTML = this.chatMessages.map(msg => {
                    const timeAgo = this.formatTimeAgo(Date.now() - msg.timestamp);
                    const urgentClass = msg.urgent ? 'urgent' : '';
                    
                    return `
                        <div class="chat-message ${urgentClass}">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <strong>${msg.sender}</strong>
                                <span style="font-size: 0.8rem; color: var(--text-color-light);">${timeAgo}</span>
                            </div>
                            <div>${msg.message}</div>
                        </div>
                    `;
                }).join('');
                
                // Auto-scroll to top (newest messages)
                container.scrollTop = 0;
            }
            // Keyboard Navigation Handlers
            handleEscape() {
                // Close modals and panels
                const modal = document.getElementById('modalOverlay');
                const templates = document.getElementById('responseTemplates');
                const chatPanel = document.getElementById('chatPanel');
                
                if (modal && modal.style.display === 'flex') {
                    this.hideModal();
                } else if (templates && templates.style.display === 'block') {
                    this.hideResponseTemplates();
                } else if (this.chatOpen) {
                    this.toggleChat();
                }
            }

            handleTabNavigation(e) {
                // Enhanced tab navigation within sections
                if (e.target.closest('.dashboard-section')) {
                    // Let default tab behavior work, but announce context
                    setTimeout(() => {
                        if (document.activeElement) {
                            const label = document.activeElement.getAttribute('aria-label') || 
                                         document.activeElement.textContent?.trim() || 
                                         'Interactive element';
                            // Don't announce every tab - only complex elements
                            if (document.activeElement.tagName === 'BUTTON' || 
                                document.activeElement.classList.contains('stat-card')) {
                                this.announceToScreenReader(`Focused: ${label}`);
                            }
                        }
                    }, 10);
                }
            }

            handleArrowNavigation(e, direction) {
                // Enhanced arrow key navigation within grids
                if (e.target.closest('.stats-grid') || e.target.closest('[data-incidents-container]')) {
                    const container = e.target.closest('.stats-grid') || e.target.closest('[data-incidents-container]');
                    const items = Array.from(container.querySelectorAll('.stat-card, .incident-card'));
                    const currentIndex = items.indexOf(e.target.closest('.stat-card, .incident-card'));
                    
                    if (currentIndex !== -1) {
                        e.preventDefault();
                        const nextIndex = direction === 'down' ? 
                            Math.min(currentIndex + 1, items.length - 1) : 
                            Math.max(currentIndex - 1, 0);
                        
                        if (nextIndex !== currentIndex) {
                            items[nextIndex].focus();
                        }
                    }
                }
            }

            handleEnterKey(e) {
                // Enhanced enter key handling
                if (e.target.classList.contains('nav-item')) {
                    e.target.click();
                } else if (e.target.classList.contains('template-card')) {
                    e.target.click();
                } else if (e.target.id === 'chatInput') {
                    this.sendChatMessage();
                }
            }

            handleSpaceKey(e) {
                // Space key handling for custom controls
                if (e.target.classList.contains('stat-card') || 
                    e.target.classList.contains('incident-card') ||
                    e.target.classList.contains('template-card')) {
                    e.preventDefault();
                    e.target.click();
                }
            }

            trapFocusInModal(e, modal) {
                const focusableElements = modal.querySelectorAll(
                    'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
                );
                const firstElement = focusableElements[0];
                const lastElement = focusableElements[focusableElements.length - 1];

                if (e.shiftKey && document.activeElement === firstElement) {
                    e.preventDefault();
                    lastElement.focus();
                } else if (!e.shiftKey && document.activeElement === lastElement) {
                    e.preventDefault();
                    firstElement.focus();
                }
            }

            // Utility Methods
            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                const colors = {
                    success: 'var(--color-optimal)',
                    error: 'var(--color-critical)',
                    warning: 'var(--color-warning)',
                    info: 'var(--primary-color)'
                };
                
                notification.style.cssText = `
                    position: fixed;
                    top: 100px;
                    right: 20px;
                    background: ${colors[type]};
                    color: white;
                    padding: 1rem 1.5rem;
                    border-radius: 8px;
                    font-weight: 700;
                    z-index: 10000;
                    animation: slideIn 0.3s ease;
                    box-shadow: var(--shadow-lg);
                    max-width: 300px;
                `;
                
                notification.textContent = message;
                notification.setAttribute('role', 'alert');
                notification.setAttribute('aria-live', type === 'error' ? 'assertive' : 'polite');
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => notification.remove(), 300);
                }, 4000);
            }

            showHelp() {
                const helpContent = `
                    <div style="display: grid; gap: 2rem; max-height: 70vh; overflow-y: auto;">
                        <div>
                            <h3 style="color: var(--primary-color); font-weight: 900; margin-bottom: 1rem;">âŒ¨ï¸ Keyboard Shortcuts</h3>
                            <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 0.5rem; font-family: monospace; background: var(--bg-color-light); padding: 1rem; border-radius: 8px;">
                                <div><strong>Ctrl+N</strong></div><div>New Incident</div>
                                <div><strong>Ctrl+R</strong></div><div>Assign Resources</div>
                                <div><strong>Ctrl+E</strong></div><div>Export Report</div>
                                <div><strong>Ctrl+T</strong></div><div>Response Templates</div>
                                <div><strong>Ctrl+M</strong></div><div>Team Chat</div>
                                <div><strong>Alt+1-9</strong></div><div>Navigate Sections</div>
                                <div><strong>Shift+H</strong></div><div>Show Help</div>
                                <div><strong>Escape</strong></div><div>Close Modals</div>
                                <div><strong>Tab/Shift+Tab</strong></div><div>Navigate Elements</div>
                                <div><strong>Arrow Keys</strong></div><div>Navigate Grids</div>
                                <div><strong>Enter/Space</strong></div><div>Activate Elements</div>
                            </div>
                        </div>
                        
                        <div>
                            <h3 style="color: var(--ai-accent); font-weight: 900; margin-bottom: 1rem;">ðŸ§  AI Features</h3>
                            <div style="display: grid; gap: 1rem;">
                                <div style="background: var(--bg-color-light); padding: 1rem; border-radius: 8px;">
                                    <strong>Context Intelligence:</strong> 128K token processing for comprehensive situational awareness
                                </div>
                                <div style="background: var(--bg-color-light); padding: 1rem; border-radius: 8px;">
                                    <strong>Risk Scoring:</strong> Real-time risk assessment (1-10 scale) based on multiple factors
                                </div>
                                <div style="background: var(--bg-color-light); padding: 1rem; border-radius: 8px;">
                                    <strong>Predictive Analysis:</strong> Machine learning forecasts for incident prevention
                                </div>
                                <div style="background: var(--bg-color-light); padding: 1rem; border-radius: 8px;">
                                    <strong>Resource Optimization:</strong> AI-suggested optimal unit positioning
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h3 style="color: var(--color-optimal); font-weight: 900; margin-bottom: 1rem;">â™¿ Accessibility</h3>
                            <div style="display: grid; gap: 1rem;">
                                <div style="background: var(--bg-color-light); padding: 1rem; border-radius: 8px;">
                                    <strong>Screen Reader Support:</strong> Full ARIA labeling and live regions
                                </div>
                                <div style="background: var(--bg-color-light); padding: 1rem; border-radius: 8px;">
                                    <strong>Keyboard Navigation:</strong> Complete keyboard control of all functions
                                </div>
                                <div style="background: var(--bg-color-light); padding: 1rem; border-radius: 8px;">
                                    <strong>Focus Management:</strong> Clear focus indicators and logical tab order
                                </div>
                                <div style="background: var(--bg-color-light); padding: 1rem; border-radius: 8px;">
                                    <strong>High Contrast:</strong> Automatic detection and enhanced visibility
                                </div>
                            </div>
                        </div>

                        <div>
                            <h3 style="color: var(--color-critical); font-weight: 900; margin-bottom: 1rem;">ðŸš¨ Quick Actions</h3>
                            <div style="display: grid; gap: 1rem;">
                                <div style="background: var(--bg-color-light); padding: 1rem; border-radius: 8px;">
                                    <strong>Response Templates:</strong> One-click activation of emergency protocols
                                </div>
                                <div style="background: var(--bg-color-light); padding: 1rem; border-radius: 8px;">
                                    <strong>Team Chat:</strong> Real-time communication with field units
                                </div>
                                <div style="background: var(--bg-color-light); padding: 1rem; border-radius: 8px;">
                                    <strong>Resource Assignment:</strong> AI-assisted unit deployment
                                </div>
                                <div style="background: var(--bg-color-light); padding: 1rem; border-radius: 8px;">
                                    <strong>Incident Creation:</strong> Rapid incident logging and prioritization
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 2rem; padding-top: 1rem; border-top: 2px solid var(--border-color);">
                        <button class="btn btn-ai" onclick="crisisCommand.hideModal(); crisisCommand.announceToScreenReader('Help closed');">
                            âœ“ Got it, thanks!
                        </button>
                    </div>
                `;
                
                this.showModal('ðŸ§  Crisis Command Center - Complete Guide', helpContent);
                this.announceToScreenReader('Help system opened');
            }

            showModal(title, content) {
                const overlay = document.getElementById('modalOverlay');
                const modalContent = document.getElementById('modalContent');
                
                modalContent.innerHTML = `
                    <div class="modal-header">
                        <h2 style="color: var(--primary-color); font-weight: 900;">${title}</h2>
                        <button class="modal-close" onclick="crisisCommand.hideModal()" aria-label="Close help">âœ•</button>
                    </div>
                    <div>${content}</div>
                `;
                
                overlay.style.display = 'flex';
                
                // Focus first interactive element in modal
                setTimeout(() => {
                    const firstFocusable = modalContent.querySelector('button, [tabindex], input, select, textarea, [href]');
                    if (firstFocusable) {
                        firstFocusable.focus();
                    }
                }, 100);
            }

            hideModal() {
                const overlay = document.getElementById('modalOverlay');
                overlay.style.display = 'none';
                
                // Return focus to last focused element
                if (this.lastFocusedElement) {
                    this.lastFocusedElement.focus();
                }
            }

            formatTimeAgo(timeDiff) {
                const seconds = Math.floor(timeDiff / 1000);
                const minutes = Math.floor(seconds / 60);
                const hours = Math.floor(minutes / 60);
                
                if (seconds < 60) return `${seconds}s ago`;
                if (minutes < 60) return `${minutes}m ago`;
                return `${hours}h ago`;
            }

            focusSearch() {
                // Focus search functionality (would integrate with actual search)
                this.showNotification('ðŸ” Search feature would open here', 'info');
                this.announceToScreenReader('Search function activated');
            }

            resetToDashboard() {
                this.showSection('ai-command');
                this.announceToScreenReader('Returned to main dashboard');
            }
        }
        // Initialize the enhanced crisis command system
        let crisisCommand;

        // Global functions for compatibility
        function showSection(sectionId) {
            crisisCommand.showSection(sectionId);
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            crisisCommand.announceToScreenReader(`Switched to ${newTheme} theme`);
        }

        function toggleNav() {
            const nav = document.getElementById('mainNav');
            nav.classList.toggle('open');
            const isOpen = nav.classList.contains('open');
            crisisCommand.announceToScreenReader(isOpen ? 'Navigation menu opened' : 'Navigation menu closed');
        }

        function showHelp() {
            crisisCommand.showHelp();
        }

        function showSystemStatus() {
            const statusContent = `
                <div style="display: grid; gap: 1.5rem;">
                    <div style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); padding: 1.5rem; border-radius: 12px; border: 2px solid var(--color-optimal);">
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                            <div style="width: 16px; height: 16px; border-radius: 50%; background: var(--color-optimal); animation: pulse 2s infinite;"></div>
                            <h3 style="color: var(--color-optimal); font-weight: 900; margin: 0;">System Operational</h3>
                        </div>
                        <div>All AI systems functioning normally with real-time data processing</div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                        <div style="background: var(--bg-color-light); padding: 1rem; border-radius: 8px; text-align: center;">
                            <div style="font-size: 1.5rem; font-weight: 900; color: var(--ai-accent);">99.7%</div>
                            <div>System Uptime</div>
                        </div>
                        <div style="background: var(--bg-color-light); padding: 1rem; border-radius: 8px; text-align: center;">
                            <div style="font-size: 1.5rem; font-weight: 900; color: var(--color-optimal);">6/6</div>
                            <div>Data Streams Active</div>
                        </div>
                        <div style="background: var(--bg-color-light); padding: 1rem; border-radius: 8px; text-align: center;">
                            <div style="font-size: 1.5rem; font-weight: 900; color: var(--primary-color);">Command Admin</div>
                            <div>Current Role</div>
                        </div>
                        <div style="background: var(--bg-color-light); padding: 1rem; border-radius: 8px; text-align: center;">
                            <div style="font-size: 1.5rem; font-weight: 900; color: var(--color-optimal);">Online</div>
                            <div>Connection Status</div>
                        </div>
                    </div>
                    
                    <div style="background: var(--bg-color-light); padding: 1rem; border-radius: 8px;">
                        <h4 style="color: var(--ai-accent); font-weight: 900; margin-bottom: 0.5rem;">ðŸ§  AI System Status</h4>
                        <div style="display: grid; gap: 0.5rem; font-size: 0.9rem;">
                            <div>âœ… Gemma 3n Context Engine: Operational</div>
                            <div>âœ… Risk Assessment Model: Active</div>
                            <div>âœ… Predictive Analytics: Running</div>
                            <div>âœ… Resource Optimization: Online</div>
                            <div>âœ… Pattern Recognition: Enabled</div>
                        </div>
                    </div>
                </div>
            `;
            
            crisisCommand.showModal('ðŸ§  System Status Dashboard', statusContent);
        }

        function showNotificationCenter() {
            crisisCommand.showNotification('ðŸ”” Notification center would open here', 'info');
        }

        function createNewIncident() {
            crisisCommand.createNewIncident();
        }

        function assignResources() {
            crisisCommand.assignResources();
        }

        function exportReport() {
            crisisCommand.exportReport();
        }

        function showResponseTemplates() {
            crisisCommand.showResponseTemplates();
        }

        function hideResponseTemplates() {
            crisisCommand.hideResponseTemplates();
        }

        function activateTemplate(templateType) {
            crisisCommand.activateTemplate(templateType);
        }

        function toggleChat() {
            crisisCommand.toggleChat();
        }

        function sendChatMessage() {
            crisisCommand.sendChatMessage();
        }

        function resetToDashboard() {
            crisisCommand.resetToDashboard();
        }

        // Additional interaction functions
        function viewIncident(incidentId) {
            const incidentDetails = `
                <div style="display: grid; gap: 1.5rem;">
                    <div style="background: var(--bg-color-light); padding: 1.5rem; border-radius: 12px; border-left: 4px solid var(--color-critical);">
                        <h3 style="color: var(--color-critical); font-weight: 900; margin-bottom: 1rem;">ðŸ”¥ Structure Fire - Oak Street</h3>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-bottom: 1rem;">
                            <div><strong>Incident ID:</strong> #2025-00184${incidentId}</div>
                            <div><strong>Priority:</strong> <span style="color: var(--color-critical);">CRITICAL</span></div>
                            <div><strong>Status:</strong> Active - Command Established</div>
                            <div><strong>Response Time:</strong> 3:42 minutes</div>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <strong>Description:</strong> Multi-story residential building fire with structural damage concerns. AI thermal analysis indicates 15+ occupants still in building.
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <strong>Units Assigned:</strong> Engine 12, Truck 5, Battalion 2, Medic 7
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <strong>AI Assessment:</strong> Structural failure risk in 12 minutes. Recommend immediate evacuation of adjacent buildings.
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                        <button class="btn btn-critical" onclick="assignMoreResources(${incidentId})" tabindex="0">ðŸš’ Assign More Units</button>
                        <button class="btn btn-primary" onclick="updateIncidentStatus(${incidentId})" tabindex="0">ðŸ“ Update Status</button>
                        <button class="btn btn-primary" onclick="showSection('incidents')" tabindex="0">ðŸ“‹ View All Incidents</button>
                    </div>
                </div>
            `;
            
            crisisCommand.showModal(`ðŸš¨ Incident #${incidentId} Details`, incidentDetails);
            crisisCommand.announceToScreenReader(`Opened details for incident ${incidentId}`);
        }

        function assignMoreResources(incidentId) {
            crisisCommand.showNotification(`ðŸš’ Additional resources assigned to incident #${incidentId}`, 'success');
            crisisCommand.announceToScreenReader(`Additional resources deployed to incident ${incidentId}`, 'assertive');
            crisisCommand.hideModal();
        }

        function updateIncidentStatus(incidentId) {
            crisisCommand.showNotification(`âœ… Status updated for incident #${incidentId}`, 'success');
            crisisCommand.announceToScreenReader(`Status updated for incident ${incidentId}`);
            crisisCommand.hideModal();
        }

        function viewInsightDetails(insightId) {
            const insightDetails = `
                <div style="display: grid; gap: 1.5rem;">
                    <div style="background: var(--bg-color-light); padding: 1.5rem; border-radius: 12px;">
                        <h3 style="color: var(--ai-accent); font-weight: 900; margin-bottom: 1rem;">ðŸ§  AI Analysis: ${insightId}</h3>
                        <div style="display: grid; gap: 1rem;">
                            <div><strong>Confidence Interval:</strong> 87-96%</div>
                            <div><strong>Data Sources:</strong> Weather patterns, Historical incidents, Social media feeds</div>
                            <div><strong>Risk Factors:</strong> Wind speed (25mph), Low humidity (18%), Peak incident hours</div>
                            <div><strong>Geographic Impact:</strong> Downtown area, 3-block radius</div>
                            <div><strong>Time Window:</strong> 2:00 PM - 6:00 PM today</div>
                        </div>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); padding: 1.5rem; border-radius: 12px;">
                        <h4 style="color: var(--primary-color); font-weight: 900; margin-bottom: 1rem;">ðŸ“Š Supporting Data</h4>
                        <div>Historical analysis shows 73% correlation between current conditions and fire incidents. Weather service confirms sustained winds above 20mph with humidity below 20%.</div>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; justify-content: center;">
                        <button class="btn btn-ai" onclick="exportAnalysisReport('${insightId}')">ðŸ“„ Export Report</button>
                        <button class="btn btn-primary" onclick="alertStakeholders('${insightId}')">ðŸ“¢ Send Alerts</button>
                    </div>
                </div>
            `;
            
            crisisCommand.showModal(`ðŸ” Detailed Analysis: ${insightId}`, insightDetails);
        }

        function showDetailedAnalytics(type) {
            crisisCommand.showNotification(`ðŸ“Š Loading detailed analytics: ${type}`, 'info');
            setTimeout(() => {
                crisisCommand.showSection('analytics');
            }, 500);
        }

        function showRiskAssessment() {
            const riskContent = `
                <div style="display: grid; gap: 1.5rem;">
                    <div style="text-align: center;">
                        <div style="font-size: 4rem; font-weight: 900; color: var(--color-warning); margin-bottom: 1rem;">7.2</div>
                        <div style="font-size: 1.2rem; font-weight: 700;">Current Risk Score</div>
                        <div style="color: var(--text-color-light);">Scale: 1 (Low) - 10 (Critical)</div>
                    </div>
                    
                    <div style="display: grid; gap: 1rem;">
                        <div style="background: var(--bg-color-light); padding: 1rem; border-radius: 8px;">
                            <strong>Weather Factors (+1.3):</strong> High winds, low humidity
                        </div>
                        <div style="background: var(--bg-color-light); padding: 1rem; border-radius: 8px;">
                            <strong>Active Incidents (+2.1):</strong> 3 critical, 4 high priority
                        </div>
                        <div style="background: var(--bg-color-light); padding: 1rem; border-radius: 8px;">
                            <strong>Time Factors (+0.4):</strong> Peak incident hours (2-6 PM)
                        </div>
                        <div style="background: var(--bg-color-light); padding: 1rem; border-radius: 8px;">
                            <strong>Resource Status (+0.8):</strong> High deployment rate
                        </div>
                    </div>
                    
                    <div style="text-align: center;">
                        <button class="btn btn-ai" onclick="generateRiskReport()">ðŸ“Š Generate Risk Report</button>
                    </div>
                </div>
            `;
            
            crisisCommand.showModal('ðŸŽ¯ AI Risk Assessment', riskContent);
        }

        function implementRecommendation(recommendationId) {
            const actionType = recommendationId.split('-').slice(1).join(' ');
            const isConfirmed = confirm(`âš ï¸ Confirm Action: ${actionType}\n\nThis will trigger emergency response protocols. Continue?`);
            
            if (isConfirmed) {
                crisisCommand.showNotification(`âš¡ Implementing: ${actionType}...`, 'info');
                setTimeout(() => {
                    crisisCommand.showNotification(`âœ… Successfully implemented: ${actionType}`, 'success');
                }, 2000);
            }
        }

        function alertStakeholders(alertType) {
            crisisCommand.showNotification(`ðŸ“¢ Stakeholder alerts sent for: ${alertType}`, 'success');
        }

        function alertTraffic(location) {
            crisisCommand.showNotification(`ðŸš¦ Traffic alert issued for: ${location}`, 'success');
        }

        function runAIMapAnalysis() {
            crisisCommand.showNotification('ðŸ§  Running AI map analysis...', 'info');
            setTimeout(() => {
                crisisCommand.showNotification('ðŸ—ºï¸ AI map analysis complete', 'success');
            }, 3000);
        }

        function reprioritizeIncidents() {
            crisisCommand.showNotification('ðŸŽ¯ AI re-prioritizing incidents...', 'info');
            setTimeout(() => {
                crisisCommand.showNotification('âœ… Incidents re-prioritized by AI', 'success');
            }, 2000);
        }

        function refreshAIInsights() {
            crisisCommand.showNotification('ðŸ”„ Refreshing AI insights...', 'info');
            setTimeout(() => {
                crisisCommand.showNotification('âœ… AI insights updated', 'success');
            }, 2000);
        }

        function initializeAIMap() {
            crisisCommand.showNotification('ðŸš€ Loading AI-enhanced map...', 'info');
            setTimeout(() => {
                crisisCommand.showNotification('ðŸ—ºï¸ AI map initialized', 'success');
                crisisCommand.showSection('live-map');
            }, 3000);
        }

        function toggleMapLayer(layer) {
            crisisCommand.showNotification(`ðŸ—ºï¸ Toggled ${layer} layer`, 'info');
        }

        function exportAnalysisReport(analysisId) {
            crisisCommand.showNotification('ðŸ“„ Exporting analysis report...', 'info');
            setTimeout(() => {
                crisisCommand.showNotification('âœ… Report exported successfully', 'success');
            }, 1500);
        }

        function generateRiskReport() {
            crisisCommand.showNotification('ðŸ“Š Generating risk assessment report...', 'info');
            setTimeout(() => {
                crisisCommand.showNotification('âœ… Risk report generated', 'success');
            }, 2000);
        }

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', async () => {
            // Show loading indicator
            const loadingIndicator = document.createElement('div');
            loadingIndicator.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: var(--gemma-gradient);
                color: white;
                padding: 2rem 3rem;
                border-radius: 16px;
                font-weight: 900;
                font-size: 1.2rem;
                z-index: 10000;
                box-shadow: var(--shadow-xl);
            `;
            loadingIndicator.innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">ðŸ§ </div>
                    <div>Initializing Enhanced Crisis Command Center...</div>
                    <div style="font-size: 0.9rem; opacity: 0.8; margin-top: 0.5rem;">Full accessibility & keyboard navigation</div>
                </div>
            `;
            document.body.appendChild(loadingIndicator);
            
            try {
                // Initialize the enhanced system
                crisisCommand = new EnhancedCrisisCommand();
                
                // Simulate initialization delay
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                loadingIndicator.remove();
                crisisCommand.showNotification('ðŸš€ Enhanced Crisis Command Center fully operational', 'success');
                crisisCommand.announceToScreenReader('Enhanced Crisis Command Center fully loaded and operational');
                
                console.log('ðŸ§  Enhanced Crisis Command Center with full accessibility ready');
            } catch (error) {
                console.error('System initialization failed:', error);
                loadingIndicator.innerHTML = `
                    <div style="text-align: center;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">âš ï¸</div>
                        <div>Initialization failed - operating in degraded mode</div>
                        <button onclick="location.reload()" style="margin-top: 1rem; padding: 0.5rem 1rem; background: white; color: var(--color-critical); border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">Retry</button>
                    </div>
                `;
            }
        });

        // Handle responsive navigation
        window.addEventListener('resize', () => {
            if (window.innerWidth > 1024) {
                document.getElementById('mainNav').classList.remove('open');
            }
        });

        // Add CSS animations
        const animationCSS = document.createElement('style');
        animationCSS.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
            .high-contrast {
                --border-color: #000000;
                --text-color-light: #000000;
            }
            .high-contrast .btn {
                border: 3px solid #000000 !important;
            }
        `;
        document.head.appendChild(animationCSS);

        console.log('ðŸš€ Enhanced Crisis Command Center with comprehensive features loading...');
    </script>
</body>
</html>