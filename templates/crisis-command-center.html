<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crisis Command Center - Clean Interface</title>
    <style>
        :root {
            --primary-color: #1e40af;
            --primary-dark: #1e3a8a;
            --color-critical: #dc2626;
            --color-warning: #f59e0b;
            --color-optimal: #16a34a;
            --bg-color-base: #ffffff;
            --bg-color-card: #ffffff;
            --bg-color-light: #f8fafc;
            --text-color-base: #1f2937;
            --text-color-light: #6b7280;
            --text-color-inverted: #ffffff;
            --border-color: #e5e7eb;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            --ai-accent: #8b5cf6;
            --transition-fast: 0.2s ease;
            --transition-smooth: 0.3s ease;
        }
        /* Dark theme support */
        [data-theme="dark"] {
            --bg-color-base: #1f2937;
            --bg-color-card: #374151;
            --bg-color-light: #4b5563;
            --text-color-base: #f9fafb;
            --text-color-light: #d1d5db;
            --border-color: #4b5563;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-color-base);
            color: var(--text-color-base);
            line-height: 1.6;
            overflow-x: hidden;
        }
        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }
        /* Focus outline for accessibility */
        :focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }
        /* Selection styling */
        ::selection {
            background: var(--primary-color);
            color: white;
        }
    </style>
    <style>
        /* Clean Compact Header */
        .main-header {
            background: linear-gradient(135deg, var(--color-critical) 0%, #991b1b 100%);
            color: white;
            padding: 0.75rem 1.5rem;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            box-shadow: var(--shadow-md);
            height: 60px;
            backdrop-filter: blur(10px);
        }
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
            height: 100%;
        }
        .header-left {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.5rem;
            font-weight: 900;
            cursor: pointer;
            transition: var(--transition-fast);
            text-decoration: none;
            color: inherit;
        }
        .logo:hover {
            transform: scale(1.02);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        .logo-icon {
            font-size: 1.8rem;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }
        .logo-text {
            font-size: 1.2rem;
            letter-spacing: -0.02em;
        }
        /* Compact Horizontal Navigation */
        .main-nav {
            display: flex;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            padding: 0.3rem;
            border-radius: 8px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .nav-item {
            padding: 0.6rem 1.2rem;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition-fast);
            font-weight: 600;
            font-size: 0.9rem;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            position: relative;
            overflow: hidden;
        }
        .nav-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.3s ease;
        }
        .nav-item:hover::before {
            left: 100%;
        }
        .nav-item:hover,
        .nav-item:focus {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
            color: white;
        }
        .nav-item.active {
            background: rgba(255, 255, 255, 0.25);
            color: white;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
            font-weight: 700;
        }
        /* Mobile hamburger menu */
        .mobile-menu-btn {
            display: none;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            padding: 0.6rem;
            cursor: pointer;
            transition: var(--transition-fast);
            color: white;
            font-size: 1.2rem;
        }
        .mobile-menu-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
    </style>
    <style>
        /* Consolidated Right Utils */
        .header-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .status-pill {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.15);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            border: 1px solid rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            transition: var(--transition-fast);
        }
        .status-pill:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--color-optimal);
            animation: pulse 2s infinite;
            box-shadow: 0 0 8px rgba(22, 163, 74, 0.5);
        }
        .status-dot.offline {
            background: var(--color-critical);
            box-shadow: 0 0 8px rgba(220, 38, 38, 0.5);
            animation: blink 1s infinite;
        }
        /* Notification Bell */
        .notification-bell {
            position: relative;
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.25);
            border-radius: 8px;
            padding: 0.7rem;
            cursor: pointer;
            transition: var(--transition-fast);
            backdrop-filter: blur(10px);
        }
        .notification-bell:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-1px);
        }
        .notification-icon {
            font-size: 1.1rem;
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
        }
        .notification-count {
            position: absolute;
            top: -6px;
            right: -6px;
            background: var(--color-warning);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 900;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            animation: bounce 2s infinite;
        }
        /* More Menu Dropdown */
        .more-menu {
            position: relative;
        }
        .more-btn {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.25);
            border-radius: 8px;
            padding: 0.7rem;
            cursor: pointer;
            transition: var(--transition-fast);
            color: white;
            font-size: 1.1rem;
            backdrop-filter: blur(10px);
        }
        .more-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-1px);
        }
        .more-dropdown {
            position: absolute;
            top: calc(100% + 0.5rem);
            right: 0;
            background: var(--bg-color-card);
            border-radius: 12px;
            box-shadow: var(--shadow-xl);
            min-width: 200px;
            z-index: 1001;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: var(--transition-smooth);
            border: 1px solid var(--border-color);
            backdrop-filter: blur(20px);
        }
        .more-dropdown.open {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        .dropdown-item {
            padding: 0.9rem 1.2rem;
            cursor: pointer;
            transition: var(--transition-fast);
            color: var(--text-color-base);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.9rem;
            font-weight: 500;
            border-bottom: 1px solid var(--border-color);
            text-decoration: none;
        }
        .dropdown-item:hover {
            background: var(--bg-color-light);
            color: var(--primary-color);
        }
        .dropdown-item:last-child {
            border-bottom: none;
            border-radius: 0 0 12px 12px;
        }
        .dropdown-item:first-child {
            border-radius: 12px 12px 0 0;
        }
        .dropdown-icon {
            font-size: 1rem;
            width: 16px;
            text-align: center;
        }
    </style>
    <style>
        /* Critical Alert Banner */
        .alert-banner {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border-left: 4px solid var(--color-critical);
            padding: 1rem 1.5rem;
            margin-top: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #fecaca;
            position: relative;
            overflow: hidden;
        }
        .alert-banner::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--color-critical);
            animation: pulse 2s infinite;
        }
        .alert-banner.hidden {
            display: none;
        }
        .alert-content {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .alert-icon {
            font-size: 1.3rem;
            animation: bounce 1s infinite;
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.2));
        }
        .alert-text {
            font-weight: 700;
            color: var(--color-critical);
            font-size: 0.95rem;
        }
        .alert-actions {
            display: flex;
            gap: 0.5rem;
        }
        .alert-time {
            font-size: 0.8rem;
            color: var(--text-color-light);
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        .alert-close {
            background: none;
            border: none;
            color: var(--text-color-light);
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0.25rem;
            transition: var(--transition-fast);
        }
        .alert-close:hover {
            color: var(--color-critical);
            transform: scale(1.1);
        }
        /* Clean KPI Cards Row */
        .kpi-row {
            padding: 1.5rem;
            background: var(--bg-color-light);
            border-bottom: 1px solid var(--border-color);
        }
        .kpi-container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.5rem;
        }
        .kpi-card {
            background: var(--bg-color-card);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            transition: var(--transition-smooth);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s ease;
        }
        .kpi-card:hover::before {
            left: 100%;
        }
        .kpi-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }
        .kpi-card.ai-enhanced {
            background: linear-gradient(135deg, #f3e8ff 0%, #ffffff 100%);
            border-color: var(--ai-accent);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.15);
        }
        .kpi-card.critical {
            background: linear-gradient(135deg, #fef2f2 0%, #ffffff 100%);
            border-color: var(--color-critical);
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.15);
        }
        .kpi-card.warning {
            background: linear-gradient(135deg, #fffbeb 0%, #ffffff 100%);
            border-color: var(--color-warning);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.15);
        }
        .kpi-value {
            font-size: 2.5rem;
            font-weight: 900;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 1;
        }
        .kpi-value.ai-value {
            color: var(--ai-accent);
        }
        .kpi-value.critical-value {
            color: var(--color-critical);
        }
        .kpi-value.warning-value {
            color: var(--color-warning);
        }
        .kpi-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-color-base);
            margin-bottom: 0.5rem;
            position: relative;
            z-index: 1;
        }
        .kpi-trend {
            font-size: 0.8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.25rem;
            position: relative;
            z-index: 1;
        }
        .trend-up { 
            color: var(--color-optimal);
        }
        .trend-down { 
            color: var(--color-critical);
        }
        .trend-stable {
            color: var(--text-color-light);
        }
        .kpi-update-time {
            font-size: 0.7rem;
            color: var(--text-color-light);
            margin-top: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.25rem;
        }
        .update-dot {
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: var(--color-optimal);
            animation: pulse 2s infinite;
        }
    </style>
    <style>
        /* Main Content */
        .main-content {
            padding: 2rem 1.5rem;
            max-width: 1400px;
            margin: 0 auto;
            min-height: calc(100vh - 300px);
        }
        /* Section Content Management */
        .section-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        .section-content.active {
            display: block;
        }
        /* Content Grid */
        .content-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        /* Enhanced Panels */
        .panel {
            background: var(--bg-color-card);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            transition: var(--transition-smooth);
            position: relative;
            overflow: hidden;
        }
        .panel:hover {
            box-shadow: var(--shadow-md);
        }
        .panel.ai-enhanced {
            border-color: var(--ai-accent);
            background: linear-gradient(135deg, #faf8ff 0%, #ffffff 100%);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.1);
        }
        .panel.ai-enhanced::after {
            content: 'ðŸ§  AI Enhanced';
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            background: var(--ai-accent);
            color: white;
            padding: 0.25rem 0.6rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 700;
            z-index: 10;
        }
        .panel.critical {
            border-color: var(--color-critical);
            background: linear-gradient(135deg, #fef2f2 0%, #ffffff 100%);
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.1);
        }
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }
        .panel-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-color-base);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .panel-title-icon {
            font-size: 1.2rem;
        }
        .panel-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        .panel-content {
            position: relative;
            z-index: 1;
        }
        /* Enhanced Buttons */
        .btn {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-fast);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            position: relative;
            overflow: hidden;
        }
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.3s ease;
        }
        .btn:hover::before {
            left: 100%;
        }
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }
        .btn-primary {
            background: var(--primary-color);
            color: white;
            border: 1px solid var(--primary-dark);
        }
        .btn-primary:hover {
            background: var(--primary-dark);
            box-shadow: var(--shadow-md);
        }
        .btn-ai {
            background: var(--ai-accent);
            color: white;
            border: 1px solid #7c3aed;
        }
        .btn-ai:hover {
            background: #7c3aed;
            box-shadow: var(--shadow-md);
        }
        .btn-critical {
            background: var(--color-critical);
            color: white;
            border: 1px solid #991b1b;
        }
        .btn-critical:hover {
            background: #991b1b;
            box-shadow: var(--shadow-md);
        }
        .btn-outline {
            background: transparent;
            color: var(--text-color-base);
            border: 1px solid var(--border-color);
        }
        .btn-outline:hover {
            background: var(--bg-color-light);
            border-color: var(--primary-color);
            color: var(--primary-color);
        }
        .btn-sm {
            padding: 0.4rem 0.8rem;
            font-size: 0.75rem;
        }
        .btn-icon {
            padding: 0.6rem;
            min-width: auto;
        }
        /* Loading states */
        .btn.loading {
            opacity: 0.7;
            cursor: not-allowed;
        }
        .btn.loading::after {
            content: '';
            width: 12px;
            height: 12px;
            border: 2px solid currentColor;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
            margin-left: 0.5rem;
        }
    </style>
    <style>
        /* Incident List */
        .incident-list {
            max-height: 400px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--border-color) transparent;
        }
        .incident-list::-webkit-scrollbar {
            width: 6px;
        }
        .incident-list::-webkit-scrollbar-track {
            background: transparent;
        }
        .incident-list::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
        }
        .incident-list::-webkit-scrollbar-thumb:hover {
            background: var(--text-color-light);
        }
        .incident-item {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: var(--transition-fast);
            border-radius: 8px;
            margin-bottom: 0.5rem;
            position: relative;
        }
        .incident-item:hover {
            background: var(--bg-color-light);
            transform: translateX(4px);
        }
        .incident-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        .incident-item.critical {
            border-left: 4px solid var(--color-critical);
            background: linear-gradient(135deg, #fef2f2 0%, transparent 100%);
        }
        .incident-item.high {
            border-left: 4px solid var(--color-warning);
            background: linear-gradient(135deg, #fffbeb 0%, transparent 100%);
        }
        .incident-item.normal {
            border-left: 4px solid var(--primary-color);
            background: linear-gradient(135deg, #eff6ff 0%, transparent 100%);
        }
        .incident-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }
        .incident-title {
            font-weight: 700;
            color: var(--text-color-base);
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .incident-icon {
            font-size: 1.1rem;
        }
        .incident-priority {
            padding: 0.3rem 0.8rem;
            border-radius: 16px;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.02em;
        }
        .priority-critical {
            background: var(--color-critical);
            color: white;
            box-shadow: 0 2px 4px rgba(220, 38, 38, 0.3);
        }
        .priority-high {
            background: var(--color-warning);
            color: white;
            box-shadow: 0 2px 4px rgba(245, 158, 11, 0.3);
        }
        .priority-normal {
            background: var(--primary-color);
            color: white;
            box-shadow: 0 2px 4px rgba(30, 64, 175, 0.3);
        }
        .incident-description {
            font-size: 0.9rem;
            color: var(--text-color-light);
            margin-bottom: 0.75rem;
            line-height: 1.5;
        }
        .incident-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            color: var(--text-color-light);
        }
        .incident-priority-score {
            font-weight: 600;
            color: var(--text-color-base);
        }
        .incident-time {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        .time-dot {
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: var(--color-optimal);
            animation: pulse 2s infinite;
        }
        /* Map placeholder */
        .map-placeholder {
            height: 300px;
            background: var(--bg-color-light);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text-color-light);
            font-size: 0.9rem;
            border: 2px dashed var(--border-color);
            transition: var(--transition-fast);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            text-decoration: none;
        }
        .map-placeholder:hover {
            border-color: var(--primary-color);
            background: linear-gradient(135deg, var(--bg-color-light) 0%, #eff6ff 100%);
            color: var(--primary-color);
        }
        .map-placeholder::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(30, 64, 175, 0.1), transparent);
            transition: left 0.5s ease;
        }
        .map-placeholder:hover::before {
            left: 100%;
        }
        .map-icon {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        }
        .map-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        .map-subtitle {
            font-size: 0.8rem;
            opacity: 0.8;
        }
        /* Status indicators */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.3rem 0.8rem;
            background: var(--bg-color-light);
            border-radius: 16px;
            font-size: 0.8rem;
            font-weight: 600;
            border: 1px solid var(--border-color);
        }
        .status-indicator.online {
            background: rgba(22, 163, 74, 0.1);
            border-color: rgba(22, 163, 74, 0.3);
            color: var(--color-optimal);
        }
        .status-indicator.processing {
            background: rgba(245, 158, 11, 0.1);
            border-color: rgba(245, 158, 11, 0.3);
            color: var(--color-warning);
        }
        .status-indicator.error {
            background: rgba(220, 38, 38, 0.1);
            border-color: rgba(220, 38, 38, 0.3);
            color: var(--color-critical);
        }
        .status-dot-inline {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: currentColor;
        }
        .status-dot-inline.animated {
            animation: pulse 2s infinite;
        }
    </style>
    <style>
        /* Enhanced Notification Log */
        .notification-log-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            backdrop-filter: blur(4px);
        }

        .notification-log-overlay.open {
            opacity: 1;
            visibility: visible;
        }

        .notification-log-modal {
            background: var(--bg-color-card);
            border-radius: 16px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            box-shadow: var(--shadow-xl);
            overflow: hidden;
            transform: translateY(-20px);
            transition: transform 0.3s ease;
        }

        .notification-log-overlay.open .notification-log-modal {
            transform: translateY(0);
        }

        .notification-log-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
        }

        .notification-log-title {
            font-size: 1.3rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .notification-log-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .live-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.2);
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--color-optimal);
            animation: pulse 2s infinite;
        }

        .close-log-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            border-radius: 8px;
            padding: 0.6rem;
            cursor: pointer;
            font-size: 1.2rem;
            transition: var(--transition-fast);
        }

        .close-log-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .notification-filters {
            background: var(--bg-color-light);
            padding: 1rem 2rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .filter-tabs {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .filter-tab {
            padding: 0.6rem 1.2rem;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            background: white;
            color: var(--text-color-base);
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: var(--transition-fast);
            position: relative;
            overflow: hidden;
        }

        .filter-tab.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .filter-tab:hover:not(.active) {
            background: var(--bg-color-light);
            border-color: var(--primary-color);
        }

        .notification-search {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .search-input {
            padding: 0.6rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.9rem;
            width: 200px;
            transition: var(--transition-fast);
        }

        .search-input:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
        }

        .bulk-actions {
            display: flex;
            gap: 0.5rem;
        }

        .notification-log-content {
            height: 60vh;
            overflow-y: auto;
            padding: 0;
        }

        .notification-log-list {
            padding: 0;
        }

        .log-notification-item {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            transition: var(--transition-fast);
            cursor: pointer;
            position: relative;
        }

        .log-notification-item:hover {
            background: var(--bg-color-light);
        }

        .log-notification-item.unread {
            background: rgba(30, 64, 175, 0.05);
            border-left: 4px solid var(--primary-color);
        }

        .log-notification-item.critical {
            background: rgba(220, 38, 38, 0.05);
            border-left: 4px solid var(--color-critical);
        }

        .log-notification-item.warning {
            background: rgba(245, 158, 11, 0.05);
            border-left: 4px solid var(--color-warning);
        }

        .notification-type-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
            margin-top: 0.25rem;
        }

        .notification-details {
            flex: 1;
            min-width: 0;
        }

        .notification-meta-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.5rem;
            gap: 1rem;
        }

        .notification-category-badge {
            padding: 0.25rem 0.6rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-critical {
            background: var(--color-critical);
            color: white;
        }

        .badge-operational {
            background: var(--color-warning);
            color: white;
        }

        .badge-communication {
            background: var(--primary-color);
            color: white;
        }

        .badge-system {
            background: var(--text-color-light);
            color: white;
        }

        .notification-timestamp {
            font-size: 0.8rem;
            color: var(--text-color-light);
            flex-shrink: 0;
        }

        .notification-log-subject {
            font-weight: 700;
            color: var(--text-color-base);
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .notification-log-message {
            color: var(--text-color-light);
            line-height: 1.5;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        .notification-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 0.4rem 0.8rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: white;
            color: var(--text-color-base);
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-fast);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }

        .action-btn:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .action-btn.acknowledge {
            background: var(--color-optimal);
            color: white;
            border-color: var(--color-optimal);
        }

        .action-btn.acknowledge:hover {
            background: #15803d;
        }

        .unread-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--primary-color);
            position: absolute;
            left: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
        }

        .log-notification-item.critical .unread-indicator {
            background: var(--color-critical);
        }

        .log-notification-item.warning .unread-indicator {
            background: var(--color-warning);
        }

        .archived-section {
            border-top: 2px solid var(--border-color);
            background: var(--bg-color-light);
        }

        .archived-header {
            padding: 1rem 2rem;
            background: var(--bg-color-card);
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition-fast);
        }

        .archived-header:hover {
            background: var(--bg-color-light);
        }

        .archived-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .archived-content.expanded {
            max-height: 300px;
            overflow-y: auto;
        }

        .no-notifications {
            text-align: center;
            padding: 3rem;
            color: var(--text-color-light);
        }

        .no-notifications-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
    </style>
    <style>
        /* Team Chat Modal/Overlay Styles */
        .team-chat-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 10001;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            backdrop-filter: blur(4px);
        }

        .team-chat-overlay.open {
            opacity: 1;
            visibility: visible;
        }

        .team-chat-modal {
            background: var(--bg-color-card);
            border-radius: 16px;
            width: 95%;
            max-width: 1200px;
            height: 85vh;
            max-height: 800px;
            box-shadow: var(--shadow-xl);
            overflow: hidden;
            transform: translateY(-20px);
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .team-chat-overlay.open .team-chat-modal {
            transform: translateY(0);
        }

        /* Chat Header */
        .chat-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
        }

        .chat-title {
            font-size: 1.3rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .chat-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .chat-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.2);
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .online-count {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--color-optimal);
            animation: pulse 2s infinite;
        }

        .close-chat-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            border-radius: 8px;
            padding: 0.6rem;
            cursor: pointer;
            font-size: 1.2rem;
            transition: var(--transition-fast);
        }

        .close-chat-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Chat Layout */
        .chat-body {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* Channel Sidebar */
        .chat-sidebar {
            width: 280px;
            background: var(--bg-color-light);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }

        .channel-header {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-color-card);
        }

        .channel-search {
            width: 100%;
            padding: 0.6rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.9rem;
            transition: var(--transition-fast);
        }

        .channel-search:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
        }

        .channels-list {
            flex: 1;
            overflow-y: auto;
            padding: 0.5rem;
        }

        .channel-group {
            margin-bottom: 1.5rem;
        }

        .channel-group-title {
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-color-light);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 0.5rem 1rem;
            margin-bottom: 0.5rem;
        }

        .channel-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.7rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition-fast);
            margin-bottom: 0.25rem;
            font-size: 0.9rem;
        }

        .channel-item:hover {
            background: rgba(30, 64, 175, 0.1);
        }

        .channel-item.active {
            background: var(--primary-color);
            color: white;
        }

        .channel-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .channel-icon {
            font-size: 1rem;
        }

        .channel-name {
            font-weight: 600;
        }

        .unread-badge {
            background: var(--color-critical);
            color: white;
            border-radius: 10px;
            padding: 0.15rem 0.5rem;
            font-size: 0.7rem;
            font-weight: 700;
            min-width: 18px;
            text-align: center;
        }

        /* Online Staff Section */
        .online-staff {
            border-top: 1px solid var(--border-color);
            padding: 1rem;
            background: var(--bg-color-card);
        }

        .staff-title {
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-color-light);
            text-transform: uppercase;
            margin-bottom: 0.75rem;
        }

        .staff-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .staff-member {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.4rem 0;
        }

        .staff-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 700;
            position: relative;
        }

        .staff-avatar.online::after {
            content: '';
            position: absolute;
            bottom: -2px;
            right: -2px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--color-optimal);
            border: 2px solid var(--bg-color-card);
        }

        .staff-name {
            font-size: 0.85rem;
            font-weight: 600;
        }

        .staff-role {
            font-size: 0.7rem;
            color: var(--text-color-light);
        }

        /* Main Chat Area */
        .chat-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-messages-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-color-card);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .current-channel {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .current-channel-name {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-color-base);
        }

        .channel-description {
            font-size: 0.8rem;
            color: var(--text-color-light);
        }

        .chat-actions {
            display: flex;
            gap: 0.5rem;
        }

        .chat-action-btn {
            padding: 0.5rem 0.8rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: white;
            color: var(--text-color-base);
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-fast);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }

        .chat-action-btn:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* Messages Area */
        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 1rem 1.5rem;
            background: var(--bg-color-base);
        }

        .message-group {
            margin-bottom: 1.5rem;
        }

        .message {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 0.5rem;
            padding: 0.5rem;
            border-radius: 8px;
            transition: var(--transition-fast);
        }

        .message:hover {
            background: rgba(30, 64, 175, 0.05);
        }

        .message.urgent {
            background: rgba(220, 38, 38, 0.1);
            border-left: 4px solid var(--color-critical);
        }

        .message.system {
            background: rgba(139, 92, 246, 0.1);
            border-left: 4px solid var(--ai-accent);
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            font-weight: 700;
            flex-shrink: 0;
        }

        .message-content {
            flex: 1;
            min-width: 0;
        }

        .message-header {
            display: flex;
            align-items: baseline;
            gap: 0.5rem;
            margin-bottom: 0.25rem;
        }

        .message-sender {
            font-weight: 700;
            color: var(--text-color-base);
            font-size: 0.9rem;
        }

        .message-role {
            background: var(--primary-color);
            color: white;
            padding: 0.1rem 0.4rem;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .message-timestamp {
            color: var(--text-color-light);
            font-size: 0.75rem;
        }

        .message-text {
            color: var(--text-color-base);
            line-height: 1.5;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .message-attachments {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 0.5rem;
        }

        .attachment {
            background: var(--bg-color-light);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 0.5rem 0.75rem;
            font-size: 0.8rem;
            color: var(--primary-color);
            text-decoration: none;
            transition: var(--transition-fast);
        }

        .attachment:hover {
            background: var(--primary-color);
            color: white;
        }

        .message-actions {
            display: flex;
            gap: 0.25rem;
            margin-top: 0.5rem;
        }

        .message-action {
            padding: 0.25rem 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: white;
            color: var(--text-color-light);
            font-size: 0.7rem;
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .message-action:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* Pinned Messages */
        .pinned-messages {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .pinned-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
            font-weight: 700;
            color: var(--color-warning);
        }

        .pinned-message {
            background: white;
            border-radius: 6px;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .pinned-message:last-child {
            margin-bottom: 0;
        }

        /* Message Input */
        .message-input-container {
            padding: 1rem 1.5rem;
            background: var(--bg-color-card);
            border-top: 1px solid var(--border-color);
            flex-shrink: 0;
        }

        .message-input-wrapper {
            position: relative;
            display: flex;
            gap: 0.5rem;
            align-items: flex-end;
        }

        .message-input {
            flex: 1;
            min-height: 40px;
            max-height: 120px;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            resize: none;
            font-family: inherit;
            font-size: 0.9rem;
            line-height: 1.4;
            transition: var(--transition-fast);
        }

        .message-input:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
        }

        .input-actions {
            display: flex;
            gap: 0.25rem;
        }

        .input-action-btn {
            width: 40px;
            height: 40px;
            border: 1px solid var(--border-color);
            border-radius: 50%;
            background: white;
            color: var(--text-color-light);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition-fast);
            font-size: 1.1rem;
        }

        .input-action-btn:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .send-btn {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .send-btn:hover {
            background: var(--primary-dark);
        }

        /* Typing Indicator */
        .typing-indicator {
            padding: 0.5rem 1.5rem;
            font-size: 0.8rem;
            color: var(--text-color-light);
            font-style: italic;
        }

        .typing-dots {
            display: inline-flex;
            gap: 0.2rem;
        }

        .typing-dot {
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: var(--text-color-light);
            animation: typingDot 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typingDot {
            0%, 80%, 100% { opacity: 0.3; transform: scale(0.8); }
            40% { opacity: 1; transform: scale(1); }
        }

        .mobile-sidebar-toggle {
            display: none;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            border-radius: 8px;
            padding: 0.6rem;
            cursor: pointer;
            font-size: 1.1rem;
            transition: var(--transition-fast);
        }

        .mobile-sidebar-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Responsive Design for Team Chat */
        @media (max-width: 768px) {
            .team-chat-modal {
                width: 100%;
                height: 100vh;
                max-height: none;
                border-radius: 0;
            }

            .chat-sidebar {
                width: 100%;
                position: absolute;
                top: 0;
                left: -100%;
                height: 100%;
                z-index: 10;
                transition: left 0.3s ease;
                background: var(--bg-color-card);
            }

            .chat-sidebar.open {
                left: 0;
            }

            .mobile-sidebar-toggle {
                display: block !important;
            }

            .staff-list {
                max-height: 200px;
                overflow-y: auto;
            }

            .message-input-wrapper {
                flex-direction: column;
                gap: 0.75rem;
            }

            .input-actions {
                align-self: flex-end;
            }
        }
    </style>
    <style>
        /* Floating Action Button */
        .fab {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--color-critical);
            color: white;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            transition: var(--transition-smooth);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
        }
        .fab:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-xl);
            background: #991b1b;
        }
        .fab:active {
            transform: scale(0.95);
        }
        .fab-icon {
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
            animation: bounce 2s infinite;
        }
        /* AI Insights Grid */
        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        .insight-card {
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid var(--ai-accent);
            position: relative;
            transition: var(--transition-fast);
            cursor: pointer;
        }
        .insight-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }
        .insight-card.critical {
            background: linear-gradient(135deg, #fef2f2 0%, #ffffff 100%);
            border-left-color: var(--color-critical);
        }
        .insight-card.warning {
            background: linear-gradient(135deg, #fffbeb 0%, #ffffff 100%);
            border-left-color: var(--color-warning);
        }
        .insight-card.info {
            background: linear-gradient(135deg, #f0f9ff 0%, #ffffff 100%);
            border-left-color: var(--primary-color);
        }
        .insight-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }
        .insight-title {
            font-weight: 700;
            font-size: 0.95rem;
            color: var(--text-color-base);
        }
        .confidence-badge {
            padding: 0.3rem 0.8rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 700;
            color: white;
        }
        .confidence-badge.high {
            background: var(--color-critical);
        }
        .confidence-badge.medium {
            background: var(--color-warning);
        }
        .confidence-badge.low {
            background: var(--ai-accent);
        }
        .insight-description {
            font-size: 0.9rem;
            color: var(--text-color-light);
            line-height: 1.5;
            margin-bottom: 1rem;
        }
        .insight-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
    </style>
    <style>
        /* Responsive Design */
        @media (max-width: 1024px) {
            .content-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            .kpi-container {
                grid-template-columns: repeat(2, 1fr);
            }
            .insights-grid {
                grid-template-columns: 1fr;
            }
            .notification-log-modal {
                width: calc(100vw - 2rem);
            }
        }
        @media (max-width: 768px) {
            .main-nav {
                display: none;
            }
            .mobile-menu-btn {
                display: block;
            }
            .header-content {
                gap: 1rem;
            }
            .header-left {
                gap: 1rem;
            }
            .logo-text {
                display: none;
            }
            .status-pill {
                padding: 0.4rem 0.8rem;
                font-size: 0.75rem;
            }
            .alert-banner {
                flex-direction: column;
                gap: 0.75rem;
                text-align: center;
                padding: 1rem;
            }
            .alert-content {
                flex-direction: column;
                gap: 0.5rem;
            }
            .kpi-container {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }
            .kpi-card {
                padding: 1rem;
            }
            .kpi-value {
                font-size: 2rem;
            }
            .main-content {
                padding: 1.5rem 1rem;
            }
            .panel {
                padding: 1rem;
            }
            .panel-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            .panel-actions {
                width: 100%;
                justify-content: flex-start;
            }
            .fab {
                bottom: 1rem;
                right: 1rem;
                width: 50px;
                height: 50px;
                font-size: 1.3rem;
            }
            .insight-actions {
                flex-direction: column;
            }
            .insight-actions .btn {
                width: 100%;
                justify-content: center;
            }
            .notification-log-modal {
                width: 95%;
                max-height: 95vh;
            }
            
            .notification-log-header {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }
            
            .notification-filters {
                padding: 1rem;
                flex-direction: column;
                align-items: stretch;
                gap: 1rem;
            }
            
            .filter-tabs {
                justify-content: center;
            }
            
            .notification-search {
                width: 100%;
            }
            
            .search-input {
                flex: 1;
            }
            
            .log-notification-item {
                padding: 1rem;
                flex-direction: column;
                align-items: stretch;
                gap: 0.75rem;
            }
            
            .notification-meta-header {
                flex-direction: column;
                align-items: stretch;
                gap: 0.5rem;
            }
        }
        @media (max-width: 480px) {
            .header-content {
                padding: 0 1rem;
            }
            .logo {
                font-size: 1.2rem;
            }
            .logo-icon {
                font-size: 1.5rem;
            }
            .status-pill span {
                display: none;
            }
            .more-dropdown {
                width: calc(100vw - 2rem);
                right: 1rem;
            }
            .kpi-container {
                grid-template-columns: 1fr;
            }
            .kpi-value {
                font-size: 2.5rem;
            }
            .incident-item {
                padding: 0.75rem;
            }
            .incident-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
            .incident-meta {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.25rem;
            }
        }
        /* Animations */
        @keyframes pulse {
            0%, 100% { 
                opacity: 1; 
                transform: scale(1); 
            }
            50% { 
                opacity: 0.7; 
                transform: scale(1.05); 
            }
        }
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.4; }
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { 
                transform: translateY(0); 
            }
            40% { 
                transform: translateY(-4px); 
            }
            60% { 
                transform: translateY(-2px); 
            }
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        @keyframes slideIn {
            from { 
                opacity: 0; 
                transform: translateX(100%); 
            }
            to { 
                opacity: 1; 
                transform: translateX(0); 
            }
        }
        @keyframes slideOut {
            from { 
                opacity: 1; 
                transform: translateX(0); 
            }
            to { 
                opacity: 0; 
                transform: translateX(100%); 
            }
        }
        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(20px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }
        @keyframes fadeOut {
            from { 
                opacity: 1; 
                transform: translateY(0); 
            }
            to { 
                opacity: 0; 
                transform: translateY(-20px); 
            }
        }
        /* Reduced motion preferences */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
        }
        /* High contrast mode */
        @media (prefers-contrast: high) {
            :root {
                --border-color: #000000;
                --text-color-light: #000000;
                --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.5);
                --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.5);
                --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
                --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.5);
            }
            .btn {
                border: 2px solid #000000 !important;
            }
            .panel {
                border: 2px solid #000000 !important;
            }
        }
        /* Print styles */
        @media print {
            .main-header,
            .alert-banner,
            .fab,
            .notification-log-overlay,
            .team-chat-overlay,
            .more-dropdown {
                display: none !important;
            }
            .kpi-row {
                margin-top: 0;
            }
            .main-content {
                padding: 1rem 0;
            }
            .panel {
                break-inside: avoid;
                margin-bottom: 1rem;
                box-shadow: none !important;
                border: 1px solid #000 !important;
            }
            .btn {
                border: 1px solid #000 !important;
                background: transparent !important;
                color: #000 !important;
            }
        }
        /* Loading states */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition-smooth);
        }
        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        /* Utility classes */
        .hidden {
            display: none !important;
        }
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        .text-center {
            text-align: center;
        }
        .text-left {
            text-align: left;
        }
        .text-right {
            text-align: right;
        }
        .mb-0 { margin-bottom: 0; }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .mb-4 { margin-bottom: 2rem; }
        .mt-0 { margin-top: 0; }
        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .mt-4 { margin-top: 2rem; }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <!-- Clean Compact Header -->
    <header class="main-header">
        <div class="header-content">
            <div class="header-left">
                <a href="crisis-command-center" class="logo" role="button" tabindex="0" aria-label="Crisis Command Center - Return to main dashboard">
                    <span class="logo-icon">ðŸ§ </span>
                    <span class="logo-text">Crisis Command</span>
                </a>
                
                <nav class="main-nav" role="navigation" aria-label="Main navigation">
                    <a href="ai-command-center.html" class="nav-item active" aria-label="AI Command Center - AI command and incident creation">Command</a>
                    <a href="context-intelligence-dashboard" class="nav-item" aria-label="Context Intelligence Dashboard - Deep analytics/tracing">Intelligence</a>
                    <a href="predictive-analytics-dashboard" class="nav-item" aria-label="Predictive Analysis - Forecasts, risk modeling, surge planning">Analysis</a>
                    <a href="map-reports" class="nav-item" aria-label="Live Emergency Map - Geospatial resource/incident view">Map</a>
                </nav>
                <button class="mobile-menu-btn" onclick="toggleMobileMenu()" aria-label="Toggle mobile menu">
                    <span>â˜°</span>
                </button>
            </div>
            
            <div class="header-right">
                <div class="status-pill" role="status" aria-label="System status">
                    <div class="status-dot" id="statusDot"></div>
                    <span id="statusText">Online</span>
                </div>
                
                <div class="notification-bell" onclick="openNotificationLog()" role="button" tabindex="0" aria-label="Notifications - View/acknowledge alerts">
                    <span class="notification-icon">ðŸ””</span>
                    <div class="notification-count" id="notificationCount">3</div>
                </div>
                
                <div class="more-menu">
                    <button class="more-btn" onclick="toggleMoreMenu()" aria-label="More options menu">â‹¯</button>
                    <div class="more-dropdown" id="moreDropdown" role="menu">
                        <a href="triage-dashboard" class="dropdown-item" role="menuitem">
                            <span class="dropdown-icon">ðŸš¨</span>
                            Active Incidents
                        </a>
                        <a href="real-time-resource-optimizer" class="dropdown-item" role="menuitem">
                            <span class="dropdown-icon">ðŸš’</span>
                            Resource Management
                        </a>
                        <a href="analytics-dashboard" class="dropdown-item" role="menuitem">
                            <span class="dropdown-icon">ðŸ“Š</span>
                            Analytics
                        </a>
                        <a href="/report-archive" class="dropdown-item" role="menuitem">
                            <span class="dropdown-icon">ðŸ“š</span>
                            Archive
                        </a>
                        <a href="#" class="dropdown-item" onclick="openNotificationLog()" role="menuitem">
                            <span class="dropdown-icon">ðŸ””</span>
                            Notification Log
                        </a>
                        <a href="patient-tracker" class="dropdown-item" role="menuitem">
                            <span class="dropdown-icon">ðŸ“‹</span>
                            Patient Tracker
                        </a>
                        <a href="#" class="dropdown-item" onclick="showTemplates()" role="menuitem">
                            <span class="dropdown-icon">ðŸ“‹</span>
                            Templates
                        </a>
                        <a href="#" class="dropdown-item" onclick="exportReport()" role="menuitem">
                            <span class="dropdown-icon">ðŸ“„</span>
                            Export Report
                        </a>
                        <a href="#" class="dropdown-item" onclick="toggleChat()" role="menuitem">
                            <span class="dropdown-icon">ðŸ’¬</span>
                            Team Chat
                        </a>
                        <a href="#" class="dropdown-item" onclick="showSettings()" role="menuitem">
                            <span class="dropdown-icon">âš™ï¸</span>
                            Settings
                        </a>
                        <a href="#" class="dropdown-item" onclick="showHelp()" role="menuitem">
                            <span class="dropdown-icon">â“</span>
                            Help
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Enhanced Notification Log Modal -->
    <div class="notification-log-overlay" id="notificationLogOverlay" role="dialog" aria-labelledby="notificationLogTitle">
        <div class="notification-log-modal">
            <!-- Header -->
            <div class="notification-log-header">
                <div class="notification-log-title" id="notificationLogTitle">
                    ðŸ”” Notification Log
                </div>
                <div class="notification-log-controls">
                    <div class="live-indicator">
                        <div class="live-dot"></div>
                        <span>Live</span>
                    </div>
                    <button class="close-log-btn" onclick="closeNotificationLog()" aria-label="Close notification log">âœ•</button>
                </div>
            </div>
            
            <!-- Filters and Search -->
            <div class="notification-filters">
                <div class="filter-tabs" role="tablist">
                    <button class="filter-tab active" data-filter="all" role="tab" onclick="filterNotifications('all')">All</button>
                    <button class="filter-tab" data-filter="critical" role="tab" onclick="filterNotifications('critical')">Critical</button>
                    <button class="filter-tab" data-filter="operational" role="tab" onclick="filterNotifications('operational')">Operational</button>
                    <button class="filter-tab" data-filter="communication" role="tab" onclick="filterNotifications('communication')">Communication</button>
                    <button class="filter-tab" data-filter="resolved" role="tab" onclick="filterNotifications('resolved')">Resolved</button>
                </div>
                
                <div class="notification-search">
                    <input type="text" class="search-input" placeholder="Search notifications..." id="notificationSearchInput" oninput="searchNotifications()" aria-label="Search notifications">
                    <div class="bulk-actions">
                        <button class="btn btn-sm btn-outline" onclick="markAllRead()" aria-label="Mark all as read">Mark All Read</button>
                        <button class="btn btn-sm btn-outline" onclick="acknowledgeAll()" aria-label="Acknowledge all">Acknowledge All</button>
                    </div>
                </div>
            </div>
            
            <!-- Notification Content -->
            <div class="notification-log-content">
                <div class="notification-log-list" id="notificationLogList" role="list">
                    <!-- Recent Active Alerts -->
                    <div class="log-notification-item critical unread" data-category="critical" data-id="1" onclick="selectNotification(1)">
                        <div class="unread-indicator"></div>
                        <div class="notification-type-icon">âš ï¸</div>
                        <div class="notification-details">
                            <div class="notification-meta-header">
                                <div class="notification-category-badge badge-critical">Critical Incident</div>
                                <div class="notification-timestamp">4 minutes ago</div>
                            </div>
                            <div class="notification-log-subject">Structure Fire - Oak Street, Expansion Detected</div>
                            <div class="notification-log-message">
                                Multi-story residential building fire has spread to adjacent structures. 15+ occupants potentially affected. Immediate escalation required.
                            </div>
                            <div class="notification-actions">
                                <button class="action-btn acknowledge" onclick="acknowledgeNotification(1, event)">âœ“ Acknowledge</button>
                                <a href="patient_tracker.html?incident=fire-001" class="action-btn" onclick="event.stopPropagation()">ðŸ“‹ View Details</a>
                                <button class="action-btn" onclick="escalateNotification(1, event)">ðŸš¨ Escalate</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="log-notification-item operational unread" data-category="operational" data-id="2" onclick="selectNotification(2)">
                        <div class="unread-indicator"></div>
                        <div class="notification-type-icon">ðŸš¨</div>
                        <div class="notification-details">
                            <div class="notification-meta-header">
                                <div class="notification-category-badge badge-operational">New Patient</div>
                                <div class="notification-timestamp">7 minutes ago</div>
                            </div>
                            <div class="notification-log-subject">MVA Highway 101 - Multiple Casualties</div>
                            <div class="notification-log-message">
                                Multi-vehicle accident with 3+ vehicles involved. Traffic backup extending 2.1 miles. Potential injuries reported.
                            </div>
                            <div class="notification-actions">
                                <button class="action-btn acknowledge" onclick="acknowledgeNotification(2, event)">âœ“ Acknowledge</button>
                                <a href="patient_tracker.html?incident=mva-002" class="action-btn" onclick="event.stopPropagation()">ðŸ“‹ View Details</a>
                                <button class="action-btn" onclick="dispatchResources(2, event)">ðŸš’ Dispatch</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="log-notification-item communication" data-category="communication" data-id="3" onclick="selectNotification(3)">
                        <div class="notification-type-icon">ðŸ§ </div>
                        <div class="notification-details">
                            <div class="notification-meta-header">
                                <div class="notification-category-badge badge-communication">System Update</div>
                                <div class="notification-timestamp">12 minutes ago</div>
                            </div>
                            <div class="notification-log-subject">AI Analysis Complete - Risk Assessment Updated</div>
                            <div class="notification-log-message">
                                Machine learning models have identified new fire risk zones in downtown area. Predictive accuracy: 94.2%
                            </div>
                            <div class="notification-actions">
                                <a href="predictive-analytics-dashboard.html" class="action-btn" onclick="event.stopPropagation()">ðŸ“Š View Analysis</a>
                                <button class="action-btn" onclick="shareAnalysis(3, event)">ðŸ“¤ Share</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="log-notification-item operational" data-category="operational" data-id="4" onclick="selectNotification(4)">
                        <div class="notification-type-icon">â²ï¸</div>
                        <div class="notification-details">
                            <div class="notification-meta-header">
                                <div class="notification-category-badge badge-operational">Task Reminder</div>
                                <div class="notification-timestamp">25 minutes ago</div>
                            </div>
                            <div class="notification-log-subject">Shift Change Protocol Reminder</div>
                            <div class="notification-log-message">
                                Evening shift transition begins in 30 minutes. Please complete handoff documentation.
                            </div>
                            <div class="notification-actions">
                                <button class="action-btn acknowledge" onclick="acknowledgeNotification(4, event)">âœ“ Acknowledge</button>
                                <a href="analytics_dashboard.html" class="action-btn" onclick="event.stopPropagation()">ðŸ“‹ View Tasks</a>
                            </div>
                        </div>
                    </div>
                    
                    <div class="log-notification-item communication" data-category="communication" data-id="5" onclick="selectNotification(5)">
                        <div class="notification-type-icon">ðŸ’¬</div>
                        <div class="notification-details">
                            <div class="notification-meta-header">
                                <div class="notification-category-badge badge-communication">Communication</div>
                                <div class="notification-timestamp">1 hour ago</div>
                            </div>
                            <div class="notification-log-subject">Team Message - Resource Allocation Update</div>
                            <div class="notification-log-message">
                                Command has updated resource allocation protocols for high-priority incidents effective immediately.
                            </div>
                            <div class="notification-actions">
                                <a href="real-time-resource-optimizer.html" class="action-btn" onclick="event.stopPropagation()">ðŸš’ View Resources</a>
                                <button class="action-btn" onclick="viewProtocol(5, event)">ðŸ“– View Protocol</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Archived Section -->
                <div class="archived-section">
                    <div class="archived-header" onclick="toggleArchivedNotifications()">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <span id="archivedToggleIcon">â–¶</span>
                            <span>Older Notifications (24 total)</span>
                        </div>
                        <div style="font-size: 0.8rem; color: var(--text-color-light);">Click to expand</div>
                    </div>
                    <div class="archived-content" id="archivedContent">
                        <div class="log-notification-item resolved" data-category="resolved" data-id="6">
                            <div class="notification-type-icon">âœ…</div>
                            <div class="notification-details">
                                <div class="notification-meta-header">
                                    <div class="notification-category-badge badge-system">Resolved</div>
                                    <div class="notification-timestamp">Yesterday 14:32</div>
                                </div>
                                <div class="notification-log-subject">Medical Emergency - Main Street Resolved</div>
                                <div class="notification-log-message">Patient successfully transported to hospital. All units returned to service.</div>
                            </div>
                        </div>
                        
                        <div class="log-notification-item resolved" data-category="resolved" data-id="7">
                            <div class="notification-type-icon">ðŸ› ï¸</div>
                            <div class="notification-details">
                                <div class="notification-meta-header">
                                    <div class="notification-category-badge badge-system">System</div>
                                    <div class="notification-timestamp">Yesterday 02:15</div>
                                </div>
                                <div class="notification-log-subject">Scheduled Maintenance Completed</div>
                                <div class="notification-log-message">System maintenance window completed successfully. All services restored.</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Team Chat Modal/Overlay -->
    <div class="team-chat-overlay" id="teamChatOverlay" role="dialog" aria-labelledby="teamChatTitle">
        <div class="team-chat-modal">
            <!-- Chat Header -->
            <div class="chat-header">
                <button class="mobile-sidebar-toggle" onclick="toggleChatSidebar()" aria-label="Toggle sidebar">
                    â˜°
                </button>
                <div class="chat-title" id="teamChatTitle">
                    ðŸ’¬ Team Chat - Crisis Operations
                </div>
                <div class="chat-controls">
                    <div class="chat-status">
                        <div class="online-count"></div>
                        <span id="onlineCount">12 online</span>
                    </div>
                    <button class="close-chat-btn" onclick="closeTeamChat()" aria-label="Close team chat">âœ•</button>
                </div>
            </div>

            <!-- Chat Body -->
            <div class="chat-body">
                <!-- Sidebar -->
                <div class="chat-sidebar" id="chatSidebar">
                    <!-- Channel Header -->
                    <div class="channel-header">
                        <input type="text" class="channel-search" placeholder="Search channels..." aria-label="Search channels">
                    </div>

                    <!-- Channels List -->
                    <div class="channels-list">
                        <div class="channel-group">
                            <div class="channel-group-title">Active Operations</div>
                            <div class="channel-item active" onclick="switchChannel('operations')">
                                <div class="channel-info">
                                    <span class="channel-icon">ðŸš¨</span>
                                    <span class="channel-name">Crisis Room</span>
                                </div>
                                <span class="unread-badge">3</span>
                            </div>
                            <div class="channel-item" onclick="switchChannel('fire-oak-st')">
                                <div class="channel-info">
                                    <span class="channel-icon">ðŸ”¥</span>
                                    <span class="channel-name">Oak Street Fire</span>
                                </div>
                                <span class="unread-badge">7</span>
                            </div>
                            <div class="channel-item" onclick="switchChannel('highway-mva')">
                                <div class="channel-info">
                                    <span class="channel-icon">ðŸš—</span>
                                    <span class="channel-name">Highway MVA</span>
                                </div>
                            </div>
                        </div>

                        <div class="channel-group">
                            <div class="channel-group-title">Departments</div>
                            <div class="channel-item" onclick="switchChannel('medical')">
                                <div class="channel-info">
                                    <span class="channel-icon">ðŸš‘</span>
                                    <span class="channel-name">Medical</span>
                                </div>
                                <span class="unread-badge">1</span>
                            </div>
                            <div class="channel-item" onclick="switchChannel('logistics')">
                                <div class="channel-info">
                                    <span class="channel-icon">ðŸ“¦</span>
                                    <span class="channel-name">Logistics</span>
                                </div>
                            </div>
                            <div class="channel-item" onclick="switchChannel('command')">
                                <div class="channel-info">
                                    <span class="channel-icon">â­</span>
                                    <span class="channel-name">Command Staff</span>
                                </div>
                            </div>
                            <div class="channel-item" onclick="switchChannel('field-teams')">
                                <div class="channel-info">
                                    <span class="channel-icon">ðŸŽ¯</span>
                                    <span class="channel-name">Field Teams</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Online Staff -->
                    <div class="online-staff">
                        <div class="staff-title">Online Staff (12)</div>
                        <div class="staff-list">
                            <div class="staff-member">
                                <div class="staff-avatar online">IC</div>
                                <div>
                                    <div class="staff-name">Incident Commander</div>
                                    <div class="staff-role">Command</div>
                                </div>
                            </div>
                            <div class="staff-member">
                                <div class="staff-avatar online">DS</div>
                                <div>
                                    <div class="staff-name">Dispatch</div>
                                    <div class="staff-role">Communications</div>
                                </div>
                            </div>
                            <div class="staff-member">
                                <div class="staff-avatar online">ML</div>
                                <div>
                                    <div class="staff-name">Medical Lead</div>
                                    <div class="staff-role">EMS</div>
                                </div>
                            </div>
                            <div class="staff-member">
                                <div class="staff-avatar online">E15</div>
                                <div>
                                    <div class="staff-name">Engine 15</div>
                                    <div class="staff-role">Fire</div>
                                </div>
                            </div>
                            <div class="staff-member">
                                <div class="staff-avatar online">A4</div>
                                <div>
                                    <div class="staff-name">Ambulance 4</div>
                                    <div class="staff-role">EMS</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Main Chat Area -->
                <div class="chat-main">
                    <!-- Messages Header -->
                    <div class="chat-messages-header">
                        <div class="current-channel">
                            <div>
                                <div class="current-channel-name"># Crisis Room</div>
                                <div class="channel-description">Main operations channel for all staff</div>
                            </div>
                        </div>
                        <div class="chat-actions">
                            <button class="chat-action-btn" onclick="searchMessages()">
                                ðŸ” Search
                            </button>
                            <button class="chat-action-btn" onclick="viewChatHistory()">
                                ðŸ“š History
                            </button>
                            <button class="chat-action-btn" onclick="pinMessage()">
                                ðŸ“Œ Pin
                            </button>
                        </div>
                    </div>

                    <!-- Messages Container -->
                    <div class="messages-container" id="messagesContainer">
                        <!-- Pinned Messages -->
                        <div class="pinned-messages">
                            <div class="pinned-header">
                                ðŸ“Œ Pinned Messages
                            </div>
                            <div class="pinned-message">
                                <strong>Incident Commander:</strong> All units maintain radio contact every 10 minutes. Safety first.
                            </div>
                            <div class="pinned-message">
                                <strong>Dispatch:</strong> Weather update: High winds expected in next 2 hours. Be advised.
                            </div>
                        </div>

                        <!-- Recent Messages -->
                        <div class="message urgent">
                            <div class="message-avatar">IC</div>
                            <div class="message-content">
                                <div class="message-header">
                                    <span class="message-sender">Incident Commander</span>
                                    <span class="message-role">Command</span>
                                    <span class="message-timestamp">2 minutes ago</span>
                                </div>
                                <div class="message-text">
                                    ðŸš¨ <strong>URGENT:</strong> Structure fire on Oak Street has spread to adjacent building. All available units respond immediately. @Medical Lead prepare for potential casualties.
                                </div>
                                <div class="message-attachments">
                                    <a href="#" class="attachment" onclick="openIncidentDetails('fire-001')">ðŸ”¥ Oak Street Fire Details</a>
                                    <a href="#" class="attachment" onclick="openResourceMap()">ðŸ—ºï¸ Resource Map</a>
                                </div>
                                <div class="message-actions">
                                    <button class="message-action" onclick="acknowledgeMessage(1)">ðŸ‘ Acknowledged (5)</button>
                                    <button class="message-action" onclick="replyToMessage(1)">ðŸ’¬ Reply</button>
                                    <button class="message-action" onclick="pinMessage(1)">ðŸ“Œ Pin</button>
                                </div>
                            </div>
                        </div>

                        <div class="message">
                            <div class="message-avatar">E15</div>
                            <div class="message-content">
                                <div class="message-header">
                                    <span class="message-sender">Engine 15</span>
                                    <span class="message-role">Fire</span>
                                    <span class="message-timestamp">3 minutes ago</span>
                                </div>
                                <div class="message-text">
                                    Acknowledged. ETA 4 minutes to Oak Street. Requesting ladder support for rescue operations.
                                </div>
                                <div class="message-actions">
                                    <button class="message-action" onclick="acknowledgeMessage(2)">ðŸ‘ Acknowledged (2)</button>
                                    <button class="message-action" onclick="replyToMessage(2)">ðŸ’¬ Reply</button>
                                </div>
                            </div>
                        </div>

                        <div class="message">
                            <div class="message-avatar">ML</div>
                            <div class="message-content">
                                <div class="message-header">
                                    <span class="message-sender">Medical Lead</span>
                                    <span class="message-role">EMS</span>
                                    <span class="message-timestamp">4 minutes ago</span>
                                </div>
                                <div class="message-text">
                                    Two ambulances en route. Setting up triage at corner of Oak and Main. @Ambulance 4 coordinate with me on arrival.
                                </div>
                                <div class="message-attachments">
                                    <a href="#" class="attachment" onclick="openPatientTracker()">ðŸ¥ Patient Tracker</a>
                                </div>
                                <div class="message-actions">
                                    <button class="message-action" onclick="acknowledgeMessage(3)">ðŸ‘ Acknowledged (3)</button>
                                    <button class="message-action" onclick="replyToMessage(3)">ðŸ’¬ Reply</button>
                                </div>
                            </div>
                        </div>

                        <div class="message system">
                            <div class="message-avatar">ðŸ§ </div>
                            <div class="message-content">
                                <div class="message-header">
                                    <span class="message-sender">AI System</span>
                                    <span class="message-role">System</span>
                                    <span class="message-timestamp">5 minutes ago</span>
                                </div>
                                <div class="message-text">
                                    ðŸ“Š AI Analysis: Fire spread probability increased to 78%. Recommend evacuating buildings within 2-block radius. Wind patterns suggest northeast spread.
                                </div>
                                <div class="message-attachments">
                                    <a href="#" class="attachment" onclick="openPredictiveAnalysis()">ðŸ“ˆ Predictive Analysis</a>
                                    <a href="#" class="attachment" onclick="openEvacuationMap()">ðŸ—ºï¸ Evacuation Zones</a>
                                </div>
                                <div class="message-actions">
                                    <button class="message-action" onclick="acknowledgeMessage(4)">ðŸ‘ Noted (8)</button>
                                    <button class="message-action" onclick="shareAnalysis(4)">ðŸ“¤ Share</button>
                                </div>
                            </div>
                        </div>

                        <div class="message">
                            <div class="message-avatar">DS</div>
                            <div class="message-content">
                                <div class="message-header">
                                    <span class="message-sender">Dispatch</span>
                                    <span class="message-role">Communications</span>
                                    <span class="message-timestamp">6 minutes ago</span>
                                </div>
                                <div class="message-text">
                                    Highway 101 MVA cleared. Units returning to service. Available for Oak Street support if needed.
                                </div>
                                <div class="message-actions">
                                    <button class="message-action" onclick="acknowledgeMessage(5)">ðŸ‘ Copy (4)</button>
                                    <button class="message-action" onclick="requestSupport(5)">ðŸš’ Request Support</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Typing Indicator -->
                    <div class="typing-indicator" id="typingIndicator" style="display: none;">
                        <span id="typingUsers">Medical Lead</span> is typing
                        <span class="typing-dots">
                            <span class="typing-dot"></span>
                            <span class="typing-dot"></span>
                            <span class="typing-dot"></span>
                        </span>
                    </div>

                    <!-- Message Input -->
                    <div class="message-input-container">
                        <div class="message-input-wrapper">
                            <textarea 
                                class="message-input" 
                                id="messageInput" 
                                placeholder="Type your message... Use @name to mention someone, #incident to reference cases"
                                rows="1"
                                onkeydown="handleMessageInput(event)"
                                oninput="adjustTextareaHeight(this)"
                                aria-label="Type your message"
                            ></textarea>
                            <div class="input-actions">
                                <button class="input-action-btn" onclick="attachFile()" aria-label="Attach file" title="Attach file">
                                    ðŸ“Ž
                                </button>
                                <button class="input-action-btn" onclick="insertEmoji()" aria-label="Insert emoji" title="Insert emoji">
                                    ðŸ˜Š
                                </button>
                                <button class="input-action-btn" onclick="linkIncident()" aria-label="Link incident" title="Link incident">
                                    ðŸ”—
                                </button>
                                <button class="input-action-btn send-btn" onclick="sendMessage()" aria-label="Send message" title="Send message">
                                    âž¤
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Critical Alert Banner (only when active) -->
    <div class="alert-banner" id="alertBanner" role="alert" aria-live="assertive">
        <div class="alert-content">
            <span class="alert-icon">âš ï¸</span>
            <span class="alert-text" id="alertText">ALERT LEVEL 3 - Structure fire expanding to adjacent buildings</span>
        </div>
        <div class="alert-actions">
            <div class="alert-time" id="alertTime">Updated 23s ago</div>
            <button class="alert-close" onclick="dismissAlert()" aria-label="Dismiss alert">âœ•</button>
        </div>
    </div>

    <!-- Clean KPI Cards Row -->
    <div class="kpi-row">
        <div class="kpi-container">
            <div class="kpi-card ai-enhanced" onclick="showDetails('reports')" role="button" tabindex="0" aria-label="AI Processed Reports: 127, up 15 this hour">
                <div class="kpi-value ai-value" id="kpiReports">127</div>
                <div class="kpi-label">AI Processed</div>
                <div class="kpi-trend trend-up">â†— +15 this hour</div>
                <div class="kpi-update-time">
                    <div class="update-dot"></div>
                    <span>Updated 12s ago</span>
                </div>
            </div>
            
            <div class="kpi-card critical" onclick="showDetails('incidents')" role="button" tabindex="0" aria-label="Active Incidents: 7, down 2 today">
                <div class="kpi-value critical-value" id="kpiIncidents">7</div>
                <div class="kpi-label">Active Incidents</div>
                <div class="kpi-trend trend-down">â†˜ -2 today</div>
                <div class="kpi-update-time">
                    <div class="update-dot"></div>
                    <span>Updated 5s ago</span>
                </div>
            </div>
            
            <div class="kpi-card ai-enhanced" onclick="showDetails('risk')" role="button" tabindex="0" aria-label="AI Risk Score: 7.2 out of 10, stable">
                <div class="kpi-value ai-value" id="kpiRisk">7.2</div>
                <div class="kpi-label">AI Risk Score</div>
                <div class="kpi-trend trend-stable">â†’ Stable</div>
                <div class="kpi-update-time">
                    <div class="update-dot"></div>
                    <span>Updated 3s ago</span>
                </div>
            </div>
            
            <div class="kpi-card" onclick="showDetails('resources')" role="button" tabindex="0" aria-label="Units Deployed: 45, optimal level">
                <div class="kpi-value" id="kpiResources">45</div>
                <div class="kpi-label">Units Deployed</div>
                <div class="kpi-trend trend-stable">â†’ Optimal</div>
                <div class="kpi-update-time">
                    <div class="update-dot"></div>
                    <span>Updated 18s ago</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content" role="main">
        <!-- Command Section -->
        <div id="command-section" class="section-content active">
            <div class="content-grid">
                <!-- AI-Enhanced Situation Map -->
                <div class="panel ai-enhanced">
                    <div class="panel-header">
                        <div class="panel-title">
                            <span class="panel-title-icon">ðŸ—ºï¸</span>
                            AI-Enhanced Situation Map
                        </div>
                        <div class="panel-actions">
                            <button class="btn btn-ai" onclick="runAIAnalysis()" aria-label="Run AI map analysis">
                                ðŸ§  AI Analysis
                            </button>
                            <a href="map-reports" class="btn btn-primary" aria-label="View full interactive map">
                                Full Map
                            </a>
                        </div>
                    </div>
                    <div class="panel-content">
                        <a href="map-reports" class="map-placeholder" role="button" tabindex="0" aria-label="Interactive AI-Enhanced Map - Click to open full view">
                            <div class="map-icon">ðŸ—ºï¸</div>
                            <div class="map-title">Interactive AI-Enhanced Map</div>
                            <div class="map-subtitle">Real-time incidents & predictive zones</div>
                            <div style="margin-top: 1rem;">
                                <div class="status-indicator online">
                                    <div class="status-dot-inline animated"></div>
                                    Live Data Active
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
                
                <!-- AI-Prioritized Incidents -->
                <div class="panel">
                    <div class="panel-header">
                        <div class="panel-title">
                            <span class="panel-title-icon">ðŸš¨</span>
                            Priority Incidents
                        </div>
                        <div class="panel-actions">
                            <button class="btn btn-ai" onclick="reprioritize()" aria-label="Re-prioritize incidents using AI">
                                ðŸŽ¯ Re-prioritize
                            </button>
                        </div>
                    </div>
                    <div class="panel-content">
                        <div class="incident-list" role="list" aria-label="Priority incidents">
                            <a href="patient_tracker.html?incident=fire-001" class="incident-item critical" role="listitem" tabindex="0" aria-label="Critical incident: Structure Fire on Oak Street">
                                <div class="incident-header">
                                    <div class="incident-title">
                                        <span class="incident-icon">ðŸ”¥</span>
                                        Structure Fire - Oak Street
                                    </div>
                                    <div class="incident-priority priority-critical">Critical</div>
                                </div>
                                <div class="incident-description">
                                    Multi-story residential. AI detected structural damage, 15+ occupants.
                                </div>
                                <div class="incident-meta">
                                    <span class="incident-priority-score">AI Priority: 9.7/10</span>
                                    <div class="incident-time">
                                        <div class="time-dot"></div>
                                        <span>Updated 8s ago</span>
                                    </div>
                                </div>
                            </a>
                            
                            <a href="patient_tracker.html?incident=mva-002" class="incident-item high" role="listitem" tabindex="0" aria-label="High priority incident: Vehicle accident on Highway 101">
                                <div class="incident-header">
                                    <div class="incident-title">
                                        <span class="incident-icon">ðŸš—</span>
                                        MVA Highway 101
                                    </div>
                                    <div class="incident-priority priority-high">High</div>
                                </div>
                                <div class="incident-description">
                                    Multi-vehicle accident. 3 vehicles, likely injuries, 2.1mi backup.
                                </div>
                                <div class="incident-meta">
                                    <span class="incident-priority-score">AI Priority: 7.3/10</span>
                                    <div class="incident-time">
                                        <div class="time-dot"></div>
                                        <span>Updated 32s ago</span>
                                    </div>
                                </div>
                            </a>
                            
                            <a href="patient_tracker.html?incident=med-003" class="incident-item normal" role="listitem" tabindex="0" aria-label="Normal priority incident: Medical emergency on Main Street">
                                <div class="incident-header">
                                    <div class="incident-title">
                                        <span class="incident-icon">ðŸš‘</span>
                                        Medical Emergency - Main St
                                    </div>
                                    <div class="incident-priority priority-normal">Normal</div>
                                </div>
                                <div class="incident-description">
                                    Elderly patient with chest pain. Stable vitals, no immediate danger.
                                </div>
                                <div class="incident-meta">
                                    <span class="incident-priority-score">AI Priority: 4.2/10</span>
                                    <div class="incident-time">
                                        <div class="time-dot"></div>
                                        <span>Updated 2m ago</span>
                                    </div>
                                </div>
                            </a>
                        </div>
                        
                        <div style="margin-top: 1rem; text-align: center;">
                            <a href="triage-dashboard" class="btn btn-outline" aria-label="View all active incidents">
                                ðŸ“‹ View All Incidents
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Intelligence Section -->
        <div id="intelligence-section" class="section-content">
            <div class="panel ai-enhanced">
                <div class="panel-header">
                    <div class="panel-title">
                        <span class="panel-title-icon">ðŸ”®</span>
                        Intelligence Dashboard
                    </div>
                    <div class="panel-actions">
                        <button class="btn btn-ai" onclick="runDeepAnalysis()" aria-label="Run deep intelligence analysis">
                            ðŸ§  Deep Analysis
                        </button>
                        <a href="context-intelligence-dashboard.html" class="btn btn-primary" aria-label="Open full intelligence dashboard">
                            Full Dashboard
                        </a>
                    </div>
                </div>
                <div class="panel-content">
                    <div style="text-align: center; padding: 3rem;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">ðŸ”®</div>
                        <div style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem;">AI Intelligence Center</div>
                        <div style="color: var(--text-color-light); margin-bottom: 2rem;">Advanced pattern recognition and threat analysis</div>
                        <div class="insights-grid">
                            <div class="insight-card info">
                                <div class="insight-header">
                                    <div class="insight-title">ðŸ“Š Pattern Analysis</div>
                                    <div class="confidence-badge medium">87% Complete</div>
                                </div>
                                <div class="insight-description">
                                    Analyzing historical incident patterns to predict future hotspots.
                                </div>
                            </div>
                            <div class="insight-card warning">
                                <div class="insight-header">
                                    <div class="insight-title">ðŸŒ¡ï¸ Environmental Monitoring</div>
                                    <div class="confidence-badge high">Real-time</div>
                                </div>
                                <div class="insight-description">
                                    Weather conditions indicate increased fire risk in zones 3-7.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analysis Section -->
        <div id="analysis-section" class="section-content">
            <div class="panel ai-enhanced">
                <div class="panel-header">
                    <div class="panel-title">
                        <span class="panel-title-icon">ðŸ“Š</span>
                        Predictive Analysis
                    </div>
                    <div class="panel-actions">
                        <button class="btn btn-ai" onclick="generateForecast()" aria-label="Generate predictive forecast">
                            ðŸ”® Generate Forecast
                        </button>
                        <a href="predictive-analytics-dashboard.html" class="btn btn-primary" aria-label="Open full analytics dashboard">
                            Full Analytics
                        </a>
                    </div>
                </div>
                <div class="panel-content">
                    <div style="text-align: center; padding: 3rem;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">ðŸ“Š</div>
                        <div style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem;">Predictive Analytics Engine</div>
                        <div style="color: var(--text-color-light); margin-bottom: 2rem;">Machine learning models for incident forecasting</div>
                        <div class="content-grid">
                            <div class="panel">
                                <div class="panel-header">
                                    <div class="panel-title">ðŸ”¥ Fire Risk Model</div>
                                </div>
                                <div style="padding: 1rem; text-align: center;">
                                    <div style="font-size: 2rem; color: var(--color-warning); margin-bottom: 0.5rem;">High</div>
                                    <div style="font-size: 0.9rem; color: var(--text-color-light);">Next 6 hours</div>
                                </div>
                            </div>
                            <div class="panel">
                                <div class="panel-header">
                                    <div class="panel-title">ðŸš— Traffic Incidents</div>
                                </div>
                                <div style="padding: 1rem; text-align: center;">
                                    <div style="font-size: 2rem; color: var(--color-optimal); margin-bottom: 0.5rem;">Low</div>
                                    <div style="font-size: 0.9rem; color: var(--text-color-light);">Next 4 hours</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Map Section -->
        <div id="map-section" class="section-content">
            <div class="panel ai-enhanced">
                <div class="panel-header">
                    <div class="panel-title">
                        <span class="panel-title-icon">ðŸ—ºï¸</span>
                        Live Emergency Map
                    </div>
                    <div class="panel-actions">
                        <button class="btn btn-ai" onclick="runAIAnalysis()" aria-label="Run AI map analysis">
                            ðŸ§  AI Analysis
                        </button>
                        <button class="btn btn-primary" onclick="toggleMapLayers()" aria-label="Toggle map layers">
                            ðŸ”„ Layers
                        </button>
                        <a href="map_reports" class="btn btn-primary" aria-label="Open full map interface">
                            Full Interface
                        </a>
                    </div>
                </div>
                <div class="panel-content">
                    <div style="height: 500px; background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 2px solid var(--primary-color); cursor: pointer;" onclick="window.location.href='map_reports.html'">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">ðŸ—ºï¸</div>
                        <div style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem; color: var(--primary-color);">Interactive Emergency Map</div>
                        <div style="color: var(--text-color-light); margin-bottom: 2rem; text-align: center;">
                            Real-time incident tracking, resource positioning, and AI-powered predictive zones
                        </div>
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap; justify-content: center;">
                            <div class="status-indicator online">
                                <div class="status-dot-inline animated"></div>
                                7 Active Incidents
                            </div>
                            <div class="status-indicator processing">
                                <div class="status-dot-inline animated"></div>
                                45 Resources Deployed
                            </div>
                            <div class="status-indicator online">
                                <div class="status-dot-inline animated"></div>
                                AI Predictions Active
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Floating Action Button -->
    <a href="#" class="fab" onclick="quickAction()" role="button" tabindex="0" aria-label="Quick action - Create new incident">
        <span class="fab-icon">ðŸš¨</span>
    </a>

    <script>
        // Team Chat Management System
        class TeamChatManager {
            constructor() {
                this.currentChannel = 'operations';
                this.isOpen = false;
                this.isMobileSidebarOpen = false;
                this.typingUsers = new Set();
                this.messages = [];
                this.onlineUsers = [
                    { id: 'ic', name: 'Incident Commander', role: 'Command', avatar: 'IC', online: true },
                    { id: 'dispatch', name: 'Dispatch', role: 'Communications', avatar: 'DS', online: true },
                    { id: 'medical', name: 'Medical Lead', role: 'EMS', avatar: 'ML', online: true },
                    { id: 'engine15', name: 'Engine 15', role: 'Fire', avatar: 'E15', online: true },
                    { id: 'ambulance4', name: 'Ambulance 4', role: 'EMS', avatar: 'A4', online: true }
                ];
                
                this.channels = {
                    operations: { name: 'Crisis Room', description: 'Main operations channel for all staff', icon: 'ðŸš¨' },
                    'fire-oak-st': { name: 'Oak Street Fire', description: 'Incident-specific coordination', icon: 'ðŸ”¥' },
                    'highway-mva': { name: 'Highway MVA', description: 'Traffic incident coordination', icon: 'ðŸš—' },
                    medical: { name: 'Medical', description: 'EMS and medical coordination', icon: 'ðŸš‘' },
                    logistics: { name: 'Logistics', description: 'Resource and supply coordination', icon: 'ðŸ“¦' },
                    command: { name: 'Command Staff', description: 'Command staff only', icon: 'â­' },
                    'field-teams': { name: 'Field Teams', description: 'Field operations coordination', icon: 'ðŸŽ¯' }
                };
                
                this.initialize();
            }
            
            initialize() {
                this.setupEventListeners();
                this.startTypingIndicator();
                console.log('ðŸ—¨ï¸ Team Chat initialized');
            }
            
            setupEventListeners() {
                // Auto-resize textarea
                const messageInput = document.getElementById('messageInput');
                if (messageInput) {
                    messageInput.addEventListener('input', (e) => {
                        this.adjustTextareaHeight(e.target);
                    });
                    
                    // Simulate typing indicator
                    let typingTimeout;
                    messageInput.addEventListener('input', () => {
                        this.showTypingIndicator('You');
                        clearTimeout(typingTimeout);
                        typingTimeout = setTimeout(() => {
                            this.hideTypingIndicator('You');
                        }, 2000);
                    });
                }
                
                // Click outside to close on mobile
                document.addEventListener('click', (e) => {
                    if (window.innerWidth <= 768 && this.isMobileSidebarOpen) {
                        const sidebar = document.getElementById('chatSidebar');
                        if (!sidebar.contains(e.target) && !e.target.classList.contains('mobile-sidebar-toggle')) {
                            this.toggleChatSidebar();
                        }
                    }
                });
            }
            
            open() {
                this.isOpen = true;
                const overlay = document.getElementById('teamChatOverlay');
                overlay.classList.add('open');
                
                // Focus message input
                setTimeout(() => {
                    const messageInput = document.getElementById('messageInput');
                    if (messageInput) messageInput.focus();
                }, 300);
                
                // Scroll to bottom of messages
                this.scrollToBottom();
                
                console.log('ðŸ—¨ï¸ Team Chat opened');
            }
            
            close() {
                this.isOpen = false;
                const overlay = document.getElementById('teamChatOverlay');
                overlay.classList.remove('open');
                
                // Close mobile sidebar if open
                if (this.isMobileSidebarOpen) {
                    this.toggleChatSidebar();
                }
                
                console.log('ðŸ—¨ï¸ Team Chat closed');
            }
            
            toggleChatSidebar() {
                this.isMobileSidebarOpen = !this.isMobileSidebarOpen;
                const sidebar = document.getElementById('chatSidebar');
                sidebar.classList.toggle('open', this.isMobileSidebarOpen);
            }
            
            switchChannel(channelId) {
                this.currentChannel = channelId;
                
                // Update active channel in sidebar
                document.querySelectorAll('.channel-item').forEach(item => {
                    item.classList.remove('active');
                });
                event.target.closest('.channel-item').classList.add('active');
                
                // Update header
                const channel = this.channels[channelId];
                if (channel) {
                    document.querySelector('.current-channel-name').textContent = `# ${channel.name}`;
                    document.querySelector('.channel-description').textContent = channel.description;
                }
                
                // Load channel messages (simulated)
                this.loadChannelMessages(channelId);
                
                // Close mobile sidebar after selection
                if (window.innerWidth <= 768 && this.isMobileSidebarOpen) {
                    this.toggleChatSidebar();
                }
                
                console.log(`ðŸ—¨ï¸ Switched to channel: ${channelId}`);
            }
            
            loadChannelMessages(channelId) {
                // Simulate loading different messages for different channels
                // In a real implementation, this would fetch from a backend
                console.log(`Loading messages for channel: ${channelId}`);
            }
            
            sendMessage() {
                const input = document.getElementById('messageInput');
                const message = input.value.trim();
                
                if (!message) return;
                
                // Create message object
                const newMessage = {
                    id: Date.now(),
                    sender: 'You',
                    role: 'Operations',
                    text: message,
                    timestamp: new Date(),
                    channel: this.currentChannel,
                    attachments: []
                };
                
                // Add to messages array
                this.messages.push(newMessage);
                
                // Clear input
                input.value = '';
                this.adjustTextareaHeight(input);
                
                // Add message to UI (simplified)
                this.addMessageToUI(newMessage);
                
                // Scroll to bottom
                this.scrollToBottom();
                
                // Simulate response after delay
                setTimeout(() => {
                    this.simulateResponse(message);
                }, 1000 + Math.random() * 2000);
                
                console.log('ðŸ“¤ Message sent:', message);
            }
            
            addMessageToUI(message) {
                const container = document.getElementById('messagesContainer');
                const messageElement = document.createElement('div');
                messageElement.className = 'message';
                
                messageElement.innerHTML = `
                    <div class="message-avatar">YOU</div>
                    <div class="message-content">
                        <div class="message-header">
                            <span class="message-sender">${message.sender}</span>
                            <span class="message-role">${message.role}</span>
                            <span class="message-timestamp">Just now</span>
                        </div>
                        <div class="message-text">${this.formatMessageText(message.text)}</div>
                        <div class="message-actions">
                            <button class="message-action" onclick="acknowledgeMessage(${message.id})">ðŸ‘ Acknowledged (0)</button>
                            <button class="message-action" onclick="replyToMessage(${message.id})">ðŸ’¬ Reply</button>
                        </div>
                    </div>
                `;
                
                container.appendChild(messageElement);
            }
            
            formatMessageText(text) {
                // Format @mentions and #incident references
                return text
                    .replace(/@(\w+)/g, '<strong style="color: var(--primary-color);">@$1</strong>')
                    .replace(/#(\w+)/g, '<strong style="color: var(--ai-accent);">#$1</strong>')
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            }
            
            simulateResponse(originalMessage) {
                const responses = [
                    { sender: 'Dispatch', role: 'Communications', avatar: 'DS', text: 'Copy that. Updating incident log.' },
                    { sender: 'Medical Lead', role: 'EMS', avatar: 'ML', text: 'Acknowledged. Standing by for updates.' },
                    { sender: 'Engine 15', role: 'Fire', avatar: 'E15', text: 'Received. Adjusting response accordingly.' },
                    { sender: 'AI System', role: 'System', avatar: 'ðŸ§ ', text: 'ðŸ“Š Analysis updated based on new information.' }
                ];
                
                const response = responses[Math.floor(Math.random() * responses.length)];
                
                const container = document.getElementById('messagesContainer');
                const messageElement = document.createElement('div');
                messageElement.className = 'message';
                
                messageElement.innerHTML = `
                    <div class="message-avatar">${response.avatar}</div>
                    <div class="message-content">
                        <div class="message-header">
                            <span class="message-sender">${response.sender}</span>
                            <span class="message-role">${response.role}</span>
                            <span class="message-timestamp">Just now</span>
                        </div>
                        <div class="message-text">${response.text}</div>
                        <div class="message-actions">
                            <button class="message-action" onclick="acknowledgeMessage(${Date.now()})">ðŸ‘ Acknowledged (0)</button>
                            <button class="message-action" onclick="replyToMessage(${Date.now()})">ðŸ’¬ Reply</button>
                        </div>
                    </div>
                `;
                
                container.appendChild(messageElement);
                this.scrollToBottom();
            }
            
            adjustTextareaHeight(textarea) {
                textarea.style.height = 'auto';
                textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
            }
            
            scrollToBottom() {
                const container = document.getElementById('messagesContainer');
                if (container) {
                    container.scrollTop = container.scrollHeight;
                }
            }
            
            showTypingIndicator(user) {
                this.typingUsers.add(user);
                this.updateTypingIndicator();
            }
            
            hideTypingIndicator(user) {
                this.typingUsers.delete(user);
                this.updateTypingIndicator();
            }
            
            updateTypingIndicator() {
                const indicator = document.getElementById('typingIndicator');
                const usersElement = document.getElementById('typingUsers');
                
                if (this.typingUsers.size > 0) {
                    const users = Array.from(this.typingUsers).filter(u => u !== 'You');
                    if (users.length > 0) {
                        usersElement.textContent = users.length === 1 ? users[0] : `${users.length} people`;
                        indicator.style.display = 'block';
                    } else {
                        indicator.style.display = 'none';
                    }
                } else {
                    indicator.style.display = 'none';
                }
            }
            
            startTypingIndicator() {
                // Simulate random typing indicators
                setInterval(() => {
                    if (Math.random() > 0.8 && this.isOpen) {
                        const users = ['Medical Lead', 'Dispatch', 'Engine 15'];
                        const randomUser = users[Math.floor(Math.random() * users.length)];
                        this.showTypingIndicator(randomUser);
                        
                        setTimeout(() => {
                            this.hideTypingIndicator(randomUser);
                        }, 2000 + Math.random() * 3000);
                    }
                }, 10000);
            }
        }

        // Enhanced Notification Log Functions
        class NotificationLogManager {
            constructor() {
                this.notifications = [];
                this.currentFilter = 'all';
                this.searchTerm = '';
                this.archivedExpanded = false;
                this.selectedNotifications = new Set();
                
                this.initializeNotifications();
            }
            
            initializeNotifications() {
                this.notifications = [
                    {
                        id: 1,
                        type: 'critical',
                        category: 'critical',
                        icon: 'âš ï¸',
                        subject: 'Structure Fire - Oak Street, Expansion Detected',
                        message: 'Multi-story residential building fire has spread to adjacent structures. 15+ occupants potentially affected. Immediate escalation required.',
                        timestamp: Date.now() - 240000, // 4 minutes ago
                        read: false,
                        acknowledged: false,
                        priority: 'critical',
                        linkedPage: 'patient_tracker.html?incident=fire-001'
                    },
                    {
                        id: 2,
                        type: 'operational',
                        category: 'operational',
                        icon: 'ðŸš¨',
                        subject: 'MVA Highway 101 - Multiple Casualties',
                        message: 'Multi-vehicle accident with 3+ vehicles involved. Traffic backup extending 2.1 miles. Potential injuries reported.',
                        timestamp: Date.now() - 420000, // 7 minutes ago
                        read: false,
                        acknowledged: false,
                        priority: 'high',
                        linkedPage: 'patient_tracker.html?incident=mva-002'
                    },
                    {
                        id: 3,
                        type: 'communication',
                        category: 'communication',
                        icon: 'ðŸ§ ',
                        subject: 'AI Analysis Complete - Risk Assessment Updated',
                        message: 'Machine learning models have identified new fire risk zones in downtown area. Predictive accuracy: 94.2%',
                        timestamp: Date.now() - 720000, // 12 minutes ago
                        read: true,
                        acknowledged: true,
                        priority: 'medium',
                        linkedPage: 'predictive-analytics-dashboard.html'
                    },
                    {
                        id: 4,
                        type: 'operational',
                        category: 'operational',
                        icon: 'â²ï¸',
                        subject: 'Shift Change Protocol Reminder',
                        message: 'Evening shift transition begins in 30 minutes. Please complete handoff documentation.',
                        timestamp: Date.now() - 1500000, // 25 minutes ago
                        read: true,
                        acknowledged: false,
                        priority: 'low',
                        linkedPage: 'analytics_dashboard.html'
                    },
                    {
                        id: 5,
                        type: 'communication',
                        category: 'communication',
                        icon: 'ðŸ’¬',
                        subject: 'Team Message - Resource Allocation Update',
                        message: 'Command has updated resource allocation protocols for high-priority incidents effective immediately.',
                        timestamp: Date.now() - 3600000, // 1 hour ago
                        read: true,
                        acknowledged: true,
                        priority: 'medium',
                        linkedPage: 'real-time-resource-optimizer.html'
                    }
                ];
            }
            
            openNotificationLog() {
                const overlay = document.getElementById('notificationLogOverlay');
                overlay.classList.add('open');
                this.renderNotifications();
                
                // Close any other open dropdowns
                if (crisisCommand.notificationsOpen) {
                    crisisCommand.toggleNotifications();
                }
                if (crisisCommand.moreMenuOpen) {
                    crisisCommand.toggleMoreMenu();
                }
                
                // Focus management for accessibility
                const firstFocusable = overlay.querySelector('button, input, [tabindex="0"]');
                if (firstFocusable) {
                    setTimeout(() => firstFocusable.focus(), 100);
                }
            }
            
            closeNotificationLog() {
                const overlay = document.getElementById('notificationLogOverlay');
                overlay.classList.remove('open');
            }
            
            renderNotifications() {
                const container = document.getElementById('notificationLogList');
                const filteredNotifications = this.getFilteredNotifications();
                
                if (filteredNotifications.length === 0) {
                    container.innerHTML = `
                        <div class="no-notifications">
                            <div class="no-notifications-icon">ðŸ””</div>
                            <div>No notifications match your criteria</div>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = filteredNotifications.map(notification => {
                    const timeAgo = this.formatTimeAgo(notification.timestamp);
                    const unreadClass = notification.read ? '' : 'unread';
                    const categoryClass = notification.category;
                    
                    return `
                        <div class="log-notification-item ${categoryClass} ${unreadClass}" data-category="${notification.category}" data-id="${notification.id}" onclick="selectNotification(${notification.id})">
                            ${!notification.read ? '<div class="unread-indicator"></div>' : ''}
                            <div class="notification-type-icon">${notification.icon}</div>
                            <div class="notification-details">
                                <div class="notification-meta-header">
                                    <div class="notification-category-badge badge-${notification.category}">${this.getCategoryDisplayName(notification.category)}</div>
                                    <div class="notification-timestamp">${timeAgo}</div>
                                </div>
                                <div class="notification-log-subject">${notification.subject}</div>
                                <div class="notification-log-message">${notification.message}</div>
                                <div class="notification-actions">
                                    ${!notification.acknowledged ? `<button class="action-btn acknowledge" onclick="acknowledgeNotification(${notification.id}, event)">âœ“ Acknowledge</button>` : ''}
                                    ${notification.linkedPage ? `<a href="${notification.linkedPage}" class="action-btn" onclick="event.stopPropagation()">ðŸ“‹ View Details</a>` : ''}
                                    ${notification.priority === 'critical' ? `<button class="action-btn" onclick="escalateNotification(${notification.id}, event)">ðŸš¨ Escalate</button>` : ''}
                                    <button class="action-btn" onclick="shareNotification(${notification.id}, event)">ðŸ“¤ Share</button>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            getFilteredNotifications() {
                return this.notifications.filter(notification => {
                    // Filter by category
                    const categoryMatch = this.currentFilter === 'all' || notification.category === this.currentFilter;
                    
                    // Filter by search term
                    const searchMatch = !this.searchTerm || 
                        notification.subject.toLowerCase().includes(this.searchTerm.toLowerCase()) ||
                        notification.message.toLowerCase().includes(this.searchTerm.toLowerCase());
                    
                    return categoryMatch && searchMatch;
                }).sort((a, b) => b.timestamp - a.timestamp); // Most recent first
            }
            
            getCategoryDisplayName(category) {
                const names = {
                    critical: 'Critical Incident',
                    operational: 'Operational',
                    communication: 'Communication',
                    system: 'System Update',
                    resolved: 'Resolved'
                };
                return names[category] || category;
            }
            
            formatTimeAgo(timestamp) {
                const diff = Date.now() - timestamp;
                const minutes = Math.floor(diff / 60000);
                const hours = Math.floor(diff / 3600000);
                const days = Math.floor(diff / 86400000);
                
                if (minutes < 1) return 'Just now';
                if (minutes < 60) return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;
                if (hours < 24) return `${hours} hour${hours > 1 ? 's' : ''} ago`;
                if (days === 1) return 'Yesterday';
                if (days < 7) return `${days} days ago`;
                
                // Format as date for older notifications
                return new Date(timestamp).toLocaleDateString();
            }
            
            filterNotifications(category) {
                this.currentFilter = category;
                
                // Update active tab
                document.querySelectorAll('.filter-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelector(`[data-filter="${category}"]`).classList.add('active');
                
                this.renderNotifications();
                crisisCommand.showNotification(`Filtered to ${category} notifications`, 'info');
            }
            
            searchNotifications() {
                const input = document.getElementById('notificationSearchInput');
                this.searchTerm = input.value.trim();
                this.renderNotifications();
            }
            
            acknowledgeNotification(id, event) {
                event.stopPropagation();
                const notification = this.notifications.find(n => n.id === id);
                if (notification) {
                    notification.acknowledged = true;
                    notification.read = true;
                    this.renderNotifications();
                    crisisCommand.updateNotificationCount();
                    crisisCommand.showNotification('âœ“ Notification acknowledged', 'success');
                }
            }
            
            markAllRead() {
                this.notifications.forEach(n => n.read = true);
                this.renderNotifications();
                crisisCommand.updateNotificationCount();
                crisisCommand.showNotification('âœ“ All notifications marked as read', 'success');
            }
            
            acknowledgeAll() {
                const visibleNotifications = this.getFilteredNotifications();
                visibleNotifications.forEach(n => {
                    n.acknowledged = true;
                    n.read = true;
                });
                this.renderNotifications();
                crisisCommand.updateNotificationCount();
                crisisCommand.showNotification(`âœ“ ${visibleNotifications.length} notifications acknowledged`, 'success');
            }
            
            selectNotification(id) {
                const notification = this.notifications.find(n => n.id === id);
                if (notification) {
                    notification.read = true;
                    this.renderNotifications();
                    crisisCommand.updateNotificationCount();
                    
                    // Navigate to linked page if available
                    if (notification.linkedPage) {
                        crisisCommand.showNotification(`Opening ${notification.subject}...`, 'info');
                        setTimeout(() => {
                            window.location.href = notification.linkedPage;
                        }, 500);
                    }
                }
            }
            
            toggleArchivedNotifications() {
                this.archivedExpanded = !this.archivedExpanded;
                const content = document.getElementById('archivedContent');
                const icon = document.getElementById('archivedToggleIcon');
                
                if (this.archivedExpanded) {
                    content.classList.add('expanded');
                    icon.textContent = 'â–¼';
                } else {
                    content.classList.remove('expanded');
                    icon.textContent = 'â–¶';
                }
            }
            
            addNotification(notification) {
                notification.id = Date.now();
                notification.timestamp = Date.now();
                notification.read = false;
                notification.acknowledged = false;
                
                this.notifications.unshift(notification);
                
                // If log is open, update the display
                const overlay = document.getElementById('notificationLogOverlay');
                if (overlay.classList.contains('open')) {
                    this.renderNotifications();
                }
                
                crisisCommand.updateNotificationCount();
            }
        }

        // Clean Crisis Command Center JavaScript
        class CleanCrisisCommand {
            constructor() {
                this.currentSection = 'command';
                this.moreMenuOpen = false;
                this.notificationsOpen = false;
                this.mobileMenuOpen = false;
                this.isOnline = navigator.onLine;
                this.notifications = [];
                
                this.initialize();
            }
            
            initialize() {
                this.setupEventListeners();
                this.initializeNotifications();
                this.startRealTimeUpdates();
                this.hideLoading();
                console.log('ðŸš€ Clean Crisis Command Center initialized');
            }
            
            setupEventListeners() {
                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.altKey && e.key >= '1' && e.key <= '4') {
                        e.preventDefault();
                        const sections = ['command', 'intelligence', 'analysis', 'map'];
                        const sectionIndex = parseInt(e.key) - 1;
                        if (sections[sectionIndex]) {
                            this.showSection(sections[sectionIndex]);
                        }
                    }
                    if (e.key === 'Escape') {
                        this.closeAllDropdowns();
                    }
                    if (e.ctrlKey && e.key === 'n') {
                        e.preventDefault();
                        this.quickAction();
                    }
                    // Ctrl+T to open team chat
                    if (e.ctrlKey && e.key === 't') {
                        e.preventDefault();
                        openTeamChat();
                    }
                });
                
                // Close dropdowns when clicking outside
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.more-menu') && this.moreMenuOpen) {
                        this.toggleMoreMenu();
                    }
                });
                
                // Connection monitoring
                window.addEventListener('online', () => this.updateConnectionStatus(true));
                window.addEventListener('offline', () => this.updateConnectionStatus(false));
            }
            
            initializeNotifications() {
                this.notifications = [
                    {
                        id: 1,
                        type: 'critical',
                        icon: 'âš ï¸',
                        subject: 'Structure Fire Escalation',
                        message: 'Oak Street fire spreading to adjacent buildings. Immediate response required.',
                        timestamp: Date.now() - 120000,
                        read: false
                    },
                    {
                        id: 2,
                        type: 'warning',
                        icon: 'ðŸš—',
                        subject: 'Traffic Incident Alert',
                        message: 'Multi-vehicle accident on Highway 101. Traffic backup extending 2+ miles.',
                        timestamp: Date.now() - 300000,
                        read: false
                    },
                    {
                        id: 3,
                        type: 'info',
                        icon: 'ðŸ§ ',
                        subject: 'AI Analysis Complete',
                        message: 'Risk assessment updated. New fire risk zones identified in downtown area.',
                        timestamp: Date.now() - 480000,
                        read: true
                    }
                ];
                
                this.updateNotificationCount();
            }
            
            startRealTimeUpdates() {
                // Update timestamps every 5 seconds
                setInterval(() => {
                    this.updateTimestamps();
                }, 5000);
                
                // Simulate new notifications occasionally
                setInterval(() => {
                    if (Math.random() > 0.95) {
                        this.addRandomNotification();
                    }
                }, 30000);
                
                // Update KPI values
                setInterval(() => {
                    this.updateKPIValues();
                }, 10000);
            }
            
            // Navigation Methods
            showSection(sectionId) {
                this.currentSection = sectionId;
                
                // Hide all sections
                document.querySelectorAll('.section-content').forEach(section => {
                    section.classList.remove('active');
                });
                
                // Show target section
                const targetSection = document.getElementById(`${sectionId}-section`);
                if (targetSection) {
                    targetSection.classList.add('active');
                } else {
                    // Fallback to command section if target doesn't exist
                    document.getElementById('command-section').classList.add('active');
                }
                
                // Update active nav item
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                const activeItem = document.querySelector(`[onclick*="${sectionId}"]`);
                if (activeItem) {
                    activeItem.classList.add('active');
                }
                console.log(`Navigated to ${sectionId} section`);
                this.showNotification(`Switched to ${this.getSectionTitle(sectionId)}`, 'info');
            }
            
            getSectionTitle(sectionId) {
                const titles = {
                    command: 'Command Center',
                    intelligence: 'Intelligence Dashboard',
                    analysis: 'Analysis Tools',
                    map: 'Live Map View'
                };
                return titles[sectionId] || sectionId;
            }
            
            resetToDashboard() {
                this.showSection('command');
            }
            
            // Dropdown Management
            toggleMoreMenu() {
                this.moreMenuOpen = !this.moreMenuOpen;
                const dropdown = document.getElementById('moreDropdown');
                dropdown.classList.toggle('open', this.moreMenuOpen);
            }
            
            toggleMobileMenu() {
                this.mobileMenuOpen = !this.mobileMenuOpen;
                console.log('Mobile menu toggled:', this.mobileMenuOpen);
            }
            
            closeAllDropdowns() {
                if (this.moreMenuOpen) this.toggleMoreMenu();
                if (teamChatManager && teamChatManager.isOpen) {
                    closeTeamChat();
                }
                const logOverlay = document.getElementById('notificationLogOverlay');
                if (logOverlay && logOverlay.classList.contains('open')) {
                    closeNotificationLog();
                }
            }
            
            // Utility Methods
            updateConnectionStatus(online) {
                this.isOnline = online;
                const statusDot = document.getElementById('statusDot');
                const statusText = document.getElementById('statusText');
                
                if (online) {
                    statusDot.classList.remove('offline');
                    statusText.textContent = 'Online';
                } else {
                    statusDot.classList.add('offline');
                    statusText.textContent = 'Offline';
                }
            }
            
            updateNotificationCount() {
                const unreadCount = this.notifications.filter(n => !n.read).length;
                const countElement = document.getElementById('notificationCount');
                
                if (unreadCount > 0) {
                    countElement.textContent = unreadCount;
                    countElement.style.display = 'flex';
                } else {
                    countElement.style.display = 'none';
                }
            }
            
            updateTimestamps() {
                // Update alert time
                const alertTime = document.getElementById('alertTime');
                if (alertTime) {
                    const seconds = Math.floor(Math.random() * 60) + 1;
                    alertTime.textContent = `Updated ${seconds}s ago`;
                }
                
                // Update KPI timestamps
                document.querySelectorAll('.kpi-update-time span').forEach(span => {
                    const currentText = span.textContent;
                    if (currentText.includes('Updated') && currentText.includes('s ago')) {
                        const match = currentText.match(/(\d+)s ago/);
                        if (match) {
                            const newSeconds = parseInt(match[1]) + 5;
                            span.textContent = `Updated ${newSeconds}s ago`;
                        }
                    }
                });
            }
            
            updateKPIValues() {
                // Simulate KPI value changes
                const reports = document.getElementById('kpiReports');
                const incidents = document.getElementById('kpiIncidents');
                const risk = document.getElementById('kpiRisk');
                const resources = document.getElementById('kpiResources');
                
                if (reports) {
                    const currentValue = parseInt(reports.textContent);
                    reports.textContent = currentValue + Math.floor(Math.random() * 3);
                }
                
                if (risk) {
                    const currentValue = parseFloat(risk.textContent);
                    const change = (Math.random() - 0.5) * 0.2;
                    const newValue = Math.max(1.0, Math.min(10.0, currentValue + change));
                    risk.textContent = newValue.toFixed(1);
                }
            }
            
            addRandomNotification() {
                const randomNotifications = [
                    {
                        type: 'info',
                        icon: 'ðŸš’',
                        subject: 'Unit Deployment',
                        message: 'Engine 15 has been deployed to assist with ongoing operations.',
                    },
                    {
                        type: 'warning',
                        icon: 'ðŸŒ¡ï¸',
                        subject: 'Weather Alert',
                        message: 'High wind advisory issued for the next 4 hours.',
                    },
                    {
                        type: 'info',
                        icon: 'ðŸ“Š',
                        subject: 'AI Analysis',
                        message: 'Pattern analysis complete. No new threats detected.',
                    }
                ];
                
                const notification = randomNotifications[Math.floor(Math.random() * randomNotifications.length)];
                notification.id = Date.now();
                notification.timestamp = Date.now();
                notification.read = false;
                
                this.notifications.unshift(notification);
                this.updateNotificationCount();
                this.showNotification(`New ${notification.subject}`, 'info');
            }
            
            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                const colors = {
                    success: 'var(--color-optimal)',
                    error: 'var(--color-critical)',
                    warning: 'var(--color-warning)',
                    info: 'var(--primary-color)'
                };
                
                notification.style.cssText = `
                    position: fixed;
                    top: 80px;
                    right: 20px;
                    background: ${colors[type]};
                    color: white;
                    padding: 1rem 1.5rem;
                    border-radius: 8px;
                    font-weight: 600;
                    z-index: 10000;
                    animation: slideIn 0.3s ease;
                    box-shadow: var(--shadow-lg);
                    max-width: 300px;
                `;
                
                notification.textContent = message;
                notification.setAttribute('role', 'alert');
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            }
            
            hideLoading() {
                const loader = document.getElementById('loadingOverlay');
                if (loader) {
                    setTimeout(() => {
                        loader.classList.remove('active');
                    }, 1000);
                }
            }
            
            formatTimeAgo(timestamp) {
                const diff = Date.now() - timestamp;
                const minutes = Math.floor(diff / 60000);
                const hours = Math.floor(diff / 3600000);
                
                if (minutes < 1) return 'Just now';
                if (minutes < 60) return `${minutes} minutes ago`;
                if (hours < 24) return `${hours} hours ago`;
                return 'Yesterday';
            }
        }
        
        // Initialize the system
        let crisisCommand;
        let notificationManager;
        let teamChatManager;

        // Global Team Chat functions
        function openTeamChat() {
            if (!teamChatManager) {
                teamChatManager = new TeamChatManager();
            }
            teamChatManager.open();
        }

        function closeTeamChat() {
            if (teamChatManager) {
                teamChatManager.close();
            }
        }

        function toggleChatSidebar() {
            if (teamChatManager) {
                teamChatManager.toggleChatSidebar();
            }
        }

        function switchChannel(channelId) {
            if (teamChatManager) {
                teamChatManager.switchChannel(channelId);
            }
        }

        function sendMessage() {
            if (teamChatManager) {
                teamChatManager.sendMessage();
            }
        }

        function handleMessageInput(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        function adjustTextareaHeight(textarea) {
            if (teamChatManager) {
                teamChatManager.adjustTextareaHeight(textarea);
            }
        }

        // Chat message actions
        function acknowledgeMessage(messageId) {
            console.log('ðŸ‘ Message acknowledged:', messageId);
            event.target.textContent = event.target.textContent.replace(/\((\d+)\)/, (match, count) => {
                return `(${parseInt(count) + 1})`;
            });
        }

        function replyToMessage(messageId) {
            const input = document.getElementById('messageInput');
            input.focus();
            console.log('ðŸ’¬ Replying to message:', messageId);
        }

        function pinMessage(messageId) {
            console.log('ðŸ“Œ Message pinned:', messageId);
        }

        // Chat actions
        function searchMessages() {
            console.log('ðŸ” Searching messages');
        }

        function viewChatHistory() {
            console.log('ðŸ“š Viewing chat history');
        }

        function attachFile() {
            console.log('ðŸ“Ž Attaching file');
        }

        function insertEmoji() {
            const input = document.getElementById('messageInput');
            const emojis = ['ðŸ‘', 'ðŸš¨', 'ðŸ”¥', 'ðŸš‘', 'âš ï¸', 'âœ…', 'âŒ', 'ðŸ“‹'];
            const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];
            input.value += randomEmoji;
            input.focus();
        }

        function linkIncident() {
            const input = document.getElementById('messageInput');
            input.value += '#OakStreetFire ';
            input.focus();
        }

        function requestSupport(messageId) {
            console.log('ðŸš’ Requesting support for message:', messageId);
        }

        // Integration functions for chat
        function openIncidentDetails(incidentId) {
            console.log('ðŸ”¥ Opening incident details:', incidentId);
            crisisCommand.showNotification('ðŸ“‹ Opening incident details...', 'info');
        }

        function openResourceMap() {
            console.log('ðŸ—ºï¸ Opening resource map');
            crisisCommand.showNotification('ðŸ—ºï¸ Opening resource map...', 'info');
        }

        function openPatientTracker() {
            console.log('ðŸ¥ Opening patient tracker');
            crisisCommand.showNotification('ðŸ¥ Opening patient tracker...', 'info');
        }

        function openPredictiveAnalysis() {
            console.log('ðŸ“ˆ Opening predictive analysis');
            crisisCommand.showNotification('ðŸ“ˆ Opening predictive analysis...', 'info');
        }

        function openEvacuationMap() {
            console.log('ðŸ—ºï¸ Opening evacuation zones map');
            crisisCommand.showNotification('ðŸ—ºï¸ Opening evacuation zones...', 'info');
        }

        function shareAnalysis(messageId) {
            console.log('ðŸ“¤ Sharing analysis from message:', messageId);
            crisisCommand.showNotification('ðŸ“¤ Analysis shared with team', 'success');
        }

        // Global notification manager functions
        function openNotificationLog() {
            if (!notificationManager) {
                notificationManager = new NotificationLogManager();
            }
            notificationManager.openNotificationLog();
        }

        function closeNotificationLog() {
            if (notificationManager) {
                notificationManager.closeNotificationLog();
            }
        }

        function filterNotifications(category) {
            if (notificationManager) {
                notificationManager.filterNotifications(category);
            }
        }

        function searchNotifications() {
            if (notificationManager) {
                notificationManager.searchNotifications();
            }
        }

        function acknowledgeNotification(id, event) {
            if (notificationManager) {
                notificationManager.acknowledgeNotification(id, event);
            }
        }

        function markAllRead() {
            if (notificationManager) {
                notificationManager.markAllRead();
            }
        }

        function acknowledgeAll() {
            if (notificationManager) {
                notificationManager.acknowledgeAll();
            }
        }

        function selectNotification(id) {
            if (notificationManager) {
                notificationManager.selectNotification(id);
            }
        }

        function toggleArchivedNotifications() {
            if (notificationManager) {
                notificationManager.toggleArchivedNotifications();
            }
        }

        // Additional action handlers
        function escalateNotification(id, event) {
            event.stopPropagation();
            crisisCommand.showNotification('ðŸš¨ Incident escalated to Command', 'warning');
        }

        function dispatchResources(id, event) {
            event.stopPropagation();
            crisisCommand.showNotification('ðŸš’ Resources dispatched', 'success');
        }

        function shareAnalysis(id, event) {
            event.stopPropagation();
            crisisCommand.showNotification('ðŸ“Š Analysis shared with team', 'info');
        }

        function shareNotification(id, event) {
            event.stopPropagation();
            crisisCommand.showNotification('ðŸ“¤ Notification shared', 'info');
        }

        function viewProtocol(id, event) {
            event.stopPropagation();
            crisisCommand.showNotification('ðŸ“– Opening protocol document...', 'info');
        }

        // Enhanced keyboard navigation for notification log
        document.addEventListener('keydown', (e) => {
            const overlay = document.getElementById('notificationLogOverlay');
            if (overlay && overlay.classList.contains('open')) {
                if (e.key === 'Escape') {
                    closeNotificationLog();
                }
                // Add arrow key navigation between notifications
                if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {
                    e.preventDefault();
                    navigateNotifications(e.key === 'ArrowDown' ? 1 : -1);
                }
                // Enter to select focused notification
                if (e.key === 'Enter') {
                    const focused = document.activeElement;
                    if (focused && focused.classList.contains('log-notification-item')) {
                        const id = parseInt(focused.dataset.id);
                        selectNotification(id);
                    }
                }
            }

            // Team Chat keyboard shortcuts
            const chatOverlay = document.getElementById('teamChatOverlay');
            if (chatOverlay && chatOverlay.classList.contains('open')) {
                if (e.key === 'Escape') {
                    closeTeamChat();
                }
            }
        });

        function navigateNotifications(direction) {
            const items = document.querySelectorAll('.log-notification-item');
            const currentIndex = Array.from(items).findIndex(item => item === document.activeElement);
            
            let newIndex;
            if (currentIndex === -1) {
                newIndex = direction > 0 ? 0 : items.length - 1;
            } else {
                newIndex = currentIndex + direction;
                if (newIndex < 0) newIndex = items.length - 1;
                if (newIndex >= items.length) newIndex = 0;
            }
            
            if (items[newIndex]) {
                items[newIndex].focus();
            }
        }

        // Click outside to close overlays
        document.addEventListener('click', (e) => {
            const notificationOverlay = document.getElementById('notificationLogOverlay');
            if (notificationOverlay && notificationOverlay.classList.contains('open') && e.target === notificationOverlay) {
                closeNotificationLog();
            }

            const chatOverlay = document.getElementById('teamChatOverlay');
            if (chatOverlay && chatOverlay.classList.contains('open') && e.target === chatOverlay) {
                closeTeamChat();
            }
        });

        // Global function implementations
        function showSection(sectionId) {
            crisisCommand.showSection(sectionId);
        }
        
        function resetToDashboard() {
            crisisCommand.resetToDashboard();
        }
        
        function toggleMoreMenu() {
            crisisCommand.toggleMoreMenu();
        }
        
        function toggleMobileMenu() {
            crisisCommand.toggleMobileMenu();
        }
        
        function dismissAlert() {
            const banner = document.getElementById('alertBanner');
            banner.classList.add('hidden');
            crisisCommand.showNotification('Alert dismissed', 'info');
        }
        
        function openIncidentDetails(incidentId) {
            crisisCommand.showNotification(`ðŸ“‹ Opening incident details for ID: ${incidentId}...`, 'info');
            // Navigate to patient tracker with specific incident
            window.location.href = `patient_tracker.html?incident=${incidentId}`;
        }
        
        // Action handlers
        function showDetails(type) {
            crisisCommand.showNotification(`Opening ${type} details...`, 'info');
            console.log(`Showing details for: ${type}`);
        }
        
        function quickAction() {
            // Navigate to AI command center for incident creation
            crisisCommand.showNotification('ðŸš¨ Opening AI Command Center for new incident...', 'info');
            setTimeout(() => {
                window.location.href = 'ai-command-center.html?action=create-incident';
            }, 500);
        }
        
        function runAIAnalysis() {
            const btn = event.target;
            btn.classList.add('loading');
            btn.disabled = true;
            
            setTimeout(() => {
                btn.classList.remove('loading');
                btn.disabled = false;
                crisisCommand.showNotification('ðŸ§  AI analysis complete', 'success');
            }, 2000);
        }
        
        function viewFullMap() {
            crisisCommand.showNotification('ðŸ—ºï¸ Opening full interactive map...', 'info');
            crisisCommand.showSection('map');
        }
        
        function reprioritize() {
            const btn = event.target;
            btn.classList.add('loading');
            
            setTimeout(() => {
                btn.classList.remove('loading');
                crisisCommand.showNotification('ðŸŽ¯ Incidents re-prioritized by AI', 'success');
            }, 1500);
        }
        
        function viewIncident(id) {
            crisisCommand.showNotification(`Opening incident #${id} details...`, 'info');
            console.log(`Viewing incident: ${id}`);
        }
        
        function viewAllIncidents() {
            crisisCommand.showNotification('ðŸ“‹ Loading all incidents...', 'info');
            crisisCommand.showSection('incidents');
        }
        
        function refreshInsights() {
            const btn = event.target;
            btn.classList.add('loading');
            
            setTimeout(() => {
                btn.classList.remove('loading');
                crisisCommand.showNotification('ðŸ”„ AI insights refreshed', 'success');
            }, 1500);
        }
        
        function viewMoreInsights() {
            crisisCommand.showNotification('ðŸ”® Opening detailed insights...', 'info');
            crisisCommand.showSection('intelligence');
        }
        
        function viewInsightDetails(type) {
            crisisCommand.showNotification(`Opening ${type} analysis...`, 'info');
            console.log(`Viewing insight details: ${type}`);
        }
        
        function deployUnits(type) {
            event.stopPropagation();
            crisisCommand.showNotification(`ðŸš’ Units deployed for ${type}`, 'success');
        }
        
        function sendAlert(type) {
            event.stopPropagation();
            crisisCommand.showNotification(`ðŸ“¢ Alert sent for ${type}`, 'success');
        }
        
        function positionUnits(type) {
            event.stopPropagation();
            crisisCommand.showNotification(`ðŸš“ Units positioned for ${type}`, 'success');
        }
        
        function optimizeResources() {
            event.stopPropagation();
            crisisCommand.showNotification('âš¡ Resource optimization applied', 'success');
        }
        
        function viewAnalysis(type) {
            event.stopPropagation();
            crisisCommand.showNotification(`ðŸ“Š Opening ${type} analysis...`, 'info');
        }
        
        function viewNotification(id) {
            const notification = crisisCommand.notifications.find(n => n.id === id);
            if (notification) {
                notification.read = true;
                crisisCommand.updateNotificationCount();
                crisisCommand.showNotification(`Viewing: ${notification.subject}`, 'info');
            }
        }
        
        // New section-specific handlers
        function runDeepAnalysis() {
            const btn = event.target;
            btn.classList.add('loading');
            
            setTimeout(() => {
                btn.classList.remove('loading');
                crisisCommand.showNotification('ðŸ”® Deep intelligence analysis complete', 'success');
            }, 3000);
        }
        
        function generateForecast() {
            const btn = event.target;
            btn.classList.add('loading');
            
            setTimeout(() => {
                btn.classList.remove('loading');
                crisisCommand.showNotification('ðŸ”® Predictive forecast generated', 'success');
            }, 2500);
        }
        
        function toggleMapLayers() {
            crisisCommand.showNotification('ðŸ”„ Map layers toggled', 'info');
        }
        
        // Secondary action handlers
        function showTemplates() {
            crisisCommand.toggleMoreMenu();
            crisisCommand.showNotification('ðŸ“‹ Opening response templates...', 'info');
        }
        
        function exportReport() {
            crisisCommand.toggleMoreMenu();
            crisisCommand.showNotification('ðŸ“Š Generating report...', 'info');
            setTimeout(() => {
                crisisCommand.showNotification('âœ… Report exported successfully', 'success');
            }, 2000);
        }
        
        function toggleChat() {
            crisisCommand.toggleMoreMenu();
            // Open team chat instead of just showing notification
            openTeamChat();
        }
        
        function showSettings() {
            crisisCommand.toggleMoreMenu();
            crisisCommand.showNotification('âš™ï¸ Opening settings...', 'info');
        }
        
        function showHelp() {
            crisisCommand.toggleMoreMenu();
            
            // Create help overlay/floating window
            const helpOverlay = document.createElement('div');
            helpOverlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.7);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
                animation: fadeIn 0.3s ease;
            `;
            
            const helpWindow = document.createElement('div');
            helpWindow.style.cssText = `
                background: white;
                border-radius: 12px;
                padding: 2rem;
                max-width: 600px;
                max-height: 80vh;
                overflow-y: auto;
                box-shadow: var(--shadow-xl);
                position: relative;
            `;
            
            helpWindow.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; border-bottom: 1px solid var(--border-color); padding-bottom: 1rem;">
                    <h2 style="margin: 0; color: var(--primary-color);">â“ Help & Shortcuts</h2>
                    <button onclick="closeHelp()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">âœ•</button>
                </div>
                
                <div style="margin-bottom: 1.5rem;">
                    <h3 style="color: var(--text-color-base); margin-bottom: 1rem;">ðŸŽ¯ Navigation</h3>
                    <ul style="margin-left: 1rem;">
                        <li><strong>Home/Logo:</strong> crisis-command-center.html - Global dashboard reset/refresh</li>
                        <li><strong>Command:</strong> ai-command-center.html - AI command and incident creation</li>
                        <li><strong>Intelligence:</strong> context-intelligence-dashboard.html - Deep analytics/tracing</li>
                        <li><strong>Analysis:</strong> predictive-analytics-dashboard.html - Forecasts, risk modeling, surge planning</li>
                        <li><strong>Map:</strong> map_reports.html - Geospatial resource/incident view</li>
                    </ul>
                </div>
                
                <div style="margin-bottom: 1.5rem;">
                    <h3 style="color: var(--text-color-base); margin-bottom: 1rem;">ðŸš¨ Quick Access</h3>
                    <ul style="margin-left: 1rem;">
                        <li><strong>Active Incidents:</strong> triage_dashboard.html - Detailed incident workflow</li>
                        <li><strong>Resource Management:</strong> real-time-resource-optimizer.html - Asset/personnel deployment</li>
                        <li><strong>Analytics:</strong> analytics_dashboard.html - KPI and performance tracking</li>
                        <li><strong>Archive:</strong> report_archive.html - Full incident/report history</li>
                        <li><strong>Patient Tracker:</strong> patient_tracker.html - Triage/patient details, edit/view/update</li>
                    </ul>
                </div>
                
                <div style="margin-bottom: 1.5rem;">
                    <h3 style="color: var(--text-color-base); margin-bottom: 1rem;">âŒ¨ï¸ Keyboard Shortcuts</h3>
                    <ul style="margin-left: 1rem;">
                        <li><strong>Alt+1-4:</strong> Navigate between main sections</li>
                        <li><strong>Ctrl+N:</strong> Create new incident (opens AI Command Center)</li>
                        <li><strong>Ctrl+T:</strong> Open Team Chat</li>
                        <li><strong>Escape:</strong> Close open menus and dropdowns</li>
                    </ul>
                </div>
                
                <div>
                    <h3 style="color: var(--text-color-base); margin-bottom: 1rem;">ðŸ”” Notifications & Chat</h3>
                    <p style="margin-left: 1rem;">Click the notification bell to view/acknowledge alerts and access the notification log. Use Team Chat for real-time coordination with incident command, field teams, and support staff.</p>
                </div>
            `;
            
            helpOverlay.appendChild(helpWindow);
            document.body.appendChild(helpOverlay);
            
            // Close help when clicking outside
            helpOverlay.addEventListener('click', (e) => {
                if (e.target === helpOverlay) {
                    closeHelp();
                }
            });
            
            // Store reference for cleanup
            window.currentHelpOverlay = helpOverlay;
        }
        
        function closeHelp() {
            if (window.currentHelpOverlay) {
                window.currentHelpOverlay.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => {
                    if (window.currentHelpOverlay && window.currentHelpOverlay.parentNode) {
                        window.currentHelpOverlay.parentNode.removeChild(window.currentHelpOverlay);
                    }
                    window.currentHelpOverlay = null;
                }, 300);
            }
        }
        
        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            // Show loading initially
            const loader = document.getElementById('loadingOverlay');
            loader.classList.add('active');
            
            // Initialize system after brief delay
            setTimeout(() => {
                crisisCommand = new CleanCrisisCommand();
            }, 500);
        });
        
        console.log('ðŸš€ Clean Crisis Command Center with Team Chat loaded');
    </script>
</body>
</html> 